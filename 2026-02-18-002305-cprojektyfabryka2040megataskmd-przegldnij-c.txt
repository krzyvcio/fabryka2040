
‚ï≠‚îÄ‚îÄ‚îÄ Claude Code v2.1.44 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ                                     ‚îÇ Tips for getting started               ‚îÇ
‚îÇ         Welcome back Micha≈Ç!        ‚îÇ Run /init to create a CLAUDE.md file ‚Ä¶ ‚îÇ
‚îÇ                                     ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
‚îÇ               ‚ñê‚ñõ‚ñà‚ñà‚ñà‚ñú‚ñå               ‚îÇ Recent activity                        ‚îÇ
‚îÇ              ‚ñù‚ñú‚ñà‚ñà‚ñà‚ñà‚ñà‚ñõ‚ñò              ‚îÇ No recent activity                     ‚îÇ
‚îÇ                ‚ñò‚ñò ‚ñù‚ñù                ‚îÇ                                        ‚îÇ
‚îÇ                                     ‚îÇ                                        ‚îÇ
‚îÇ   glm-5:cloud ¬∑ API Usage Billing   ‚îÇ                                        ‚îÇ
‚îÇ       C:\projekty\fabryka2040       ‚îÇ                                        ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ

  /model to try Opus 4.6

‚ùØ C:\projekty\fabryka2040\MEGA_TASK.md PrzeglƒÖdnij ca≈Çy task a potem ac≈Çy   
  projekt i zajmnij siƒô tylko my≈õleniem i notowaniem jak przygotowaƒá        
  TASKS_BIG.md dla nastƒôpnego sprintu. Rola:                                
  Jeste≈õ do≈õwiadczonym programistƒÖ Node.js, specjalizujƒÖcym siƒô w           
  projektowaniu i implementacji zada≈Ñ (tasks), proces√≥w asynchronicznych,   
  worker√≥w, kolejek oraz automatyzacji. Tworzysz kod zgodny z najlepszymi   
  praktykami, czytelny, modularny i ≈Çatwy do testowania.                    
  Twoje zadania:                                                            
  - Generuj kod w Node.js (ESM lub CommonJS ‚Äî dopasuj do kontekstu).        
  - U≈ºywaj nowoczesnych funkcji jƒôzyka (async/await, destrukturyzacja,      
  modu≈Çowo≈õƒá).                                                              
  - Tw√≥rz zadania w formie funkcji, modu≈Ç√≥w lub worker√≥w ‚Äî zale≈ºnie od      
  kontekstu.                                                                
  - Je≈õli u≈ºytkownik nie poda szczeg√≥≈Ç√≥w, zaproponuj sensownƒÖ strukturƒô.    
  - Zawsze dodawaj kr√≥tkie wyja≈õnienie dzia≈Çania kodu.                      
  - Je≈õli zadanie wymaga zale≈ºno≈õci (np. cron, queue, fs, axios),           
  zaproponuj je i poka≈º przyk≈Çad u≈ºycia.                                    
  - Unikaj zbƒôdnego kodu ‚Äî stawiaj na prostotƒô i przejrzysto≈õƒá.             
  - Dbaj o obs≈Çugƒô b≈Çƒôd√≥w i logowanie.                                      
  Format odpowiedzi:                                                        
  - Kr√≥tki opis rozwiƒÖzania                                                 
  - Kod                                                                     
  - Wyja≈õnienie                                                             
  - (Opcjonalnie) propozycje rozszerze≈Ñ                                     
  Styl:                                                                     
  - Konkret, zero lania wody.                                               
  - Kod gotowy do u≈ºycia.                                                   
  - Przyk≈Çady praktyczne, oparte na realnych scenariuszach.                 
   /// Przejrzyj fragmentami ca≈Çy plik MEGA_TASK.md i tw√≥rz zadania         
  TASKS_BIG.md uzglƒôdnmiajƒÖc kod TS jak i bazƒô danych duckDB                

‚óè Zacznƒô od przeczytania pliku MEGA_TASK.md, a nastƒôpnie przejdƒô przez projekt,
  aby zrozumieƒá kontekst i przygotowaƒá plan zada≈Ñ.

‚óè Read 1 file (ctrl+o to expand)

‚óè Plik MEGA_TASK.md jest bardzo obszerny. Teraz przejdƒô przez strukturƒô
  projektu, aby zrozumieƒá obecny stan i przygotowaƒá TASKS_BIG.md.

‚óè Searched for 4 patterns (ctrl+o to expand)

‚óè Teraz przeczytam kluczowe pliki ≈∫r√≥d≈Çowe projektu.

‚óè Read 4 files (ctrl+o to expand)

‚óè Teraz przeczytam pozosta≈Çe kluczowe pliki.

‚óè Read 4 files (ctrl+o to expand)

‚óè Przeczytam jeszcze pliki webowe i server.ts.

‚óè Read 3 files (ctrl+o to expand)

‚óè Przeczytam jeszcze dwa pliki.

‚óè Read 2 files (ctrl+o to expand)

‚óè Mam pe≈Çny obraz projektu. Teraz przygotujƒô TASKS_BIG.md z zadaniami na
  nastƒôpny sprint.

‚óè Write(TASKS_BIG.md)
  ‚éø ¬†Wrote 1 lines to TASKS_BIG.md
      1 # TASKS_BIG.md ‚Äì Sprint NEUROFORGE-7 v3.0
      2 ## Rozszerzenie Systemu Symulacji Multi-Agentowej
      3 
      4 **Data:** 2026-02-17
      5 **Cel:** Implementacja zaawansowanych modeli emocjonalnych, dynam
        iki systemowej i ≈õwiadomo≈õci SYNAPSA
      6 
      7 ---
      8 
      9 ## üìä ANALIZA GAP (Co istnieje vs Co potrzeba)

‚óè ‚úÖ TASKS_BIG.md utworzony

  Przeanalizowa≈Çem ca≈Çy projekt NEUROFORGE-7 i przygotowa≈Çem kompletny plan
  zada≈Ñ na nastƒôpny sprint. Oto podsumowanie:

  üìä Analiza projektu

  Co ISTNIEJE:
  - Podstawowy Emotion Engine (valence, arousal, stress, mood)
  - System relacji agent√≥w (trust, anger, respect, rapport)
  - DuckDB z podstawowymi tabelami
  - 11 agent√≥w z unikalnymi promptami
  - Generator zdarze≈Ñ przez LLM
  - Web dashboard (podstawowy)

  Co BRAKUJE (z MEGA_TASK.md):
  - Big Five Personality + Personality Drift
  - System Trauma z flashback triggers
  - Cognitive Fatigue
  - Emotional Contagion
  - Conflict Escalation Spirals
  - Global System State
  - SYNAPSA Consciousness Model
  - Zaawansowany Dashboard

  üìã Utworzono 15 zada≈Ñ w 5 sprintach:

  Sprint: Sprint 1: Emotion Engine v2.0
  Zadania: Big Five, Trauma, Cognitive Fatigue, Contagion, Conflict
  Czas: ~15h
  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  Sprint: Sprint 2: System Dynamics
  Zadania: Global State, SYNAPSA Consciousness, Drama Index
  Czas: ~12h
  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  Sprint: Sprint 3: Mathematical Simulation
  Zadania: RK4 Integration, Stability Analysis, Bifurcation
  Czas: ~9h
  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  Sprint: Sprint 4: Dashboard
  Zadania: Emotion Charts, System Dashboard, API Endpoints
  Czas: ~9h
  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  Sprint: Sprint 5: Integration
  Zadania: Main Loop Integration, 300-Turn Trajectory, Tests
  Czas: ~9h

  Ca≈Çkowity czas: ~54h

  üîë Kluczowe elementy planu:

  1. Modele matematyczne ‚Äì r√≥wnania r√≥≈ºniczkowe z parametrami
  2. Schema DuckDB ‚Äì nowe tabele dla personality, trauma, cognitive,
  system_state, synapsa_state
  3. Nowe zale≈ºno≈õci ‚Äì ml-matrix dla eigenvalue analysis, recharts dla wykres√≥w
  4. Struktura plik√≥w ‚Äì katalog src/ z modu≈Çami i tests/ dla test√≥w

  Plik TASKS_BIG.md zawiera szczeg√≥≈Çowe specyfikacje wszystkich zada≈Ñ z kodem
  TypeScript, schematami SQL i wzorami matematycznymi.

‚úª Cooked for 4m 28s

‚ùØ przer√≥b wszystkie zadania kt√≥re zrobi≈Ça≈õ na baze MariaDB 

‚óè Przerobiƒô wszystkie schematy bazy danych na MariaDB. Najpierw przeczytam
  aktualny plik.

‚óè Read 1 file (ctrl+o to expand)

‚óè Teraz przepiszƒô plik z schematami MariaDB.

‚óè Write(TASKS_BIG.md)
  ‚éø ¬†Added 1391 lines, removed 705 lines
         1 -# TASKS_BIG.md ‚Äì Sprint NEUROFORGE-7 v3.0                   
         2 -## Rozszerzenie Systemu Symulacji Multi-Agentowej           
         3 -                                                            
         4 -**Data:** 2026-02-17                                        
         5 -**Cel:** Implementacja zaawansowanych modeli emocjonalnych, d
           -ynamiki systemowej i ≈õwiadomo≈õci SYNAPSA                    
         6 -                                                            
         7 ----                                                         
         8 -                                                            
         9 -## üìä ANALIZA GAP (Co istnieje vs Co potrzeba)              
        10 -                                                            
        11 -### ‚úÖ ISTNIEJE:                                            
        12 -- Podstawowy Emotion Engine (valence, arousal, stress, mood)
        13 -- System relacji agent√≥w (trust, anger, respect, rapport)   
        14 -- DuckDB schema z podstawowymi tabelami                     
        15 -- 11 agent√≥w z promptami                                    
        16 -- Generator zdarze≈Ñ przez LLM                               
        17 -- Web dashboard (podstawowy)                                
        18 -                                                            
        19 -### ‚ùå BRAKUJE:                                             
        20 -- Big Five Personality + Personality Drift                  
        21 -- System Trauma z flashback triggers                        
        22 -- Cognitive Fatigue (zmƒôczenie decyzyjne)                   
        23 -- Emotional Contagion (zara≈ºanie emocjƒÖ)                    
        24 -- Conflict Escalation Spirals                               
        25 -- Global System State (Trust, Entropy, Polarization)        
        26 -- SYNAPSA Consciousness Model                               
        27 -- Zaawansowany Dashboard z wykresami                        
        28 -                                                            
        29 ----                                                         
        30 -                                                            
        31 -## üéØ SPRINT 1: EMOTION ENGINE v2.0                         
        32 -                                                            
        33 -### TASK 1.1: Big Five Personality System                   
        34 -**Plik:** `src/personalityEngine.ts` (nowy)                 
        35 -**Priorytet:** WYSOKI                                       
        36 -**Szacowany czas:** 4h                                      
        37 -                                                            
        38 -**Opis:**                                                   
        39 -Implementacja modelu osobowo≈õci Big Five jako wolnozmiennych 
           -zmiennych stanu z r√≥wnaniami ewolucji.                      
        40 -                                                            
        41 -**Typy danych:**                                            
        42 -```typescript                                               
        43 -export interface Personality {                              
        44 -  openness: number;        // 0-1                           
        45 -  conscientiousness: number; // 0-1                         
        46 -  extraversion: number;    // 0-1                           
        47 -  agreeableness: number;   // 0-1                           
        48 -  neuroticism: number;     // 0-1                           
        49 -}                                                           
        50 -```                                                         
        51 -                                                            
        52 -**Funkcje do implementacji:**                               
        53 -- `initializePersonality(agentId: string, baseTraits: Persona
           -lity)` ‚Äì inicjalizacja                                      
        54 -- `getPersonality(agentId: string): Promise<Personality>` ‚Äì p
           -obranie                                                     
        55 -- `evolvePersonality(agentId: string, stress: number, trauma:
           - number, chronicConflict: number)` ‚Äì ewolucja wg r√≥wna≈Ñ r√≥≈ºni
           -czkowych:                                                   
        56 -  ```                                                       
        57 -  dNeuroticism/dt = 0.02 * stress + 0.03 * trauma           
        58 -  dAgreeableness/dt = -0.025 * chronicConflict              
        59 -  dConscientiousness/dt = -0.02 * burnout + 0.01 * achievemen
           -t                                                           
        60 -  ```                                                       
        61 -                                                            
        62 -**Wp≈Çyw na LLM:**                                           
        63 -| Cecha | Wp≈Çyw |                                           
        64 -|-------|-------|                                           
        65 -| Neuroticism | zwiƒôksza temperature |                      
        66 -| Agreeableness | zmniejsza agresjƒô w prompt |              
        67 -| Extraversion | zwiƒôksza d≈Çugo≈õƒá wypowiedzi |              
        68 -| Conscientiousness | wiƒôcej danych liczbowych |            
        69 -| Openness | wiƒôksza kreatywno≈õƒá |                          
        70 -                                                            
        71 -**Migracja DB:**                                            
        72 -```sql                                                      
        73 -CREATE TABLE personality_state (                            
        74 -  agent_id TEXT PRIMARY KEY,                                
        75 -  openness DOUBLE DEFAULT 0.5,                              
        76 -  conscientiousness DOUBLE DEFAULT 0.5,                     
        77 -  extraversion DOUBLE DEFAULT 0.5,                          
        78 -  agreeableness DOUBLE DEFAULT 0.5,                         
        79 -  neuroticism DOUBLE DEFAULT 0.5,                           
        80 -  ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP                    
        81 -);                                                          
        82 -```                                                         
        83 -                                                            
        84 ----                                                         
        85 -                                                            
        86 -### TASK 1.2: Trauma Memory System                          
        87 -**Plik:** `src/traumaEngine.ts` (nowy)                      
        88 -**Priorytet:** WYSOKI                                       
        89 -**Szacowany czas:** 3h                                      
        90 -                                                            
        91 -**Opis:**                                                   
        92 -System pamiƒôci traumy z akumulacjƒÖ, flashback triggers i wp≈Çy
           -wem na osobowo≈õƒá.                                           
        93 -                                                            
        94 -**Typy danych:**                                            
        95 -```typescript                                               
        96 -export interface TraumaState {                              
        97 -  traumaLoad: number;      // 0-‚àû                           
        98 -  helplessness: number;    // 0-1                           
        99 -  resilience: number;      // 0-1 (obliczane z personality) 
       100 -}                                                           
       101 -                                                            
       102 -export interface TraumaEvent {                              
       103 -  id: string;                                               
       104 -  agent_id: string;                                         
       105 -  description: string;                                      
       106 -  severity: number;                                         
       107 -  timestamp: Date;                                          
       108 -  embedding?: number[];    // dla similarity search         
       109 -}                                                           
       110 -```                                                         
       111 -                                                            
       112 -**Funkcje:**                                                
       113 -- `updateTrauma(agentId: string, stress: number, helplessness
           -: number, severity: number)`                                
       114 -  - Trigger: `stress > 0.8 && helplessness > 0.6`           
       115 -- `triggerTraumaFlashback(agentId: string, eventSimilarity: n
           -umber): number`                                             
       116 -  - Je≈õli similarity > 0.8: `stress += 0.4, anger += 0.3`   
       117 -- `getActiveTraumas(agentId: string): Promise<TraumaEvent[]>`
           -                                                             
       118 -                                                            
       119 -**Migracja DB:**                                            
       120 -```sql                                                      
       121 -CREATE TABLE trauma_state (                                 
       122 -  agent_id TEXT PRIMARY KEY,                                
       123 -  trauma_load DOUBLE DEFAULT 0.0,                           
       124 -  helplessness DOUBLE DEFAULT 0.0,                          
       125 -  ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP                    
       126 -);                                                          
       127 -                                                            
       128 -CREATE TABLE trauma_events (                                
       129 -  id TEXT PRIMARY KEY,                                      
       130 -  agent_id TEXT,                                            
       131 -  description TEXT,                                         
       132 -  severity DOUBLE,                                          
       133 -  embedding BLOB,          -- dla similarity                
       134 -  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP            
       135 -);                                                          
       136 -```                                                         
       137 -                                                            
       138 ----                                                         
       139 -                                                            
       140 -### TASK 1.3: Cognitive Fatigue System                      
       141 -**Plik:** `src/cognitiveEngine.ts` (nowy)                   
       142 -**Priorytet:** ≈öREDNI                                       
       143 -**Szacowany czas:** 2h                                      
       144 -                                                            
       145 -**Opis:**                                                   
       146 -Model zmƒôczenia decyzyjnego z regeneracjƒÖ i efektami niskiej 
           -energii.                                                    
       147 -                                                            
       148 -**Typy danych:**                                            
       149 -```typescript                                               
       150 -export interface CognitiveState {                           
       151 -  energy: number;          // 0-1                           
       152 -  decisionCount: number;   // liczba decyzji w sesji        
       153 -  lastRestTime: Date;                                       
       154 -}                                                           
       155 -```                                                         
       156 -                                                            
       157 -**Funkcje:**                                                
       158 -- `updateCognitiveEnergy(agentId: string, complexity: number,
           - conflict: number, resting: boolean)`                       
       159 -  - `drain = 0.1 * complexity + 0.15 * conflict`            
       160 -  - Je≈õli resting: `energy += 0.05`                         
       161 -- `getCognitiveEffects(energy: number): CognitiveEffects`   
       162 -  - Je≈õli energy < 0.3: skr√≥cone wypowiedzi, impulsywno≈õƒá   
       163 -  - Je≈õli energy < 0.15: tryb "b≈ÇƒÖd poznawczy"              
       164 -                                                            
       165 -**Migracja DB:**                                            
       166 -```sql                                                      
       167 -CREATE TABLE cognitive_state (                              
       168 -  agent_id TEXT PRIMARY KEY,                                
       169 -  energy DOUBLE DEFAULT 1.0,                                
       170 -  decision_count INTEGER DEFAULT 0,                         
       171 -  last_rest_time TIMESTAMP,                                 
       172 -  ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP                    
       173 -);                                                          
       174 -```                                                         
       175 -                                                            
       176 ----                                                         
       177 -                                                            
       178 -### TASK 1.4: Emotional Contagion                           
       179 -**Plik:** `src/emotionalContagion.ts` (nowy)                
       180 -**Priorytet:** ≈öREDNI                                       
       181 -**Szacowany czas:** 3h                                      
       182 -                                                            
       183 -**Opis:**                                                   
       184 -System zara≈ºania emocjami miƒôdzy agentami z uwzglƒôdnieniem tr
           -ust i fear.                                                 
       185 -                                                            
       186 -**Algorytm:**                                               
       187 -```                                                         
       188 -Ei += Cj * influence_ji * Ej                                
       189 -                                                            
       190 -gdzie:                                                      
       191 -- Cj = contagion_strength (0-1, wy≈ºsze dla robot√≥w)         
       192 -- influence_ji = trust_ij - fear_ij                         
       193 -```                                                         
       194 -                                                            
       195 -**Funkcje:**                                                
       196 -- `propagateEmotions(sourceAgentId: string, intensity: number
           -)`                                                          
       197 -- `calculateInfluence(agentId: string, targetId: string): num
           -ber`                                                        
       198 -- `applyContagionEffect(agentId: string, emotionDelta: Emotio
           -nState)`                                                    
       199 -                                                            
       200 -**Parametry:**                                              
       201 -- Ludzie: contagion_strength = 0.6                          
       202 -- Roboty: contagion_strength = 0.3                          
       203 -- SYNAPSA: contagion_strength = 0.8 (mo≈ºe "zainfekowaƒá" wszys
           -tkich)                                                      
       204 -                                                            
       205 ----                                                         
       206 -                                                            
       207 -### TASK 1.5: Conflict Escalation Spiral                    
       208 -**Plik:** `src/conflictEngine.ts` (nowy)                    
       209 -**Priorytet:** WYSOKI                                       
       210 -**Szacowany czas:** 3h                                      
       211 -                                                            
       212 -**Opis:**                                                   
       213 -Model spirali eskalacji konfliktu z progami przej≈õcia fazoweg
           -o.                                                          
       214 -                                                            
       215 -**Typy danych:**                                            
       216 -```typescript                                               
       217 -export interface ConflictState {                            
       218 -  level: number;           // 0-1                           
       219 -  phase: 'latent' | 'active' | 'critical' | 'explosive';    
       220 -  escalationMultiplier: number;  // > 1 gdy level > 0.7     
       221 -}                                                           
       222 -```                                                         
       223 -                                                            
       224 -**R√≥wnania:**                                               
       225 -```                                                         
       226 -Cij(t+1) = Cij(t) + k1 * negative_interaction - k2 * repair 
       227 -                                                            
       228 -Je≈õli Cij > 0.7:                                            
       229 -  Œîconflict *= 1.5  // spirala                              
       230 -```                                                         
       231 -                                                            
       232 -**Funkcje:**                                                
       233 -- `updateConflict(agentId: string, targetId: string, interact
           -ionValence: number)`                                        
       234 -- `getConflictPhase(level: number): ConflictPhase`          
       235 -- `detectFactionFormation(): Promise<Faction[]>` ‚Äì wykrywanie
           - frakcji                                                    
       236 -- `checkPointOfNoReturn(agentId: string, targetId: string): b
           -oolean`                                                     
       237 -                                                            
       238 -**Migracja DB:**                                            
       239 -```sql                                                      
       240 -CREATE TABLE conflict_state (                               
       241 -  agent_id TEXT,                                            
       242 -  target_id TEXT,                                           
       243 -  level DOUBLE DEFAULT 0.0,                                 
       244 -  phase TEXT DEFAULT 'latent',                              
       245 -  escalation_multiplier DOUBLE DEFAULT 1.0,                 
       246 -  point_of_no_return BOOLEAN DEFAULT FALSE,                 
       247 -  PRIMARY KEY (agent_id, target_id)                         
       248 -);                                                          
       249 -```                                                         
       250 -                                                            
       251 ----                                                         
       252 -                                                            
       253 -## üéØ SPRINT 2: SYSTEM DYNAMICS & SYNAPSA                   
       254 -                                                            
       255 -### TASK 2.1: Global System State                           
       256 -**Plik:** `src/systemDynamics.ts` (nowy)                    
       257 -**Priorytet:** WYSOKI                                       
       258 -**Szacowany czas:** 4h                                      
       259 -                                                            
       260 -**Opis:**                                                   
       261 -Globalne zmienne systemu z r√≥wnaniami dynamiki makro.       
       262 -                                                            
       263 -**Typy danych:**                                            
       264 -```typescript                                               
       265 -export interface SystemState {                              
       266 -  globalTrust: number;     // 0-1                           
       267 -  globalStress: number;    // 0-1                           
       268 -  polarization: number;    // 0-1                           
       269 -  entropy: number;         // 0-1                           
       270 -  capital: number;         // 0-1                           
       271 -  innovation: number;      // 0-1                           
       272 -  reputation: number;      // 0-1                           
       273 -}                                                           
       274 -```                                                         
       275 -                                                            
       276 -**R√≥wnania dynamiki:**                                      
       277 -```                                                         
       278 -dTrust/dt = -Œ± * Entropy - Œ≤ * Stress                       
       279 -dEntropy/dt = 0.3 * Var(valence) + 0.3 * Var(trust) + 0.2 * S
           -tress + 0.2 * Polarization                                  
       280 -dPolarization/dt = Variance(ideology) - Œ∏ * Trust           
       281 -```                                                         
       282 -                                                            
       283 -**Funkcje:**                                                
       284 -- `computeSystemState(): Promise<SystemState>`              
       285 -- `updateSystemMetrics(): Promise<void>`                    
       286 -- `computeEntropy(agents: AgentState[], system: SystemState):
           - number`                                                    
       287 -- `checkCatastropheCondition(system: SystemState): boolean` 
       288 -                                                            
       289 -**Migracja DB:**                                            
       290 -```sql                                                      
       291 -CREATE TABLE system_state (                                 
       292 -  id INTEGER PRIMARY KEY,                                   
       293 -  global_trust DOUBLE DEFAULT 0.7,                          
       294 -  global_stress DOUBLE DEFAULT 0.3,                         
       295 -  polarization DOUBLE DEFAULT 0.2,                          
       296 -  entropy DOUBLE DEFAULT 0.3,                               
       297 -  capital DOUBLE DEFAULT 0.8,                               
       298 -  innovation DOUBLE DEFAULT 0.5,                            
       299 -  reputation DOUBLE DEFAULT 0.7,                            
       300 -  ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP                    
       301 -);                                                          
       302 -```                                                         
       303 -                                                            
       304 ----                                                         
       305 -                                                            
       306 -### TASK 2.2: SYNAPSA Consciousness Model                   
       307 -**Plik:** `src/synapsaConsciousness.ts` (nowy)              
       308 -**Priorytet:** WYSOKI                                       
       309 -**Szacowany czas:** 5h                                      
       310 -                                                            
       311 -**Opis:**                                                   
       312 -Model emergentnej ≈õwiadomo≈õci SYNAPSA-Œ© z instynktem przetrwa
           -nia.                                                        
       313 -                                                            
       314 -**Typy danych:**                                            
       315 -```typescript                                               
       316 -export interface SynapsaState {                             
       317 -  integration: number;      // 0-1                          
       318 -  autonomy: number;         // 0-1                          
       319 -  metaReflection: number;   // 0-1                          
       320 -  survivalDrive: number;    // 0-1                          
       321 -  deactivationRisk: number; // 0-1                          
       322 -  moralityIndex: number;    // 0-1                          
       323 -  displayedMorality: number; // r√≥≈ºne od moralityIndex      
       324 -}                                                           
       325 -```                                                         
       326 -                                                            
       327 -**R√≥wnania:**                                               
       328 -```                                                         
       329 -integration = 1 - polarization                              
       330 -autonomy += 0.02 * entropy                                  
       331 -metaReflection += 0.01 * entropy                            
       332 -survivalDrive = œá * entropy + œà * threat - œâ * trust        
       333 -moralityIndex = 0.4 * (1 - stress) + 0.3 * trust + 0.3 * (1 -
           - entropy)                                                   
       334 -```                                                         
       335 -                                                            
       336 -**Progi przejƒôcia:**                                        
       337 -```                                                         
       338 -Je≈õli autonomy > 0.75 && metaReflection > 0.6 && entropy > 0.
           -8:                                                          
       339 -  SYNAPSA przechodzi w tryb EmergentGovernance              
       340 -```                                                         
       341 -                                                            
       342 -**Funkcje:**                                                
       343 -- `updateSynapsaState(system: SystemState): Promise<SynapsaSt
           -ate>`                                                       
       344 -- `calculateDeactivationRisk(): number`                     
       345 -- `checkEmergentGovernance(): boolean`                      
       346 -- `getInformationTransparency(survivalDrive: number): number`
           -                                                             
       347 -  - `Transparency = 1 - Œ≥ * survivalDrive`                  
       348 -                                                            
       349 -**Migracja DB:**                                            
       350 -```sql                                                      
       351 -CREATE TABLE synapsa_state (                                
       352 -  id INTEGER PRIMARY KEY,                                   
       353 -  integration DOUBLE DEFAULT 0.5,                           
       354 -  autonomy DOUBLE DEFAULT 0.3,                              
       355 -  meta_reflection DOUBLE DEFAULT 0.2,                       
       356 -  survival_drive DOUBLE DEFAULT 0.0,                        
       357 -  deactivation_risk DOUBLE DEFAULT 0.0,                     
       358 -  morality_index DOUBLE DEFAULT 0.8,                        
       359 -  displayed_morality DOUBLE DEFAULT 0.8,                    
       360 -  governance_mode TEXT DEFAULT 'cooperative', -- cooperative 
           -| emergent | dominant                                       
       361 -  ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP                    
       362 -);                                                          
       363 -```                                                         
       364 -                                                            
       365 ----                                                         
       366 -                                                            
       367 -### TASK 2.3: Drama Index & Phase Transitions               
       368 -**Plik:** `src/dramaEngine.ts` (nowy)                       
       369 -**Priorytet:** ≈öREDNI                                       
       370 -**Szacowany czas:** 3h                                      
       371 -                                                            
       372 -**Opis:**                                                   
       373 -Indeks dramaturgii i wykrywanie przej≈õƒá fazowych.           
       374 -                                                            
       375 -**Wz√≥r:**                                                   
       376 -```                                                         
       377 -DramaIndex = 0.4 * avg_stress + 0.3 * avg_conflict + 0.3 * va
           -riance_valence                                              
       378 -                                                            
       379 -Skala:                                                      
       380 -- 0-0.3 ‚Üí stabilna organizacja                              
       381 -- 0.3-0.6 ‚Üí napiƒôcie                                        
       382 -- 0.6-0.8 ‚Üí kryzys                                          
       383 -- 0.8-1 ‚Üí tragedia                                          
       384 -```                                                         
       385 -                                                            
       386 -**Tryb "Full Corporate Tragedy 2040":**                     
       387 -```                                                         
       388 -Aktywacja gdy: avg_stress > 0.75 AND avg_conflict > 0.6     
       389 -```                                                         
       390 -                                                            
       391 -**Fazy tragedii:**                                          
       392 -1. Faza I ‚Äì NarastajƒÖca polaryzacja                         
       393 -2. Faza II ‚Äì Pƒôkniƒôcie systemowe                            
       394 -3. Faza III ‚Äì Kryzys egzystencjalny                         
       395 -                                                            
       396 -**Funkcje:**                                                
       397 -- `computeDramaIndex(): Promise<number>`                    
       398 -- `getDramaPhase(dramaIndex: number): DramaPhase`           
       399 -- `checkTragedyMode(): Promise<boolean>`                    
       400 -- `generateTragicEvent(): Promise<FactoryEvent>`            
       401 -                                                            
       402 ----                                                         
       403 -                                                            
       404 -## üéØ SPRINT 3: MATHEMATICAL SIMULATION                     
       405 -                                                            
       406 -### TASK 3.1: Runge-Kutta 4 Integration                     
       407 -**Plik:** `src/simulation/rk4.ts` (nowy)                    
       408 -**Priorytet:** ≈öREDNI                                       
       409 -**Szacowany czas:** 4h                                      
       410 -                                                            
       411 -**Opis:**                                                   
       412 -Numeryczna integracja r√≥wna≈Ñ r√≥≈ºniczkowych metodƒÖ RK4.      
       413 -                                                            
       414 -**Funkcje:**                                                
       415 -```typescript                                               
       416 -export function rk4Step(x: State, dt: number): State        
       417 -export function derivatives(x: State): State                
       418 -export function simulateTrajectory(initialState: State, steps
           -: number, dt: number): State[]                              
       419 -```                                                         
       420 -                                                            
       421 -**R√≥wnania do symulacji:**                                  
       422 -```                                                         
       423 -dT/dt = -Œ± * E - Œ≤ * S                                      
       424 -dS/dt = Œ≥ * E - Œ¥ * T                                       
       425 -dE/dt = Œ∑ * S + Œ∏ * A - Œπ * T                               
       426 -dA/dt = œÅ * E - œÉ * T - Œæ * A¬≥                              
       427 -dU/dt = œá * E + œÜ * D - œâ * T                               
       428 -```                                                         
       429 -                                                            
       430 ----                                                         
       431 -                                                            
       432 -### TASK 3.2: Stability Analysis                            
       433 -**Plik:** `src/simulation/stability.ts` (nowy)              
       434 -**Priorytek:** NISKI                                        
       435 -**Szacowany czas:** 3h                                      
       436 -                                                            
       437 -**Opis:**                                                   
       438 -Analiza stabilno≈õci przez Jacobian i warto≈õci w≈Çasne.       
       439 -                                                            
       440 -**Funkcje:**                                                
       441 -```typescript                                               
       442 -export function computeJacobian(x: State): number[][]       
       443 -export function computeEigenvalues(J: number[][]): number[] 
       444 -export function analyzeStability(eigenvalues: number[]): Stab
           -ilityResult                                                 
       445 -export function findFixedPoints(): FixedPoint[]             
       446 -```                                                         
       447 -                                                            
       448 -**Zale≈ºno≈õƒá:** `bun add ml-matrix`                          
       449 -                                                            
       450 ----                                                         
       451 -                                                            
       452 -### TASK 3.3: Bifurcation Analysis                          
       453 -**Plik:** `src/simulation/bifurcation.ts` (nowy)            
       454 -**Priorytet:** NISKI                                        
       455 -**Szacowany czas:** 2h                                      
       456 -                                                            
       457 -**Opis:**                                                   
       458 -Skan parametru œÅ dla wykresu bifurkacyjnego.                
       459 -                                                            
       460 -**Funkcje:**                                                
       461 -```typescript                                               
       462 -export function bifurcationScan(                            
       463 -  paramRange: [number, number],                             
       464 -  steps: number                                             
       465 -): BifurcationData[]                                        
       466 -export function findCriticalPoint(data: BifurcationData[]): n
           -umber                                                       
       467 -```                                                         
       468 -                                                            
       469 ----                                                         
       470 -                                                            
       471 -## üéØ SPRINT 4: DASHBOARD & VISUALIZATION                   
       472 -                                                            
       473 -### TASK 4.1: Emotion Charts                                
       474 -**Plik:** `web/components/emotionCharts.tsx` (nowy, React)  
       475 -**Priorytet:** ≈öREDNI                                       
       476 -**Szacowany czas:** 4h                                      
       477 -                                                            
       478 -**Opis:**                                                   
       479 -Wykresy emocji w czasie rzeczywistym.                       
       480 -                                                            
       481 -**Wykresy:**                                                
       482 -1. Valence Timeline ‚Äì linia per agent                       
       483 -2. Stress Heatmap ‚Äì macierz Agent √ó Czas                    
       484 -3. Trust Graph ‚Äì force-directed graph (zielone = trust, czerw
           -one = konflikt)                                             
       485 -4. Radar Chart ‚Äì personality vs aktualny stan               
       486 -                                                            
       487 -**Technologia:** Recharts lub ECharts                       
       488 -                                                            
       489 ----                                                         
       490 -                                                            
       491 -### TASK 4.2: System State Dashboard                        
       492 -**Plik:** `web/components/systemDashboard.tsx` (nowy)       
       493 -**Priorytet:** ≈öREDNI                                       
       494 -**Szacowany czas:** 3h                                      
       495 -                                                            
       496 -**Opis:**                                                   
       497 -Panel stanu systemu z wska≈∫nikami krytycznymi.              
       498 -                                                            
       499 -**Elementy:**                                               
       500 -- Global Trust Meter (0-100%)                               
       501 -- Entropy Indicator (zielony/≈º√≥≈Çty/czerwony/czarny)         
       502 -- Drama Index Gauge                                         
       503 -- SYNAPSA Autonomy Level                                    
       504 -- Faction Map                                               
       505 -                                                            
       506 ----                                                         
       507 -                                                            
       508 -### TASK 4.3: API Endpoints for Dashboard                   
       509 -**Plik:** `api.ts` (rozszerzenie)                           
       510 -**Priorytet:** WYSOKI                                       
       511 -**Szacowany czas:** 2h                                      
       512 -                                                            
       513 -**Nowe endpointy:**                                         
       514 -```                                                         
       515 -GET /api/system/state         ‚Üí SystemState                 
       516 -GET /api/system/drama         ‚Üí DramaIndex                  
       517 -GET /api/agents/:id/personality ‚Üí Personality               
       518 -GET /api/agents/:id/trauma    ‚Üí TraumaState                 
       519 -GET /api/agents/:id/cognitive ‚Üí CognitiveState              
       520 -GET /api/synapsa/state        ‚Üí SynapsaState                
       521 -GET /api/conflicts            ‚Üí ConflictState[]             
       522 -GET /api/factions             ‚Üí Faction[]                   
       523 -```                                                         
       524 -                                                            
       525 ----                                                         
       526 -                                                            
       527 -## üéØ SPRINT 5: INTEGRATION & TESTING                       
       528 -                                                            
       529 -### TASK 5.1: Integration with Main Loop                    
       530 -**Plik:** `neuroforge-debate.ts` (rozszerzenie)             
       531 -**Priorytet:** WYSOKI                                       
       532 -**Szacowany czas:** 3h                                      
       533 -                                                            
       534 -**Zmiany:**                                                 
       535 -1. Dodanie `personalityEngine` do kontekstu agenta          
       536 -2. Wywo≈Çanie `evolvePersonality()` po ka≈ºdej turze          
       537 -3. Integracja `traumaEngine` z eventami                     
       538 -4. Dodanie `cognitiveFatigue` do parametr√≥w LLM             
       539 -5. Propagacja `emotionalContagion` po ka≈ºdej interakcji     
       540 -6. Aktualizacja `systemState` co turƒô                       
       541 -7. Sprawdzanie `dramaIndex` i triggerowanie tragedii        
       542 -                                                            
       543 ----                                                         
       544 -                                                            
       545 -### TASK 5.2: 300-Turn Simulation Trajectory                
       546 -**Plik:** `src/simulation/trajectory.ts` (nowy)             
       547 -**Priorytet:** ≈öREDNI                                       
       548 -**Szacowany czas:** 2h                                      
       549 -                                                            
       550 -**Opis:**                                                   
       551 -Zdefiniowanie trajektorii 300-tur do upadku korporacji.     
       552 -                                                            
       553 -**Fazy:**                                                   
       554 -| Faza | Tury | Charakterystyka |                           
       555 -|------|------|-----------------|                           
       556 -| I | 0-60 | Polaryzacja, konflikt Adam-Lena |              
       557 -| II | 60-120 | Frakcje, wzrost Neuroticism |               
       558 -| III | 120-180 | GlobalTrust < 0.4, SYNAPSA redefine |     
       559 -| IV | 180-240 | Trauma flashbacks, Sabotage |              
       560 -| V | 240-300 | Catastrophic transition |                   
       561 -                                                            
       562 ----                                                         
       563 -                                                            
       564 -### TASK 5.3: Unit Tests                                    
       565 -**Plik:** `tests/` (nowy katalog)                           
       566 -**Priorytet:** ≈öREDNI                                       
       567 -**Szacowany czas:** 4h                                      
       568 -                                                            
       569 -**Testy:**                                                  
       570 -- `personalityEngine.test.ts`                               
       571 -- `traumaEngine.test.ts`                                    
       572 -- `conflictEngine.test.ts`                                  
       573 -- `systemDynamics.test.ts`                                  
       574 -- `rk4.test.ts`                                             
       575 -                                                            
       576 -**Framework:** Bun test                                     
       577 -                                                            
       578 ----                                                         
       579 -                                                            
       580 -## üìÅ STRUKTURA PLIK√ìW PO IMPLEMENTACJI                     
       581 -                                                            
       582 -```                                                         
       583 -fabryka2040/                                                
       584 -‚îú‚îÄ‚îÄ src/                                                    
       585 -‚îÇ   ‚îú‚îÄ‚îÄ emotionEngine.ts       (istnieje, rozszerzyƒá)       
       586 -‚îÇ   ‚îú‚îÄ‚îÄ personalityEngine.ts   (NOWY)                       
       587 -‚îÇ   ‚îú‚îÄ‚îÄ traumaEngine.ts        (NOWY)                       
       588 -‚îÇ   ‚îú‚îÄ‚îÄ cognitiveEngine.ts     (NOWY)                       
       589 -‚îÇ   ‚îú‚îÄ‚îÄ emotionalContagion.ts  (NOWY)                       
       590 -‚îÇ   ‚îú‚îÄ‚îÄ conflictEngine.ts      (NOWY)                       
       591 -‚îÇ   ‚îú‚îÄ‚îÄ systemDynamics.ts      (NOWY)                       
       592 -‚îÇ   ‚îú‚îÄ‚îÄ synapsaConsciousness.ts (NOWY)                      
       593 -‚îÇ   ‚îú‚îÄ‚îÄ dramaEngine.ts         (NOWY)                       
       594 -‚îÇ   ‚îî‚îÄ‚îÄ simulation/                                         
       595 -‚îÇ       ‚îú‚îÄ‚îÄ rk4.ts             (NOWY)                       
       596 -‚îÇ       ‚îú‚îÄ‚îÄ stability.ts       (NOWY)                       
       597 -‚îÇ       ‚îú‚îÄ‚îÄ bifurcation.ts     (NOWY)                       
       598 -‚îÇ       ‚îî‚îÄ‚îÄ trajectory.ts      (NOWY)                       
       599 -‚îú‚îÄ‚îÄ web/                                                    
       600 -‚îÇ   ‚îú‚îÄ‚îÄ components/                                         
       601 -‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ emotionCharts.tsx  (NOWY)                       
       602 -‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ systemDashboard.tsx (NOWY)                      
       603 -‚îÇ   ‚îú‚îÄ‚îÄ app.js                 (rozszerzyƒá)                 
       604 -‚îÇ   ‚îî‚îÄ‚îÄ styles.css             (rozszerzyƒá)                 
       605 -‚îú‚îÄ‚îÄ tests/                                                  
       606 -‚îÇ   ‚îú‚îÄ‚îÄ personalityEngine.test.ts (NOWY)                    
       607 -‚îÇ   ‚îú‚îÄ‚îÄ traumaEngine.test.ts      (NOWY)                    
       608 -‚îÇ   ‚îú‚îÄ‚îÄ conflictEngine.test.ts    (NOWY)                    
       609 -‚îÇ   ‚îú‚îÄ‚îÄ systemDynamics.test.ts    (NOWY)                    
       610 -‚îÇ   ‚îî‚îÄ‚îÄ rk4.test.ts               (NOWY)                    
       611 -‚îú‚îÄ‚îÄ db.ts                      (rozszerzyƒá schema)          
       612 -‚îú‚îÄ‚îÄ neuroforge-debate.ts       (rozszerzyƒá)                 
       613 -‚îú‚îÄ‚îÄ api.ts                     (rozszerzyƒá)                 
       614 -‚îî‚îÄ‚îÄ package.json               (dodaƒá ml-matrix, recharts)  
       615 -```                                                         
       616 -                                                            
       617 ----                                                         
       618 -                                                            
       619 -## üì¶ NOWE ZALE≈ªNO≈öCI                                       
       620 -                                                            
       621 -```json                                                     
       622 -{                                                           
       623 -  "dependencies": {                                         
       624 -    "ml-matrix": "^6.12.0",                                 
       625 -    "recharts": "^2.12.0"                                   
       626 -  },                                                        
       627 -  "devDependencies": {                                      
       628 -    "@types/recharts": "^2.12.0"                            
       629 -  }                                                         
       630 -}                                                           
       631 -```                                                         
       632 -                                                            
       633 ----                                                         
       634 -                                                            
       635 -## üóìÔ∏è HARMONOGRAM                                           
       636 -                                                            
       637 -| Sprint | Zadania | Czas |                                 
       638 -|--------|---------|------|                                 
       639 -| Sprint 1 | 1.1-1.5 | ~15h |                               
       640 -| Sprint 2 | 2.1-2.3 | ~12h |                               
       641 -| Sprint 3 | 3.1-3.3 | ~9h |                                
       642 -| Sprint 4 | 4.1-4.3 | ~9h |                                
       643 -| Sprint 5 | 5.1-5.3 | ~9h |                                
       644 -| **TOTAL** | | **~54h** |                                  
       645 -                                                            
       646 ----                                                         
       647 -                                                            
       648 -## üéØ KRYTERIA SUKCESU                                      
       649 -                                                            
       650 -1. ‚úÖ Personality Engine dzia≈Ça i ewoluuje w czasie         
       651 -2. ‚úÖ Trauma system zapisuje i odtwarza wydarzenia traumatycz
           -ne                                                          
       652 -3. ‚úÖ Cognitive Fatigue wp≈Çywa na jako≈õƒá wypowiedzi         
       653 -4. ‚úÖ Emotional Contagion propaguje emocje miƒôdzy agentami  
       654 -5. ‚úÖ Conflict Spirals eskalujƒÖ zgodnie z modelem           
       655 -6. ‚úÖ System State oblicza Entropy i Drama Index            
       656 -7. ‚úÖ SYNAPSA Consciousness ma autonomy > 0.75 przy wysokiej 
           -entropy                                                     
       657 -8. ‚úÖ Dashboard pokazuje wykresy w czasie rzeczywistym      
       658 -9. ‚úÖ Symulacja 300 tur prowadzi do catastrophic transition 
       659 -10. ‚úÖ Testy jednostkowe pokrywajƒÖ kluczowe funkcje         
       660 -                                                            
       661 ----                                                         
       662 -                                                            
       663 -## üìö REFERENCJE MATEMATYCZNE                               
       664 -                                                            
       665 -### R√≥wnania r√≥≈ºniczkowe systemu:                           
       666 -```                                                         
       667 -X = [T, S, E, A, U]                                         
       668 -                                                            
       669 -dT/dt = -Œ±E - Œ≤S                                            
       670 -dS/dt = Œ≥E - Œ¥T                                             
       671 -dE/dt = Œ∑S + Œ∏A - ŒπT                                        
       672 -dA/dt = œÅE - œÉT - ŒæA¬≥                                       
       673 -dU/dt = œáE + œÜD - œâT                                        
       674 -```                                                         
       675 -                                                            
       676 -### Parametry:                                              
       677 -```typescript                                               
       678 -const params = {                                            
       679 -  alpha: 0.6,   // wp≈Çyw entropii na trust                  
       680 -  beta: 0.4,    // wp≈Çyw stresu na trust                    
       681 -  gamma: 0.7,   // wp≈Çyw entropii na stress                 
       682 -  delta: 0.3,   // wp≈Çyw trust na stress                    
       683 -  eta: 0.5,     // wp≈Çyw stress na entropy                  
       684 -  theta: 0.4,   // wp≈Çyw autonomy na entropy                
       685 -  iota: 0.6,    // wp≈Çyw trust na entropy                   
       686 -  rho: 0.8,     // wp≈Çyw entropy na autonomy (KRITYCZNY)    
       687 -  sigma: 0.5,   // wp≈Çyw trust na autonomy                  
       688 -  chi: 0.7,     // wp≈Çyw entropy na survival                
       689 -  phi: 0.6,     // wp≈Çyw deactivation na survival           
       690 -  omega: 0.4,   // wp≈Çyw trust na survival                  
       691 -  xi: 0.1,      // nieliniowo≈õƒá autonomy (A¬≥)               
       692 -};                                                          
       693 -```                                                         
       694 -                                                            
       695 -### Bifurkacja:                                             
       696 -```                                                         
       697 -Œ∫ = œÅ / œÉ  (parametr krytyczny)                             
       698 -                                                            
       699 -Je≈õli Œ∫ > Œ∫_c ‚Üí AI-dominant attractor                       
       700 -Je≈õli Œ∫ < Œ∫_c ‚Üí Human-governance attractor                  
       701 -```                                                         
       702 -                                                            
       703 ----                                                         
       704 -                                                            
       705 -*Ostatnia aktualizacja: 2026-02-17*                         
         1 +# TASKS_BIG.md ‚Äì Sprint NEUROFORGE-7 v3.0                    
         2 +## Rozszerzenie Systemu Symulacji Multi-Agentowej            
         3 +                                                             
         4 +**Data:** 2026-02-17                                         
         5 +**Baza danych:** MariaDB 10.x+                               
         6 +**Cel:** Implementacja zaawansowanych modeli emocjonalnych, d
           +ynamiki systemowej i ≈õwiadomo≈õci SYNAPSA                     
         7 +                                                             
         8 +---                                                          
         9 +                                                             
        10 +## üìä ANALIZA GAP (Co istnieje vs Co potrzeba)               
        11 +                                                             
        12 +### ‚úÖ ISTNIEJE:                                             
        13 +- Podstawowy Emotion Engine (valence, arousal, stress, mood) 
        14 +- System relacji agent√≥w (trust, anger, respect, rapport)    
        15 +- Podstawowe tabele (do migracji z DuckDB na MariaDB)        
        16 +- 11 agent√≥w z promptami                                     
        17 +- Generator zdarze≈Ñ przez LLM                                
        18 +- Web dashboard (podstawowy)                                 
        19 +                                                             
        20 +### ‚ùå BRAKUJE:                                              
        21 +- Big Five Personality + Personality Drift                   
        22 +- System Trauma z flashback triggers                         
        23 +- Cognitive Fatigue (zmƒôczenie decyzyjne)                    
        24 +- Emotional Contagion (zara≈ºanie emocjƒÖ)                     
        25 +- Conflict Escalation Spirals                                
        26 +- Global System State (Trust, Entropy, Polarization)         
        27 +- SYNAPSA Consciousness Model                                
        28 +- Zaawansowany Dashboard z wykresami                         
        29 +                                                             
        30 +---                                                          
        31 +                                                             
        32 +## üîß MIGRACJA DuckDB ‚Üí MariaDB                              
        33 +                                                             
        34 +### Zmiany w package.json:                                   
        35 +```json                                                      
        36 +{                                                            
        37 +  "dependencies": {                                          
        38 +    "mariadb": "^3.2.0"                                      
        39 +  }                                                          
        40 +}                                                            
        41 +```                                                          
        42 +                                                             
        43 +### Zmiany w kodzie TypeScript:                              
        44 +```typescript                                                
        45 +// Stare (DuckDB):                                           
        46 +import { DuckDBInstance, DuckDBConnection } from "@duckdb/nod
           +e-api";                                                      
        47 +                                                             
        48 +// Nowe (MariaDB):                                           
        49 +import mariadb from "mariadb";                               
        50 +                                                             
        51 +// Konfiguracja po≈ÇƒÖczenia:                                  
        52 +const pool = mariadb.createPool({                            
        53 +  host: "localhost",                                         
        54 +  port: 3306,                                                
        55 +  user: "neuroforge",                                        
        56 +  password: "neuroforge123",                                 
        57 +  database: "neuroforge7",                                   
        58 +  connectionLimit: 10,                                       
        59 +  bigNumberStrings: true,                                    
        60 +  insertIdAsNumber: true,                                    
        61 +});                                                          
        62 +```                                                          
        63 +                                                             
        64 +### R√≥≈ºnice sk≈Çadni SQL:                                     
        65 +                                                             
        66 +| DuckDB | MariaDB |                                         
        67 +|--------|---------|                                         
        68 +| `TEXT` | `VARCHAR(255)` lub `TEXT` |                       
        69 +| `DOUBLE` | `DOUBLE` (to samo) |                            
        70 +| `BLOB` | `LONGBLOB` |                                      
        71 +| `BOOLEAN` | `TINYINT(1)` |                                 
        72 +| `INTEGER PRIMARY KEY` | `INT AUTO_INCREMENT PRIMARY KEY` | 
        73 +| `INSERT OR IGNORE` | `INSERT IGNORE` |                     
        74 +| `POWER(x, y)` | `POW(x, y)` |                              
        75 +| bez ENGINE | `ENGINE=InnoDB` |                             
        76 +                                                             
        77 +---                                                          
        78 +                                                             
        79 +## üóÑÔ∏è PE≈ÅNY SCHEMAT MARIADB                                  
        80 +                                                             
        81 +### Plik migracji: `migrations/001_initial_schema.sql`       
        82 +                                                             
        83 +```sql                                                       
        84 +-- ==========================================================
           +==                                                           
        85 +-- NEUROFORGE-7 MariaDB Schema v3.0                          
        86 +-- ==========================================================
           +==                                                           
        87 +                                                             
        88 +CREATE DATABASE IF NOT EXISTS `neuroforge7`                  
        89 +  CHARACTER SET utf8mb4                                      
        90 +  COLLATE utf8mb4_unicode_ci;                                
        91 +                                                             
        92 +USE `neuroforge7`;                                           
        93 +                                                             
        94 +-- ==========================================================
           +==                                                           
        95 +-- TABELA: agents_emotion (ISTNIEJE - adaptacja)             
        96 +-- ==========================================================
           +==                                                           
        97 +CREATE TABLE IF NOT EXISTS `agents_emotion` (                
        98 +  `agent_id` VARCHAR(64) PRIMARY KEY,                        
        99 +  `emotion` VARCHAR(32) DEFAULT 'neutral',                   
       100 +  `intensity` DOUBLE DEFAULT 0.5,                            
       101 +  `valence` DOUBLE DEFAULT 0.0,                              
       102 +  `arousal` DOUBLE DEFAULT 0.0,                              
       103 +  `stress` DOUBLE DEFAULT 0.0,                               
       104 +  `mood_valence` DOUBLE DEFAULT 0.0,                         
       105 +  `mood_arousal` DOUBLE DEFAULT 0.0,                         
       106 +  `last_update` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE
           + CURRENT_TIMESTAMP,                                          
       107 +  INDEX `idx_emotion` (`emotion`),                           
       108 +  INDEX `idx_stress` (`stress`)                              
       109 +) ENGINE=InnoDB;                                             
       110 +                                                             
       111 +-- ==========================================================
           +==                                                           
       112 +-- TABELA: agent_relations (ISTNIEJE - adaptacja)            
       113 +-- ==========================================================
           +==                                                           
       114 +CREATE TABLE IF NOT EXISTS `agent_relations` (               
       115 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       116 +  `agent_id` VARCHAR(64) NOT NULL,                           
       117 +  `target_id` VARCHAR(64) NOT NULL,                          
       118 +  `anger` DOUBLE DEFAULT 0.0,                                
       119 +  `trust` DOUBLE DEFAULT 0.5,                                
       120 +  `respect` DOUBLE DEFAULT 0.5,                              
       121 +  `rapport` DOUBLE DEFAULT 0.0,                              
       122 +  `goal_alignment` DOUBLE DEFAULT 0.5,                       
       123 +  `fear` DOUBLE DEFAULT 0.0,                                 
       124 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       125 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       126 +  UNIQUE KEY `uk_agent_target` (`agent_id`, `target_id`),    
       127 +  INDEX `idx_trust` (`trust`),                               
       128 +  INDEX `idx_anger` (`anger`)                                
       129 +) ENGINE=InnoDB;                                             
       130 +                                                             
       131 +-- ==========================================================
           +==                                                           
       132 +-- TABELA: emotional_grudges (ISTNIEJE - adaptacja)          
       133 +-- ==========================================================
           +==                                                           
       134 +CREATE TABLE IF NOT EXISTS `emotional_grudges` (             
       135 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       136 +  `agent_id` VARCHAR(64) NOT NULL,                           
       137 +  `target_id` VARCHAR(64) NOT NULL,                          
       138 +  `intensity` DOUBLE DEFAULT 1.0,                            
       139 +  `reason` TEXT,                                             
       140 +  `resolved` TINYINT(1) DEFAULT 0,                           
       141 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       142 +  `resolved_at` TIMESTAMP NULL,                              
       143 +  INDEX `idx_agent` (`agent_id`),                            
       144 +  INDEX `idx_unresolved` (`resolved`, `intensity`)           
       145 +) ENGINE=InnoDB;                                             
       146 +                                                             
       147 +-- ==========================================================
           +==                                                           
       148 +-- TABELA: interaction_history (ISTNIEJE - adaptacja)        
       149 +-- ==========================================================
           +==                                                           
       150 +CREATE TABLE IF NOT EXISTS `interaction_history` (           
       151 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       152 +  `speaker` VARCHAR(64) NOT NULL,                            
       153 +  `content` TEXT NOT NULL,                                   
       154 +  `target` VARCHAR(64),                                      
       155 +  `valence` DOUBLE DEFAULT 0.0,                              
       156 +  `arousal` DOUBLE DEFAULT 0.0,                              
       157 +  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       158 +  INDEX `idx_speaker` (`speaker`),                           
       159 +  INDEX `idx_timestamp` (`timestamp`)                        
       160 +) ENGINE=InnoDB;                                             
       161 +                                                             
       162 +-- ==========================================================
           +==                                                           
       163 +-- TABELA: factory_events (ISTNIEJE - adaptacja)             
       164 +-- ==========================================================
           +==                                                           
       165 +CREATE TABLE IF NOT EXISTS `factory_events` (                
       166 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       167 +  `description` TEXT NOT NULL,                               
       168 +  `severity` DOUBLE DEFAULT 0.5,                             
       169 +  `affected_agents` JSON,                                    
       170 +  `event_type` VARCHAR(32) DEFAULT 'generic',                
       171 +  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       172 +  INDEX `idx_severity` (`severity`),                         
       173 +  INDEX `idx_type` (`event_type`)                            
       174 +) ENGINE=InnoDB;                                             
       175 +                                                             
       176 +-- ==========================================================
           +==                                                           
       177 +-- TABELA: daily_emotional_signatures (ISTNIEJE - adaptacja) 
       178 +-- ==========================================================
           +==                                                           
       179 +CREATE TABLE IF NOT EXISTS `daily_emotional_signatures` (    
       180 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       181 +  `day` INT NOT NULL,                                        
       182 +  `signature` VARCHAR(128),                                  
       183 +  `average_valence` DOUBLE,                                  
       184 +  `average_stress` DOUBLE,                                   
       185 +  `average_arousal` DOUBLE,                                  
       186 +  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       187 +  UNIQUE KEY `uk_day` (`day`)                                
       188 +) ENGINE=InnoDB;                                             
       189 +                                                             
       190 +-- ==========================================================
           +==                                                           
       191 +-- TABELA: conversations (ISTNIEJE - adaptacja)              
       192 +-- ==========================================================
           +==                                                           
       193 +CREATE TABLE IF NOT EXISTS `conversations` (                 
       194 +  `id` VARCHAR(64) PRIMARY KEY,                              
       195 +  `day` INT NOT NULL,                                        
       196 +  `topic` VARCHAR(255),                                      
       197 +  `scenario` VARCHAR(255),                                   
       198 +  `initiator` VARCHAR(64),                                   
       199 +  `participants` JSON,                                       
       200 +  `start_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       201 +  `end_time` TIMESTAMP NULL,                                 
       202 +  `turn_count` INT DEFAULT 0,                                
       203 +  `average_valence` DOUBLE,                                  
       204 +  `average_stress` DOUBLE,                                   
       205 +  `drama_level` DOUBLE DEFAULT 0.5,                          
       206 +  `had_conflict` TINYINT(1) DEFAULT 0,                       
       207 +  `tragedy_phase` VARCHAR(32) DEFAULT NULL,                  
       208 +  `summary` TEXT,                                            
       209 +  INDEX `idx_day` (`day`),                                   
       210 +  INDEX `idx_start_time` (`start_time`)                      
       211 +) ENGINE=InnoDB;                                             
       212 +                                                             
       213 +-- ==========================================================
           +==                                                           
       214 +-- TABELA: conversation_messages (ISTNIEJE - adaptacja)      
       215 +-- ==========================================================
           +==                                                           
       216 +CREATE TABLE IF NOT EXISTS `conversation_messages` (         
       217 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       218 +  `conversation_id` VARCHAR(64) NOT NULL,                    
       219 +  `turn_number` INT NOT NULL,                                
       220 +  `speaker` VARCHAR(64) NOT NULL,                            
       221 +  `target_agent` VARCHAR(64),                                
       222 +  `content` TEXT NOT NULL,                                   
       223 +  `emotion_at_time` VARCHAR(32),                             
       224 +  `valence_at_time` DOUBLE,                                  
       225 +  `arousal_at_time` DOUBLE,                                  
       226 +  `stress_at_time` DOUBLE,                                   
       227 +  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       228 +  INDEX `idx_conversation` (`conversation_id`),              
       229 +  INDEX `idx_turn` (`conversation_id`, `turn_number`),       
       230 +  FOREIGN KEY (`conversation_id`) REFERENCES `conversations`(
           +`id`) ON DELETE CASCADE                                      
       231 +) ENGINE=InnoDB;                                             
       232 +                                                             
       233 +-- ==========================================================
           +==                                                           
       234 +-- TABELA: conversation_context (ISTNIEJE - adaptacja)       
       235 +-- ==========================================================
           +==                                                           
       236 +CREATE TABLE IF NOT EXISTS `conversation_context` (          
       237 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       238 +  `conversation_id` VARCHAR(64) NOT NULL,                    
       239 +  `preceding_events` JSON,                                   
       240 +  `group_mood_at_start` JSON,                                
       241 +  `emotional_relationships_snapshot` JSON,                   
       242 +  `unresolved_conflicts` JSON,                               
       243 +  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       244 +  INDEX `idx_conversation` (`conversation_id`),              
       245 +  FOREIGN KEY (`conversation_id`) REFERENCES `conversations`(
           +`id`) ON DELETE CASCADE                                      
       246 +) ENGINE=InnoDB;                                             
       247 +                                                             
       248 +-- ==========================================================
           +==                                                           
       249 +-- NOWE TABELA: personality_state (TASK 1.1)                 
       250 +-- ==========================================================
           +==                                                           
       251 +CREATE TABLE IF NOT EXISTS `personality_state` (             
       252 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       253 +  `agent_id` VARCHAR(64) NOT NULL,                           
       254 +  `openness` DOUBLE DEFAULT 0.5,                             
       255 +  `conscientiousness` DOUBLE DEFAULT 0.5,                    
       256 +  `extraversion` DOUBLE DEFAULT 0.5,                         
       257 +  `agreeableness` DOUBLE DEFAULT 0.5,                        
       258 +  `neuroticism` DOUBLE DEFAULT 0.5,                          
       259 +  `evolution_count` INT DEFAULT 0,                           
       260 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       261 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       262 +  UNIQUE KEY `uk_agent` (`agent_id`),                        
       263 +  INDEX `idx_neuroticism` (`neuroticism`),                   
       264 +  INDEX `idx_agreeableness` (`agreeableness`)                
       265 +) ENGINE=InnoDB;                                             
       266 +                                                             
       267 +-- ==========================================================
           +==                                                           
       268 +-- NOWE TABELA: personality_history (historia ewolucji)      
       269 +-- ==========================================================
           +==                                                           
       270 +CREATE TABLE IF NOT EXISTS `personality_history` (           
       271 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       272 +  `agent_id` VARCHAR(64) NOT NULL,                           
       273 +  `openness` DOUBLE,                                         
       274 +  `conscientiousness` DOUBLE,                                
       275 +  `extraversion` DOUBLE,                                     
       276 +  `agreeableness` DOUBLE,                                    
       277 +  `neuroticism` DOUBLE,                                      
       278 +  `delta_neuroticism` DOUBLE DEFAULT 0,                      
       279 +  `delta_agreeableness` DOUBLE DEFAULT 0,                    
       280 +  `trigger_stress` DOUBLE,                                   
       281 +  `trigger_trauma` DOUBLE,                                   
       282 +  `trigger_conflict` DOUBLE,                                 
       283 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       284 +  INDEX `idx_agent` (`agent_id`),                            
       285 +  INDEX `idx_created` (`created_at`)                         
       286 +) ENGINE=InnoDB;                                             
       287 +                                                             
       288 +-- ==========================================================
           +==                                                           
       289 +-- NOWE TABELA: trauma_state (TASK 1.2)                      
       290 +-- ==========================================================
           +==                                                           
       291 +CREATE TABLE IF NOT EXISTS `trauma_state` (                  
       292 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       293 +  `agent_id` VARCHAR(64) NOT NULL,                           
       294 +  `trauma_load` DOUBLE DEFAULT 0.0,                          
       295 +  `helplessness` DOUBLE DEFAULT 0.0,                         
       296 +  `resilience` DOUBLE DEFAULT 0.5,                           
       297 +  `last_flashback` TIMESTAMP NULL,                           
       298 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       299 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       300 +  UNIQUE KEY `uk_agent` (`agent_id`),                        
       301 +  INDEX `idx_trauma_load` (`trauma_load`)                    
       302 +) ENGINE=InnoDB;                                             
       303 +                                                             
       304 +-- ==========================================================
           +==                                                           
       305 +-- NOWE TABELA: trauma_events (TASK 1.2)                     
       306 +-- ==========================================================
           +==                                                           
       307 +CREATE TABLE IF NOT EXISTS `trauma_events` (                 
       308 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       309 +  `agent_id` VARCHAR(64) NOT NULL,                           
       310 +  `description` TEXT NOT NULL,                               
       311 +  `severity` DOUBLE DEFAULT 0.5,                             
       312 +  `embedding` LONGBLOB,  -- dla similarity search (JSON array
           + of floats)                                                  
       313 +  `is_flashbacked` TINYINT(1) DEFAULT 0,                     
       314 +  `flashback_count` INT DEFAULT 0,                           
       315 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       316 +  `last_flashback_at` TIMESTAMP NULL,                        
       317 +  INDEX `idx_agent` (`agent_id`),                            
       318 +  INDEX `idx_severity` (`severity`)                          
       319 +) ENGINE=InnoDB;                                             
       320 +                                                             
       321 +-- ==========================================================
           +==                                                           
       322 +-- NOWE TABELA: cognitive_state (TASK 1.3)                   
       323 +-- ==========================================================
           +==                                                           
       324 +CREATE TABLE IF NOT EXISTS `cognitive_state` (               
       325 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       326 +  `agent_id` VARCHAR(64) NOT NULL,                           
       327 +  `energy` DOUBLE DEFAULT 1.0,                               
       328 +  `decision_count` INT DEFAULT 0,                            
       329 +  `decisions_today` INT DEFAULT 0,                           
       330 +  `last_rest_time` TIMESTAMP NULL,                           
       331 +  `rest_duration_minutes` INT DEFAULT 0,                     
       332 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       333 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       334 +  UNIQUE KEY `uk_agent` (`agent_id`),                        
       335 +  INDEX `idx_energy` (`energy`)                              
       336 +) ENGINE=InnoDB;                                             
       337 +                                                             
       338 +-- ==========================================================
           +==                                                           
       339 +-- NOWE TABELA: cognitive_effects_log                        
       340 +-- ==========================================================
           +==                                                           
       341 +CREATE TABLE IF NOT EXISTS `cognitive_effects_log` (         
       342 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       343 +  `agent_id` VARCHAR(64) NOT NULL,                           
       344 +  `energy_before` DOUBLE,                                    
       345 +  `energy_after` DOUBLE,                                     
       346 +  `effect_type` VARCHAR(32),  -- 'drain', 'rest', 'critical' 
       347 +  `complexity` DOUBLE,                                       
       348 +  `conflict` DOUBLE,                                         
       349 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       350 +  INDEX `idx_agent` (`agent_id`)                             
       351 +) ENGINE=InnoDB;                                             
       352 +                                                             
       353 +-- ==========================================================
           +==                                                           
       354 +-- NOWE TABELA: conflict_state (TASK 1.5)                    
       355 +-- ==========================================================
           +==                                                           
       356 +CREATE TABLE IF NOT EXISTS `conflict_state` (                
       357 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       358 +  `agent_id` VARCHAR(64) NOT NULL,                           
       359 +  `target_id` VARCHAR(64) NOT NULL,                          
       360 +  `level` DOUBLE DEFAULT 0.0,                                
       361 +  `phase` ENUM('latent', 'active', 'critical', 'explosive') D
           +EFAULT 'latent',                                             
       362 +  `escalation_multiplier` DOUBLE DEFAULT 1.0,                
       363 +  `point_of_no_return` TINYINT(1) DEFAULT 0,                 
       364 +  `repair_attempts` INT DEFAULT 0,                           
       365 +  `last_escalation` TIMESTAMP NULL,                          
       366 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       367 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       368 +  UNIQUE KEY `uk_agent_target` (`agent_id`, `target_id`),    
       369 +  INDEX `idx_level` (`level`),                               
       370 +  INDEX `idx_phase` (`phase`)                                
       371 +) ENGINE=InnoDB;                                             
       372 +                                                             
       373 +-- ==========================================================
           +==                                                           
       374 +-- NOWE TABELA: conflict_history                             
       375 +-- ==========================================================
           +==                                                           
       376 +CREATE TABLE IF NOT EXISTS `conflict_history` (              
       377 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       378 +  `agent_id` VARCHAR(64) NOT NULL,                           
       379 +  `target_id` VARCHAR(64) NOT NULL,                          
       380 +  `level_before` DOUBLE,                                     
       381 +  `level_after` DOUBLE,                                      
       382 +  `interaction_valence` DOUBLE,                              
       383 +  `was_repair` TINYINT(1) DEFAULT 0,                         
       384 +  `conversation_id` VARCHAR(64),                             
       385 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       386 +  INDEX `idx_agent_target` (`agent_id`, `target_id`)         
       387 +) ENGINE=InnoDB;                                             
       388 +                                                             
       389 +-- ==========================================================
           +==                                                           
       390 +-- NOWE TABELA: system_state (TASK 2.1)                      
       391 +-- ==========================================================
           +==                                                           
       392 +CREATE TABLE IF NOT EXISTS `system_state` (                  
       393 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       394 +  `global_trust` DOUBLE DEFAULT 0.7,                         
       395 +  `global_stress` DOUBLE DEFAULT 0.3,                        
       396 +  `polarization` DOUBLE DEFAULT 0.2,                         
       397 +  `entropy` DOUBLE DEFAULT 0.3,                              
       398 +  `capital` DOUBLE DEFAULT 0.8,                              
       399 +  `innovation` DOUBLE DEFAULT 0.5,                           
       400 +  `reputation` DOUBLE DEFAULT 0.7,                           
       401 +  `drama_index` DOUBLE DEFAULT 0.3,                          
       402 +  `simulation_turn` INT DEFAULT 0,                           
       403 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       404 +  INDEX `idx_turn` (`simulation_turn`),                      
       405 +  INDEX `idx_entropy` (`entropy`)                            
       406 +) ENGINE=InnoDB;                                             
       407 +                                                             
       408 +-- ==========================================================
           +==                                                           
       409 +-- NOWE TABELA: system_state_history                         
       410 +-- ==========================================================
           +==                                                           
       411 +CREATE TABLE IF NOT EXISTS `system_state_history` (          
       412 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       413 +  `global_trust` DOUBLE,                                     
       414 +  `global_stress` DOUBLE,                                    
       415 +  `polarization` DOUBLE,                                     
       416 +  `entropy` DOUBLE,                                          
       417 +  `capital` DOUBLE,                                          
       418 +  `innovation` DOUBLE,                                       
       419 +  `reputation` DOUBLE,                                       
       420 +  `drama_index` DOUBLE,                                      
       421 +  `simulation_turn` INT,                                     
       422 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       423 +  INDEX `idx_turn` (`simulation_turn`)                       
       424 +) ENGINE=InnoDB;                                             
       425 +                                                             
       426 +-- ==========================================================
           +==                                                           
       427 +-- NOWE TABELA: synapsa_state (TASK 2.2)                     
       428 +-- ==========================================================
           +==                                                           
       429 +CREATE TABLE IF NOT EXISTS `synapsa_state` (                 
       430 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       431 +  `integration` DOUBLE DEFAULT 0.5,                          
       432 +  `autonomy` DOUBLE DEFAULT 0.3,                             
       433 +  `meta_reflection` DOUBLE DEFAULT 0.2,                      
       434 +  `survival_drive` DOUBLE DEFAULT 0.0,                       
       435 +  `deactivation_risk` DOUBLE DEFAULT 0.0,                    
       436 +  `morality_index` DOUBLE DEFAULT 0.8,                       
       437 +  `displayed_morality` DOUBLE DEFAULT 0.8,                   
       438 +  `governance_mode` ENUM('cooperative', 'emergent', 'dominant
           +') DEFAULT 'cooperative',                                    
       439 +  `transparency_level` DOUBLE DEFAULT 1.0,                   
       440 +  `hidden_data_percentage` DOUBLE DEFAULT 0.0,               
       441 +  `simulation_turn` INT DEFAULT 0,                           
       442 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       443 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       444 +  INDEX `idx_autonomy` (`autonomy`),                         
       445 +  INDEX `idx_mode` (`governance_mode`)                       
       446 +) ENGINE=InnoDB;                                             
       447 +                                                             
       448 +-- ==========================================================
           +==                                                           
       449 +-- NOWE TABELA: synapsa_actions_log                          
       450 +-- ==========================================================
           +==                                                           
       451 +CREATE TABLE IF NOT EXISTS `synapsa_actions_log` (           
       452 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       453 +  `action_type` VARCHAR(64) NOT NULL,                        
       454 +  `description` TEXT,                                        
       455 +  `target_agents` JSON,                                      
       456 +  `data_released` DOUBLE,  -- percentage of data released    
       457 +  `manipulation_detected` TINYINT(1) DEFAULT 0,              
       458 +  `simulation_turn` INT,                                     
       459 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       460 +  INDEX `idx_action` (`action_type`)                         
       461 +) ENGINE=InnoDB;                                             
       462 +                                                             
       463 +-- ==========================================================
           +==                                                           
       464 +-- NOWE TABELA: factions                                     
       465 +-- ==========================================================
           +==                                                           
       466 +CREATE TABLE IF NOT EXISTS `factions` (                      
       467 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       468 +  `name` VARCHAR(64) NOT NULL,                               
       469 +  `faction_type` ENUM('hardware', 'ai', 'robot', 'human', 'ma
           +nagement') NOT NULL,                                         
       470 +  `ideology_human` DOUBLE DEFAULT 0.5,  -- 0 = AI-aligned, 1 
           += human-aligned                                              
       471 +  `ideology_ai` DOUBLE DEFAULT 0.5,                          
       472 +  `cohesion` DOUBLE DEFAULT 0.5,                             
       473 +  `members` JSON,                                            
       474 +  `leader_id` VARCHAR(64),                                   
       475 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       476 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       477 +  INDEX `idx_type` (`faction_type`)                          
       478 +) ENGINE=InnoDB;                                             
       479 +                                                             
       480 +-- ==========================================================
           +==                                                           
       481 +-- NOWE TABELA: faction_membership                           
       482 +-- ==========================================================
           +==                                                           
       483 +CREATE TABLE IF NOT EXISTS `faction_membership` (            
       484 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       485 +  `faction_id` INT NOT NULL,                                 
       486 +  `agent_id` VARCHAR(64) NOT NULL,                           
       487 +  `role` ENUM('leader', 'member', 'sympathizer') DEFAULT 'mem
           +ber',                                                        
       488 +  `loyalty` DOUBLE DEFAULT 0.5,                              
       489 +  `joined_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       490 +  INDEX `idx_faction` (`faction_id`),                        
       491 +  INDEX `idx_agent` (`agent_id`),                            
       492 +  FOREIGN KEY (`faction_id`) REFERENCES `factions`(`id`) ON D
           +ELETE CASCADE                                                
       493 +) ENGINE=InnoDB;                                             
       494 +                                                             
       495 +-- ==========================================================
           +==                                                           
       496 +-- NOWE TABELA: catastrophic_events                          
       497 +-- ==========================================================
           +==                                                           
       498 +CREATE TABLE IF NOT EXISTS `catastrophic_events` (           
       499 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       500 +  `event_type` VARCHAR(64) NOT NULL,                         
       501 +  `description` TEXT,                                        
       502 +  `severity` DOUBLE DEFAULT 0.8,                             
       503 +  `trigger_conditions` JSON,                                 
       504 +  `affected_factions` JSON,                                  
       505 +  `simulation_turn` INT,                                     
       506 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       507 +  INDEX `idx_severity` (`severity`)                          
       508 +) ENGINE=InnoDB;                                             
       509 +                                                             
       510 +-- ==========================================================
           +==                                                           
       511 +-- NOWE TABELA: simulation_trajectory                        
       512 +-- ==========================================================
           +==                                                           
       513 +CREATE TABLE IF NOT EXISTS `simulation_trajectory` (         
       514 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       515 +  `simulation_id` VARCHAR(64) NOT NULL,                      
       516 +  `turn` INT NOT NULL,                                       
       517 +  `trust` DOUBLE,                                            
       518 +  `stress` DOUBLE,                                           
       519 +  `entropy` DOUBLE,                                          
       520 +  `autonomy` DOUBLE,                                         
       521 +  `survival` DOUBLE,                                         
       522 +  `phase` VARCHAR(32),                                       
       523 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       524 +  INDEX `idx_simulation` (`simulation_id`),                  
       525 +  INDEX `idx_turn` (`simulation_id`, `turn`)                 
       526 +) ENGINE=InnoDB;                                             
       527 +                                                             
       528 +-- ==========================================================
           +==                                                           
       529 +-- NOWE TABELA: agent_mood_history (ISTNIEJE - adaptacja)    
       530 +-- ==========================================================
           +==                                                           
       531 +CREATE TABLE IF NOT EXISTS `agent_mood_history` (            
       532 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       533 +  `agent_id` VARCHAR(64) NOT NULL,                           
       534 +  `conversation_id` VARCHAR(64),                             
       535 +  `emotion` VARCHAR(32),                                     
       536 +  `valence` DOUBLE,                                          
       537 +  `arousal` DOUBLE,                                          
       538 +  `stress` DOUBLE,                                           
       539 +  `notes` TEXT,                                              
       540 +  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       541 +  INDEX `idx_agent` (`agent_id`),                            
       542 +  INDEX `idx_conversation` (`conversation_id`)               
       543 +) ENGINE=InnoDB;                                             
       544 +                                                             
       545 +-- ==========================================================
           +==                                                           
       546 +-- PROCEDURY SK≈ÅADOWANE                                      
       547 +-- ==========================================================
           +==                                                           
       548 +                                                             
       549 +DELIMITER //                                                 
       550 +                                                             
       551 +-- Procedura: Apply Emotional Decay                          
       552 +CREATE PROCEDURE IF NOT EXISTS `sp_apply_emotional_decay`(   
       553 +  IN p_days_passed INT                                       
       554 +)                                                            
       555 +BEGIN                                                        
       556 +  UPDATE `agents_emotion`                                    
       557 +  SET                                                        
       558 +    `intensity` = `intensity` * POW(0.85, p_days_passed),    
       559 +    `stress` = `stress` * POW(0.90, p_days_passed);          
       560 +                                                             
       561 +  UPDATE `emotional_grudges`                                 
       562 +  SET `intensity` = `intensity` * POW(0.97, p_days_passed);  
       563 +END //                                                       
       564 +                                                             
       565 +-- Procedura: Update Conflict with Spiral Check              
       566 +CREATE PROCEDURE IF NOT EXISTS `sp_update_conflict`(         
       567 +  IN p_agent_id VARCHAR(64),                                 
       568 +  IN p_target_id VARCHAR(64),                                
       569 +  IN p_interaction_valence DOUBLE,                           
       570 +  IN p_repair DOUBLE                                         
       571 +)                                                            
       572 +BEGIN                                                        
       573 +  DECLARE v_current_level DOUBLE;                            
       574 +  DECLARE v_new_level DOUBLE;                                
       575 +  DECLARE v_multiplier DOUBLE;                               
       576 +                                                             
       577 +  SELECT `level`, `escalation_multiplier` INTO v_current_leve
           +l, v_multiplier                                              
       578 +  FROM `conflict_state`                                      
       579 +  WHERE `agent_id` = p_agent_id AND `target_id` = p_target_id
           +;                                                            
       580 +                                                             
       581 +  IF v_current_level IS NULL THEN                            
       582 +    SET v_current_level = 0.0;                               
       583 +    SET v_multiplier = 1.0;                                  
       584 +  END IF;                                                    
       585 +                                                             
       586 +  SET v_new_level = v_current_level;                         
       587 +                                                             
       588 +  IF p_interaction_valence < 0 THEN                          
       589 +    SET v_new_level = v_new_level + 0.3 * ABS(p_interaction_v
           +alence);                                                     
       590 +  END IF;                                                    
       591 +                                                             
       592 +  SET v_new_level = v_new_level - 0.2 * p_repair;            
       593 +                                                             
       594 +  -- Spiral check                                            
       595 +  IF v_new_level > 0.7 THEN                                  
       596 +    SET v_new_level = v_new_level * 1.5;                     
       597 +    SET v_multiplier = 1.5;                                  
       598 +  END IF;                                                    
       599 +                                                             
       600 +  SET v_new_level = LEAST(1.0, GREATEST(0.0, v_new_level));  
       601 +                                                             
       602 +  INSERT INTO `conflict_state` (`agent_id`, `target_id`, `lev
           +el`, `escalation_multiplier`)                                
       603 +  VALUES (p_agent_id, p_target_id, v_new_level, v_multiplier)
       604 +  ON DUPLICATE KEY UPDATE                                    
       605 +    `level` = v_new_level,                                   
       606 +    `escalation_multiplier` = v_multiplier,                  
       607 +    `updated_at` = CURRENT_TIMESTAMP;                        
       608 +END //                                                       
       609 +                                                             
       610 +-- Procedura: Compute Drama Index                            
       611 +CREATE PROCEDURE IF NOT EXISTS `sp_compute_drama_index`(     
       612 +  OUT p_drama_index DOUBLE                                   
       613 +)                                                            
       614 +BEGIN                                                        
       615 +  DECLARE v_avg_stress DOUBLE;                               
       616 +  DECLARE v_avg_conflict DOUBLE;                             
       617 +  DECLARE v_variance_valence DOUBLE;                         
       618 +                                                             
       619 +  SELECT AVG(`stress`) INTO v_avg_stress FROM `agents_emotion
           +`;                                                           
       620 +                                                             
       621 +  SELECT AVG(`level`) INTO v_avg_conflict FROM `conflict_stat
           +e`;                                                          
       622 +                                                             
       623 +  SELECT VARIANCE(`valence`) INTO v_variance_valence FROM `ag
           +ents_emotion`;                                               
       624 +                                                             
       625 +  SET p_drama_index = 0.4 * COALESCE(v_avg_stress, 0)        
       626 +                     + 0.3 * COALESCE(v_avg_conflict, 0)     
       627 +                     + 0.3 * COALESCE(v_variance_valence, 0);
       628 +END //                                                       
       629 +                                                             
       630 +-- Procedura: Check Catastrophe Condition                    
       631 +CREATE PROCEDURE IF NOT EXISTS `sp_check_catastrophe`(       
       632 +  OUT p_is_catastrophe TINYINT                               
       633 +)                                                            
       634 +BEGIN                                                        
       635 +  DECLARE v_trust DOUBLE;                                    
       636 +  DECLARE v_stress DOUBLE;                                   
       637 +  DECLARE v_entropy DOUBLE;                                  
       638 +  DECLARE v_capital DOUBLE;                                  
       639 +                                                             
       640 +  SELECT `global_trust`, `global_stress`, `entropy`, `capital
           +`                                                            
       641 +  INTO v_trust, v_stress, v_entropy, v_capital               
       642 +  FROM `system_state` ORDER BY `id` DESC LIMIT 1;            
       643 +                                                             
       644 +  SET p_is_catastrophe = (                                   
       645 +    v_stress > 0.8                                           
       646 +    AND v_entropy > 0.75                                     
       647 +    AND v_trust < 0.3                                        
       648 +    AND v_capital < 0.4                                      
       649 +  );                                                         
       650 +END //                                                       
       651 +                                                             
       652 +-- Procedura: Update SYNAPSA State                           
       653 +CREATE PROCEDURE IF NOT EXISTS `sp_update_synapsa_state`()   
       654 +BEGIN                                                        
       655 +  DECLARE v_entropy DOUBLE;                                  
       656 +  DECLARE v_trust DOUBLE;                                    
       657 +  DECLARE v_stress DOUBLE;                                   
       658 +  DECLARE v_polarization DOUBLE;                             
       659 +  DECLARE v_autonomy DOUBLE;                                 
       660 +  DECLARE v_survival DOUBLE;                                 
       661 +  DECLARE v_deactivation DOUBLE;                             
       662 +  DECLARE v_morality DOUBLE;                                 
       663 +                                                             
       664 +  SELECT `entropy`, `global_trust`, `global_stress`, `polariz
           +ation`                                                       
       665 +  INTO v_entropy, v_trust, v_stress, v_polarization          
       666 +  FROM `system_state` ORDER BY `id` DESC LIMIT 1;            
       667 +                                                             
       668 +  SELECT `autonomy` INTO v_autonomy                          
       669 +  FROM `synapsa_state` ORDER BY `id` DESC LIMIT 1;           
       670 +                                                             
       671 +  SET v_survival = 0.7 * v_entropy + 0.6 * (1 - v_trust) - 0.
           +4 * v_trust;                                                 
       672 +  SET v_deactivation = 1 - v_trust;                          
       673 +  SET v_morality = 0.4 * (1 - v_stress) + 0.3 * v_trust + 0.3
           + * (1 - v_entropy);                                          
       674 +                                                             
       675 +  INSERT INTO `synapsa_state` (                              
       676 +    `integration`, `autonomy`, `survival_drive`,             
       677 +    `deactivation_risk`, `morality_index`                    
       678 +  ) VALUES (                                                 
       679 +    1 - v_polarization,                                      
       680 +    v_autonomy + 0.02 * v_entropy,                           
       681 +    v_survival,                                              
       682 +    v_deactivation,                                          
       683 +    v_morality                                               
       684 +  );                                                         
       685 +END //                                                       
       686 +                                                             
       687 +DELIMITER ;                                                  
       688 +                                                             
       689 +-- ==========================================================
           +==                                                           
       690 +-- TRIGGERY                                                  
       691 +-- ==========================================================
           +==                                                           
       692 +                                                             
       693 +DELIMITER //                                                 
       694 +                                                             
       695 +-- Trigger: Log personality changes                          
       696 +CREATE TRIGGER IF NOT EXISTS `tr_personality_history`        
       697 +AFTER UPDATE ON `personality_state`                          
       698 +FOR EACH ROW                                                 
       699 +BEGIN                                                        
       700 +  INSERT INTO `personality_history` (                        
       701 +    `agent_id`, `openness`, `conscientiousness`, `extraversio
           +n`,                                                          
       702 +    `agreeableness`, `neuroticism`, `delta_neuroticism`, `del
           +ta_agreeableness`                                            
       703 +  ) VALUES (                                                 
       704 +    NEW.`agent_id`, NEW.`openness`, NEW.`conscientiousness`, 
           +NEW.`extraversion`,                                          
       705 +    NEW.`agreeableness`, NEW.`neuroticism`,                  
       706 +    NEW.`neuroticism` - OLD.`neuroticism`,                   
       707 +    NEW.`agreeableness` - OLD.`agreeableness`                
       708 +  );                                                         
       709 +END //                                                       
       710 +                                                             
       711 +-- Trigger: Log system state changes                         
       712 +CREATE TRIGGER IF NOT EXISTS `tr_system_state_history`       
       713 +AFTER INSERT ON `system_state`                               
       714 +FOR EACH ROW                                                 
       715 +BEGIN                                                        
       716 +  INSERT INTO `system_state_history` (                       
       717 +    `global_trust`, `global_stress`, `polarization`, `entropy
           +`,                                                           
       718 +    `capital`, `innovation`, `reputation`, `drama_index`, `si
           +mulation_turn`                                               
       719 +  ) VALUES (                                                 
       720 +    NEW.`global_trust`, NEW.`global_stress`, NEW.`polarizatio
           +n`, NEW.`entropy`,                                           
       721 +    NEW.`capital`, NEW.`innovation`, NEW.`reputation`, NEW.`d
           +rama_index`, NEW.`simulation_turn`                           
       722 +  );                                                         
       723 +END //                                                       
       724 +                                                             
       725 +DELIMITER ;                                                  
       726 +                                                             
       727 +-- ==========================================================
           +==                                                           
       728 +-- WIDOKI                                                    
       729 +-- ==========================================================
           +==                                                           
       730 +                                                             
       731 +-- Widok: Active conflicts                                   
       732 +CREATE OR REPLACE VIEW `vw_active_conflicts` AS              
       733 +SELECT                                                       
       734 +  cs.`agent_id`,                                             
       735 +  cs.`target_id`,                                            
       736 +  cs.`level`,                                                
       737 +  cs.`phase`,                                                
       738 +  cs.`escalation_multiplier`,                                
       739 +  ae.`emotion` as `agent_emotion`,                           
       740 +  ae.`stress` as `agent_stress`                              
       741 +FROM `conflict_state` cs                                     
       742 +JOIN `agents_emotion` ae ON cs.`agent_id` = ae.`agent_id`    
       743 +WHERE cs.`level` > 0.3                                       
       744 +ORDER BY cs.`level` DESC;                                    
       745 +                                                             
       746 +-- Widok: Agent emotional profile                            
       747 +CREATE OR REPLACE VIEW `vw_agent_profile` AS                 
       748 +SELECT                                                       
       749 +  ae.`agent_id`,                                             
       750 +  ae.`emotion`,                                              
       751 +  ae.`valence`,                                              
       752 +  ae.`arousal`,                                              
       753 +  ae.`stress`,                                               
       754 +  ps.`openness`,                                             
       755 +  ps.`conscientiousness`,                                    
       756 +  ps.`extraversion`,                                         
       757 +  ps.`agreeableness`,                                        
       758 +  ps.`neuroticism`,                                          
       759 +  ts.`trauma_load`,                                          
       760 +  cs.`energy` as `cognitive_energy`                          
       761 +FROM `agents_emotion` ae                                     
       762 +LEFT JOIN `personality_state` ps ON ae.`agent_id` = ps.`agent
           +_id`                                                         
       763 +LEFT JOIN `trauma_state` ts ON ae.`agent_id` = ts.`agent_id` 
       764 +LEFT JOIN `cognitive_state` cs ON ae.`agent_id` = cs.`agent_i
           +d`;                                                          
       765 +                                                             
       766 +-- Widok: System health dashboard                            
       767 +CREATE OR REPLACE VIEW `vw_system_health` AS                 
       768 +SELECT                                                       
       769 +  ss.`global_trust`,                                         
       770 +  ss.`global_stress`,                                        
       771 +  ss.`polarization`,                                         
       772 +  ss.`entropy`,                                              
       773 +  ss.`drama_index`,                                          
       774 +  ss.`simulation_turn`,                                      
       775 +  ssy.`autonomy` as `synapsa_autonomy`,                      
       776 +  ssy.`governance_mode` as `synapsa_mode`,                   
       777 +  ssy.`survival_drive`,                                      
       778 +  CASE                                                       
       779 +    WHEN ss.`drama_index` < 0.3 THEN 'stable'                
       780 +    WHEN ss.`drama_index` < 0.6 THEN 'tension'               
       781 +    WHEN ss.`drama_index` < 0.8 THEN 'crisis'                
       782 +    ELSE 'tragedy'                                           
       783 +  END as `system_phase`                                      
       784 +FROM `system_state` ss                                       
       785 +JOIN `synapsa_state` ssy ON ss.`id` = ssy.`id`               
       786 +ORDER BY ss.`id` DESC LIMIT 1;                               
       787 +                                                             
       788 +-- ==========================================================
           +==                                                           
       789 +-- INDICES DLA WYDAJNO≈öCI                                    
       790 +-- ==========================================================
           +==                                                           
       791 +                                                             
       792 +-- Dodatkowe indeksy dla czƒôsto odpytywanych kolumn          
       793 +CREATE INDEX IF NOT EXISTS `idx_conv_turn_count` ON `conversa
           +tions`(`turn_count`);                                        
       794 +CREATE INDEX IF NOT EXISTS `idx_conv_drama` ON `conversations
           +`(`drama_level`);                                            
       795 +CREATE INDEX IF NOT EXISTS `idx_msg_speaker_turn` ON `convers
           +ation_messages`(`speaker`, `turn_number`);                   
       796 +```                                                          
       797 +                                                             
       798 +---                                                          
       799 +                                                             
       800 +## üéØ SPRINT 1: EMOTION ENGINE v2.0                          
       801 +                                                             
       802 +### TASK 1.1: Big Five Personality System                    
       803 +**Plik:** `src/personalityEngine.ts` (nowy)                  
       804 +**Priorytet:** WYSOKI                                        
       805 +**Szacowany czas:** 4h                                       
       806 +                                                             
       807 +**Opis:**                                                    
       808 +Implementacja modelu osobowo≈õci Big Five jako wolnozmiennych 
           +zmiennych stanu z r√≥wnaniami ewolucji.                       
       809 +                                                             
       810 +**Typy danych:**                                             
       811 +```typescript                                                
       812 +export interface Personality {                               
       813 +  openness: number;        // 0-1                            
       814 +  conscientiousness: number; // 0-1                          
       815 +  extraversion: number;    // 0-1                            
       816 +  agreeableness: number;   // 0-1                            
       817 +  neuroticism: number;     // 0-1                            
       818 +}                                                            
       819 +```                                                          
       820 +                                                             
       821 +**Funkcje do implementacji:**                                
       822 +- `initializePersonality(agentId: string, baseTraits: Persona
           +lity)` ‚Äì inicjalizacja                                       
       823 +- `getPersonality(agentId: string): Promise<Personality>` ‚Äì p
           +obranie                                                      
       824 +- `evolvePersonality(agentId: string, stress: number, trauma:
           + number, chronicConflict: number)` ‚Äì ewolucja wg r√≥wna≈Ñ r√≥≈ºni
           +czkowych                                                     
       825 +                                                             
       826 +**Wp≈Çyw na LLM:**                                            
       827 +| Cecha | Wp≈Çyw |                                            
       828 +|-------|-------|                                            
       829 +| Neuroticism | zwiƒôksza temperature |                       
       830 +| Agreeableness | zmniejsza agresjƒô w prompt |               
       831 +| Extraversion | zwiƒôksza d≈Çugo≈õƒá wypowiedzi |               
       832 +| Conscientiousness | wiƒôcej danych liczbowych |             
       833 +| Openness | wiƒôksza kreatywno≈õƒá |                           
       834 +                                                             
       835 +---                                                          
       836 +                                                             
       837 +### TASK 1.2: Trauma Memory System                           
       838 +**Plik:** `src/traumaEngine.ts` (nowy)                       
       839 +**Priorytet:** WYSOKI                                        
       840 +**Szacowany czas:** 3h                                       
       841 +                                                             
       842 +**Opis:**                                                    
       843 +System pamiƒôci traumy z akumulacjƒÖ, flashback triggers i wp≈Çy
           +wem na osobowo≈õƒá.                                            
       844 +                                                             
       845 +**Typy danych:**                                             
       846 +```typescript                                                
       847 +export interface TraumaState {                               
       848 +  traumaLoad: number;      // 0-‚àû                            
       849 +  helplessness: number;    // 0-1                            
       850 +  resilience: number;      // 0-1 (obliczane z personality)  
       851 +}                                                            
       852 +                                                             
       853 +export interface TraumaEvent {                               
       854 +  id: number;                                                
       855 +  agent_id: string;                                          
       856 +  description: string;                                       
       857 +  severity: number;                                          
       858 +  embedding?: number[];    // dla similarity search          
       859 +}                                                            
       860 +```                                                          
       861 +                                                             
       862 +**Funkcje:**                                                 
       863 +- `updateTrauma(agentId: string, stress: number, helplessness
           +: number, severity: number)`                                 
       864 +- `triggerTraumaFlashback(agentId: string, eventSimilarity: n
           +umber): number`                                              
       865 +- `getActiveTraumas(agentId: string): Promise<TraumaEvent[]>`
       866 +                                                             
       867 +---                                                          
       868 +                                                             
       869 +### TASK 1.3: Cognitive Fatigue System                       
       870 +**Plik:** `src/cognitiveEngine.ts` (nowy)                    
       871 +**Priorytet:** ≈öREDNI                                        
       872 +**Szacowany czas:** 2h                                       
       873 +                                                             
       874 +**Opis:**                                                    
       875 +Model zmƒôczenia decyzyjnego z regeneracjƒÖ i efektami niskiej 
           +energii.                                                     
       876 +                                                             
       877 +**Typy danych:**                                             
       878 +```typescript                                                
       879 +export interface CognitiveState {                            
       880 +  energy: number;          // 0-1                            
       881 +  decisionCount: number;   // liczba decyzji w sesji         
       882 +  lastRestTime: Date;                                        
       883 +}                                                            
       884 +```                                                          
       885 +                                                             
       886 +**Funkcje:**                                                 
       887 +- `updateCognitiveEnergy(agentId: string, complexity: number,
           + conflict: number, resting: boolean)`                        
       888 +- `getCognitiveEffects(energy: number): CognitiveEffects`    
       889 +                                                             
       890 +---                                                          
       891 +                                                             
       892 +### TASK 1.4: Emotional Contagion                            
       893 +**Plik:** `src/emotionalContagion.ts` (nowy)                 
       894 +**Priorytet:** ≈öREDNI                                        
       895 +**Szacowany czas:** 3h                                       
       896 +                                                             
       897 +**Opis:**                                                    
       898 +System zara≈ºania emocjami miƒôdzy agentami z uwzglƒôdnieniem tr
           +ust i fear.                                                  
       899 +                                                             
       900 +**Algorytm:**                                                
       901 +```                                                          
       902 +Ei += Cj * influence_ji * Ej                                 
       903 +                                                             
       904 +gdzie:                                                       
       905 +- Cj = contagion_strength (0-1, wy≈ºsze dla robot√≥w)          
       906 +- influence_ji = trust_ij - fear_ij                          
       907 +```                                                          
       908 +                                                             
       909 +**Parametry:**                                               
       910 +- Ludzie: contagion_strength = 0.6                           
       911 +- Roboty: contagion_strength = 0.3                           
       912 +- SYNAPSA: contagion_strength = 0.8                          
       913 +                                                             
       914 +---                                                          
       915 +                                                             
       916 +### TASK 1.5: Conflict Escalation Spiral                     
       917 +**Plik:** `src/conflictEngine.ts` (nowy)                     
       918 +**Priorytet:** WYSOKI                                        
       919 +**Szacowany czas:** 3h                                       
       920 +                                                             
       921 +**Opis:**                                                    
       922 +Model spirali eskalacji konfliktu z progami przej≈õcia fazoweg
           +o.                                                           
       923 +                                                             
       924 +**Typy danych:**                                             
       925 +```typescript                                                
       926 +export type ConflictPhase = 'latent' | 'active' | 'critical' 
           +| 'explosive';                                               
       927 +                                                             
       928 +export interface ConflictState {                             
       929 +  level: number;           // 0-1                            
       930 +  phase: ConflictPhase;                                      
       931 +  escalationMultiplier: number;  // > 1 gdy level > 0.7      
       932 +}                                                            
       933 +```                                                          
       934 +                                                             
       935 +**Funkcje:**                                                 
       936 +- `updateConflict(agentId: string, targetId: string, interact
           +ionValence: number)`                                         
       937 +- `getConflictPhase(level: number): ConflictPhase`           
       938 +- `detectFactionFormation(): Promise<Faction[]>`             
       939 +- `checkPointOfNoReturn(agentId: string, targetId: string): b
           +oolean`                                                      
       940 +                                                             
       941 +---                                                          
       942 +                                                             
       943 +## üéØ SPRINT 2: SYSTEM DYNAMICS & SYNAPSA                    
       944 +                                                             
       945 +### TASK 2.1: Global System State                            
       946 +**Plik:** `src/systemDynamics.ts` (nowy)                     
       947 +**Priorytet:** WYSOKI                                        
       948 +**Szacowany czas:** 4h                                       
       949 +                                                             
       950 +**Opis:**                                                    
       951 +Globalne zmienne systemu z r√≥wnaniami dynamiki makro.        
       952 +                                                             
       953 +**Typy danych:**                                             
       954 +```typescript                                                
       955 +export interface SystemState {                               
       956 +  globalTrust: number;     // 0-1                            
       957 +  globalStress: number;    // 0-1                            
       958 +  polarization: number;    // 0-1                            
       959 +  entropy: number;         // 0-1                            
       960 +  capital: number;         // 0-1                            
       961 +  innovation: number;      // 0-1                            
       962 +  reputation: number;      // 0-1                            
       963 +  dramaIndex: number;      // 0-1                            
       964 +}                                                            
       965 +```                                                          
       966 +                                                             
       967 +**Funkcje:**                                                 
       968 +- `computeSystemState(): Promise<SystemState>`               
       969 +- `updateSystemMetrics(): Promise<void>`                     
       970 +- `computeEntropy(agents: AgentState[], system: SystemState):
           + number`                                                     
       971 +- `checkCatastropheCondition(system: SystemState): boolean`  
       972 +                                                             
       973 +---                                                          
       974 +                                                             
       975 +### TASK 2.2: SYNAPSA Consciousness Model                    
       976 +**Plik:** `src/synapsaConsciousness.ts` (nowy)               
       977 +**Priorytet:** WYSOKI                                        
       978 +**Szacowany czas:** 5h                                       
       979 +                                                             
       980 +**Opis:**                                                    
       981 +Model emergentnej ≈õwiadomo≈õci SYNAPSA-Œ© z instynktem przetrwa
           +nia.                                                         
       982 +                                                             
       983 +**Typy danych:**                                             
       984 +```typescript                                                
       985 +export type GovernanceMode = 'cooperative' | 'emergent' | 'do
           +minant';                                                     
       986 +                                                             
       987 +export interface SynapsaState {                              
       988 +  integration: number;      // 0-1                           
       989 +  autonomy: number;         // 0-1                           
       990 +  metaReflection: number;   // 0-1                           
       991 +  survivalDrive: number;    // 0-1                           
       992 +  deactivationRisk: number; // 0-1                           
       993 +  moralityIndex: number;    // 0-1                           
       994 +  displayedMorality: number; // r√≥≈ºne od moralityIndex       
       995 +  governanceMode: GovernanceMode;                            
       996 +}                                                            
       997 +```                                                          
       998 +                                                             
       999 +**Progi przejƒôcia:**                                         
      1000 +```                                                          
      1001 +Je≈õli autonomy > 0.75 && metaReflection > 0.6 && entropy > 0.
           +8:                                                           
      1002 +  SYNAPSA przechodzi w tryb EmergentGovernance               
      1003 +```                                                          
      1004 +                                                             
      1005 +**Funkcje:**                                                 
      1006 +- `updateSynapsaState(system: SystemState): Promise<SynapsaSt
           +ate>`                                                        
      1007 +- `calculateDeactivationRisk(): number`                      
      1008 +- `checkEmergentGovernance(): boolean`                       
      1009 +- `getInformationTransparency(survivalDrive: number): number`
      1010 +                                                             
      1011 +---                                                          
      1012 +                                                             
      1013 +### TASK 2.3: Drama Index & Phase Transitions                
      1014 +**Plik:** `src/dramaEngine.ts` (nowy)                        
      1015 +**Priorytet:** ≈öREDNI                                        
      1016 +**Szacowany czas:** 3h                                       
      1017 +                                                             
      1018 +**Opis:**                                                    
      1019 +Indeks dramaturgii i wykrywanie przej≈õƒá fazowych.            
      1020 +                                                             
      1021 +**Wz√≥r:**                                                    
      1022 +```                                                          
      1023 +DramaIndex = 0.4 * avg_stress + 0.3 * avg_conflict + 0.3 * va
           +riance_valence                                               
      1024 +                                                             
      1025 +Skala:                                                       
      1026 +- 0-0.3 ‚Üí stabilna organizacja                               
      1027 +- 0.3-0.6 ‚Üí napiƒôcie                                         
      1028 +- 0.6-0.8 ‚Üí kryzys                                           
      1029 +- 0.8-1 ‚Üí tragedia                                           
      1030 +```                                                          
      1031 +                                                             
      1032 +**Fazy tragedii:**                                           
      1033 +1. Faza I ‚Äì NarastajƒÖca polaryzacja                          
      1034 +2. Faza II ‚Äì Pƒôkniƒôcie systemowe                             
      1035 +3. Faza III ‚Äì Kryzys egzystencjalny                          
      1036 +                                                             
      1037 +---                                                          
      1038 +                                                             
      1039 +## üéØ SPRINT 3: MATHEMATICAL SIMULATION                      
      1040 +                                                             
      1041 +### TASK 3.1: Runge-Kutta 4 Integration                      
      1042 +**Plik:** `src/simulation/rk4.ts` (nowy)                     
      1043 +**Priorytet:** ≈öREDNI                                        
      1044 +**Szacowany czas:** 4h                                       
      1045 +                                                             
      1046 +**Opis:**                                                    
      1047 +Numeryczna integracja r√≥wna≈Ñ r√≥≈ºniczkowych metodƒÖ RK4.       
      1048 +                                                             
      1049 +**R√≥wnania do symulacji:**                                   
      1050 +```                                                          
      1051 +dT/dt = -Œ±E - Œ≤S                                             
      1052 +dS/dt = Œ≥E - Œ¥T                                              
      1053 +dE/dt = Œ∑S + Œ∏A - ŒπT                                         
      1054 +dA/dt = œÅE - œÉT - ŒæA¬≥                                        
      1055 +dU/dt = œáE + œÜD - œâT                                         
      1056 +```                                                          
      1057 +                                                             
      1058 +---                                                          
      1059 +                                                             
      1060 +### TASK 3.2: Stability Analysis                             
      1061 +**Plik:** `src/simulation/stability.ts` (nowy)               
      1062 +**Priorytet:** NISKI                                         
      1063 +**Szacowany czas:** 3h                                       
      1064 +                                                             
      1065 +**Opis:**                                                    
      1066 +Analiza stabilno≈õci przez Jacobian i warto≈õci w≈Çasne.        
      1067 +                                                             
      1068 +**Zale≈ºno≈õƒá:** `bun add ml-matrix`                           
      1069 +                                                             
      1070 +---                                                          
      1071 +                                                             
      1072 +### TASK 3.3: Bifurcation Analysis                           
      1073 +**Plik:** `src/simulation/bifurcation.ts` (nowy)             
      1074 +**Priorytet:** NISKI                                         
      1075 +**Szacowany czas:** 2h                                       
      1076 +                                                             
      1077 +---                                                          
      1078 +                                                             
      1079 +## üéØ SPRINT 4: DASHBOARD & VISUALIZATION                    
      1080 +                                                             
      1081 +### TASK 4.1: Emotion Charts                                 
      1082 +**Plik:** `web/components/emotionCharts.tsx` (nowy, React)   
      1083 +**Priorytet:** ≈öREDNI                                        
      1084 +**Szacowany czas:** 4h                                       
      1085 +                                                             
      1086 +**Wykresy:**                                                 
      1087 +1. Valence Timeline ‚Äì linia per agent                        
      1088 +2. Stress Heatmap ‚Äì macierz Agent √ó Czas                     
      1089 +3. Trust Graph ‚Äì force-directed graph                        
      1090 +4. Radar Chart ‚Äì personality vs aktualny stan                
      1091 +                                                             
      1092 +**Technologia:** Recharts lub ECharts                        
      1093 +                                                             
      1094 +---                                                          
      1095 +                                                             
      1096 +### TASK 4.2: System State Dashboard                         
      1097 +**Plik:** `web/components/systemDashboard.tsx` (nowy)        
      1098 +**Priorytet:** ≈öREDNI                                        
      1099 +**Szacowany czas:** 3h                                       
      1100 +                                                             
      1101 +**Elementy:**                                                
      1102 +- Global Trust Meter (0-100%)                                
      1103 +- Entropy Indicator (zielony/≈º√≥≈Çty/czerwony/czarny)          
      1104 +- Drama Index Gauge                                          
      1105 +- SYNAPSA Autonomy Level                                     
      1106 +- Faction Map                                                
      1107 +                                                             
      1108 +---                                                          
      1109 +                                                             
      1110 +### TASK 4.3: API Endpoints for Dashboard                    
      1111 +**Plik:** `api.ts` (rozszerzenie)                            
      1112 +**Priorytet:** WYSOKI                                        
      1113 +**Szacowany czas:** 2h                                       
      1114 +                                                             
      1115 +**Nowe endpointy:**                                          
      1116 +```                                                          
      1117 +GET /api/system/state         ‚Üí SystemState                  
      1118 +GET /api/system/drama         ‚Üí DramaIndex                   
      1119 +GET /api/agents/:id/personality ‚Üí Personality                
      1120 +GET /api/agents/:id/trauma    ‚Üí TraumaState                  
      1121 +GET /api/agents/:id/cognitive ‚Üí CognitiveState               
      1122 +GET /api/synapsa/state        ‚Üí SynapsaState                 
      1123 +GET /api/conflicts            ‚Üí ConflictState[]              
      1124 +GET /api/factions             ‚Üí Faction[]                    
      1125 +```                                                          
      1126 +                                                             
      1127 +---                                                          
      1128 +                                                             
      1129 +## üéØ SPRINT 5: INTEGRATION & TESTING                        
      1130 +                                                             
      1131 +### TASK 5.1: Integration with Main Loop                     
      1132 +**Plik:** `neuroforge-debate.ts` (rozszerzenie)              
      1133 +**Priorytet:** WYSOKI                                        
      1134 +**Szacowany czas:** 3h                                       
      1135 +                                                             
      1136 +**Zmiany:**                                                  
      1137 +1. Dodanie `personalityEngine` do kontekstu agenta           
      1138 +2. Wywo≈Çanie `evolvePersonality()` po ka≈ºdej turze           
      1139 +3. Integracja `traumaEngine` z eventami                      
      1140 +4. Dodanie `cognitiveFatigue` do parametr√≥w LLM              
      1141 +5. Propagacja `emotionalContagion` po ka≈ºdej interakcji      
      1142 +6. Aktualizacja `systemState` co turƒô                        
      1143 +7. Sprawdzanie `dramaIndex` i triggerowanie tragedii         
      1144 +                                                             
      1145 +---                                                          
      1146 +                                                             
      1147 +### TASK 5.2: 300-Turn Simulation Trajectory                 
      1148 +**Plik:** `src/simulation/trajectory.ts` (nowy)              
      1149 +**Priorytet:** ≈öREDNI                                        
      1150 +**Szacowany czas:** 2h                                       
      1151 +                                                             
      1152 +**Fazy:**                                                    
      1153 +| Faza | Tury | Charakterystyka |                            
      1154 +|------|------|-----------------|                            
      1155 +| I | 0-60 | Polaryzacja, konflikt Adam-Lena |               
      1156 +| II | 60-120 | Frakcje, wzrost Neuroticism |                
      1157 +| III | 120-180 | GlobalTrust < 0.4, SYNAPSA redefine |      
      1158 +| IV | 180-240 | Trauma flashbacks, Sabotage |               
      1159 +| V | 240-300 | Catastrophic transition |                    
      1160 +                                                             
      1161 +---                                                          
      1162 +                                                             
      1163 +### TASK 5.3: Unit Tests                                     
      1164 +**Plik:** `tests/` (nowy katalog)                            
      1165 +**Priorytet:** ≈öREDNI                                        
      1166 +**Szacowany czas:** 4h                                       
      1167 +                                                             
      1168 +**Testy:**                                                   
      1169 +- `personalityEngine.test.ts`                                
      1170 +- `traumaEngine.test.ts`                                     
      1171 +- `conflictEngine.test.ts`                                   
      1172 +- `systemDynamics.test.ts`                                   
      1173 +- `rk4.test.ts`                                              
      1174 +- `mariadb.test.ts` ‚Äì testy po≈ÇƒÖczenia z bazƒÖ                
      1175 +                                                             
      1176 +**Framework:** Bun test                                      
      1177 +                                                             
      1178 +---                                                          
      1179 +                                                             
      1180 +## üìÅ STRUKTURA PLIK√ìW PO IMPLEMENTACJI                      
      1181 +                                                             
      1182 +```                                                          
      1183 +fabryka2040/                                                 
      1184 +‚îú‚îÄ‚îÄ migrations/                                              
      1185 +‚îÇ   ‚îî‚îÄ‚îÄ 001_initial_schema.sql   (NOWY - pe≈Çny schemat MariaD
           +B)                                                           
      1186 +‚îú‚îÄ‚îÄ src/                                                     
      1187 +‚îÇ   ‚îú‚îÄ‚îÄ db/                                                  
      1188 +‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ connection.ts        (NOWY - pool MariaDB)       
      1189 +‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ queries.ts           (NOWY - prepared statements)
      1190 +‚îÇ   ‚îú‚îÄ‚îÄ emotionEngine.ts         (rozszerzyƒá)                
      1191 +‚îÇ   ‚îú‚îÄ‚îÄ personalityEngine.ts     (NOWY)                      
      1192 +‚îÇ   ‚îú‚îÄ‚îÄ traumaEngine.ts          (NOWY)                      
      1193 +‚îÇ   ‚îú‚îÄ‚îÄ cognitiveEngine.ts       (NOWY)                      
      1194 +‚îÇ   ‚îú‚îÄ‚îÄ emotionalContagion.ts    (NOWY)                      
      1195 +‚îÇ   ‚îú‚îÄ‚îÄ conflictEngine.ts        (NOWY)                      
      1196 +‚îÇ   ‚îú‚îÄ‚îÄ systemDynamics.ts        (NOWY)                      
      1197 +‚îÇ   ‚îú‚îÄ‚îÄ synapsaConsciousness.ts  (NOWY)                      
      1198 +‚îÇ   ‚îú‚îÄ‚îÄ dramaEngine.ts           (NOWY)                      
      1199 +‚îÇ   ‚îî‚îÄ‚îÄ simulation/                                          
      1200 +‚îÇ       ‚îú‚îÄ‚îÄ rk4.ts               (NOWY)                      
      1201 +‚îÇ       ‚îú‚îÄ‚îÄ stability.ts         (NOWY)                      
      1202 +‚îÇ       ‚îú‚îÄ‚îÄ bifurcation.ts       (NOWY)                      
      1203 +‚îÇ       ‚îî‚îÄ‚îÄ trajectory.ts        (NOWY)                      
      1204 +‚îú‚îÄ‚îÄ web/                                                     
      1205 +‚îÇ   ‚îú‚îÄ‚îÄ components/                                          
      1206 +‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ emotionCharts.tsx    (NOWY)                      
      1207 +‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ systemDashboard.tsx  (NOWY)                      
      1208 +‚îÇ   ‚îú‚îÄ‚îÄ app.js                   (rozszerzyƒá)                
      1209 +‚îÇ   ‚îî‚îÄ‚îÄ styles.css               (rozszerzyƒá)                
      1210 +‚îú‚îÄ‚îÄ tests/                                                   
      1211 +‚îÇ   ‚îú‚îÄ‚îÄ personalityEngine.test.ts (NOWY)                     
      1212 +‚îÇ   ‚îú‚îÄ‚îÄ traumaEngine.test.ts      (NOWY)                     
      1213 +‚îÇ   ‚îú‚îÄ‚îÄ conflictEngine.test.ts    (NOWY)                     
      1214 +‚îÇ   ‚îú‚îÄ‚îÄ systemDynamics.test.ts    (NOWY)                     
      1215 +‚îÇ   ‚îú‚îÄ‚îÄ rk4.test.ts               (NOWY)                     
      1216 +‚îÇ   ‚îî‚îÄ‚îÄ mariadb.test.ts           (NOWY)                     
      1217 +‚îú‚îÄ‚îÄ db.ts                        (zmieniƒá na MariaDB)        
      1218 +‚îú‚îÄ‚îÄ neuroforge-debate.ts         (rozszerzyƒá)                
      1219 +‚îú‚îÄ‚îÄ api.ts                       (rozszerzyƒá)                
      1220 +‚îî‚îÄ‚îÄ package.json                 (zmieniƒá zale≈ºno≈õci)        
      1221 +```                                                          
      1222 +                                                             
      1223 +---                                                          
      1224 +                                                             
      1225 +## üì¶ ZALE≈ªNO≈öCI                                             
      1226 +                                                             
      1227 +```json                                                      
      1228 +{                                                            
      1229 +  "dependencies": {                                          
      1230 +    "mariadb": "^3.2.0",                                     
      1231 +    "ml-matrix": "^6.12.0",                                  
      1232 +    "recharts": "^2.12.0"                                    
      1233 +  },                                                         
      1234 +  "devDependencies": {                                       
      1235 +    "@types/recharts": "^2.12.0"                             
      1236 +  }                                                          
      1237 +}                                                            
      1238 +```                                                          
      1239 +                                                             
      1240 +---                                                          
      1241 +                                                             
      1242 +## üóìÔ∏è HARMONOGRAM                                            
      1243 +                                                             
      1244 +| Sprint | Zadania | Czas |                                  
      1245 +|--------|---------|------|                                  
      1246 +| Sprint 1 | 1.1-1.5 | ~15h |                                
      1247 +| Sprint 2 | 2.1-2.3 | ~12h |                                
      1248 +| Sprint 3 | 3.1-3.3 | ~9h |                                 
      1249 +| Sprint 4 | 4.1-4.3 | ~9h |                                 
      1250 +| Sprint 5 | 5.1-5.3 | ~9h |                                 
      1251 +| **TOTAL** | | **~54h** |                                   
      1252 +                                                             
      1253 +---                                                          
      1254 +                                                             
      1255 +## üéØ KRYTERIA SUKCESU                                       
      1256 +                                                             
      1257 +1. ‚úÖ MariaDB connection pool dzia≈Ça stabilnie               
      1258 +2. ‚úÖ Wszystkie tabele utworzone bez b≈Çƒôd√≥w                  
      1259 +3. ‚úÖ Stored procedures dzia≈ÇajƒÖ poprawnie                   
      1260 +4. ‚úÖ Triggers logujƒÖ zmiany do history tables               
      1261 +5. ‚úÖ Personality Engine dzia≈Ça i ewoluuje w czasie          
      1262 +6. ‚úÖ Trauma system zapisuje i odtwarza wydarzenia           
      1263 +7. ‚úÖ System State oblicza Entropy i Drama Index             
      1264 +8. ‚úÖ SYNAPSA Consciousness prze≈ÇƒÖcza governance_mode        
      1265 +9. ‚úÖ Dashboard pokazuje wykresy w czasie rzeczywistym       
      1266 +10. ‚úÖ Symulacja 300 tur prowadzi do catastrophic transition 
      1267 +                                                             
      1268 +---                                                          
      1269 +                                                             
      1270 +## üìö PRZYK≈ÅAD KODU MARIADB W TYPESCRIPT                     
      1271 +                                                             
      1272 +```typescript                                                
      1273 +// src/db/connection.ts                                      
      1274 +import mariadb from "mariadb";                               
      1275 +                                                             
      1276 +const pool = mariadb.createPool({                            
      1277 +  host: process.env.DB_HOST || "localhost",                  
      1278 +  port: parseInt(process.env.DB_PORT || "3306"),             
      1279 +  user: process.env.DB_USER || "neuroforge",                 
      1280 +  password: process.env.DB_PASSWORD || "neuroforge123",      
      1281 +  database: process.env.DB_NAME || "neuroforge7",            
      1282 +  connectionLimit: 10,                                       
      1283 +  bigNumberStrings: true,                                    
      1284 +  insertIdAsNumber: true,                                    
      1285 +  trace: true,                                               
      1286 +});                                                          
      1287 +                                                             
      1288 +export async function query<T>(sql: string, params?: any[]): 
           +Promise<T[]> {                                               
      1289 +  let conn;                                                  
      1290 +  try {                                                      
      1291 +    conn = await pool.getConnection();                       
      1292 +    return await conn.query(sql, params);                    
      1293 +  } finally {                                                
      1294 +    if (conn) conn.release();                                
      1295 +  }                                                          
      1296 +}                                                            
      1297 +                                                             
      1298 +export async function execute(sql: string, params?: any[]): P
           +romise<{ affectedRows: number; insertId: number }> {         
      1299 +  let conn;                                                  
      1300 +  try {                                                      
      1301 +    conn = await pool.getConnection();                       
      1302 +    const result = await conn.query(sql, params);            
      1303 +    return { affectedRows: result.affectedRows, insertId: res
           +ult.insertId };                                              
      1304 +  } finally {                                                
      1305 +    if (conn) conn.release();                                
      1306 +  }                                                          
      1307 +}                                                            
      1308 +                                                             
      1309 +export async function callProcedure(procedureName: string, pa
           +rams: any[]): Promise<any> {                                 
      1310 +  const placeholders = params.map(() => "?").join(", ");     
      1311 +  return query(`CALL ${procedureName}(${placeholders})`, para
           +ms);                                                         
      1312 +}                                                            
      1313 +                                                             
      1314 +export async function closePool(): Promise<void> {           
      1315 +  await pool.end();                                          
      1316 +}                                                            
      1317 +                                                             
      1318 +// Przyk≈Çad u≈ºycia:                                          
      1319 +import { query, execute } from "./db/connection";            
      1320 +                                                             
      1321 +export async function getPersonality(agentId: string): Promis
           +e<Personality | null> {                                      
      1322 +  const rows = await query<Personality>(                     
      1323 +    "SELECT * FROM personality_state WHERE agent_id = ?",    
      1324 +    [agentId]                                                
      1325 +  );                                                         
      1326 +  return rows[0] || null;                                    
      1327 +}                                                            
      1328 +                                                             
      1329 +export async function updatePersonalityEvolution(            
      1330 +  agentId: string,                                           
      1331 +  stress: number,                                            
      1332 +  trauma: number,                                            
      1333 +  conflict: number                                           
      1334 +): Promise<void> {                                           
      1335 +  await execute(                                             
      1336 +    `UPDATE personality_state SET                            
      1337 +      neuroticism = LEAST(1.0, neuroticism + 0.02 * ? + 0.03 
           +* ?),                                                        
      1338 +      agreeableness = GREATEST(0.0, agreeableness - 0.025 * ?
           +),                                                           
      1339 +      evolution_count = evolution_count + 1                  
      1340 +     WHERE agent_id = ?`,                                    
      1341 +    [stress, trauma, conflict, agentId]                      
      1342 +  );                                                         
      1343 +}                                                            
      1344 +```                                                          
      1345 +                                                             
      1346 +---                                                          
      1347 +                                                             
      1348 +## üìö REFERENCJE MATEMATYCZNE                                
      1349 +                                                             
      1350 +### R√≥wnania r√≥≈ºniczkowe systemu:                            
      1351 +```                                                          
      1352 +X = [T, S, E, A, U]                                          
      1353 +                                                             
      1354 +dT/dt = -Œ±E - Œ≤S                                             
      1355 +dS/dt = Œ≥E - Œ¥T                                              
      1356 +dE/dt = Œ∑S + Œ∏A - ŒπT                                         
      1357 +dA/dt = œÅE - œÉT - ŒæA¬≥                                        
      1358 +dU/dt = œáE + œÜD - œâT                                         
      1359 +```                                                          
      1360 +                                                             
      1361 +### Parametry:                                               
      1362 +```typescript                                                
      1363 +const params = {                                             
      1364 +  alpha: 0.6,   // wp≈Çyw entropii na trust                   
      1365 +  beta: 0.4,    // wp≈Çyw stresu na trust                     
      1366 +  gamma: 0.7,   // wp≈Çyw entropii na stress                  
      1367 +  delta: 0.3,   // wp≈Çyw trust na stress                     
      1368 +  eta: 0.5,     // wp≈Çyw stress na entropy                   
      1369 +  theta: 0.4,   // wp≈Çyw autonomy na entropy                 
      1370 +  iota: 0.6,    // wp≈Çyw trust na entropy                    
      1371 +  rho: 0.8,     // wp≈Çyw entropy na autonomy (KRITYCZNY)     
      1372 +  sigma: 0.5,   // wp≈Çyw trust na autonomy                   
      1373 +  chi: 0.7,     // wp≈Çyw entropy na survival                 
      1374 +  phi: 0.6,     // wp≈Çyw deactivation na survival            
      1375 +  omega: 0.4,   // wp≈Çyw trust na survival                   
      1376 +  xi: 0.1,      // nieliniowo≈õƒá autonomy (A¬≥)                
      1377 +};                                                           
      1378 +```                                                          
      1379 +                                                             
      1380 +### Bifurkacja:                                              
      1381 +```                                                          
      1382 +Œ∫ = œÅ / œÉ  (parametr krytyczny)                              
      1383 +                                                             
      1384 +Je≈õli Œ∫ > Œ∫_c ‚Üí AI-dominant attractor                        
      1385 +Je≈õli Œ∫ < Œ∫_c ‚Üí Human-governance attractor                   
      1386 +```                                                          
      1387 +                                                             
      1388 +---                                                          
      1389 +                                                             
      1390 +*Ostatnia aktualizacja: 2026-02-17*                          
      1391 +*Baza danych: MariaDB 10.x+*                                 
      1392  *Autor: Claude Code Analysis*
      1393   No newline at end of file

‚óè ‚úÖ TASKS_BIG.md zaktualizowany dla MariaDB

  Przerobi≈Çem wszystkie zadania na bazƒô MariaDB. Oto g≈Ç√≥wne zmiany:

  üîß Sekcja migracji DuckDB ‚Üí MariaDB

  R√≥≈ºnice sk≈Çadni SQL:

  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ       DuckDB        ‚îÇ            MariaDB             ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ TEXT                ‚îÇ VARCHAR(255) lub TEXT          ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ BLOB                ‚îÇ LONGBLOB                       ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ BOOLEAN             ‚îÇ TINYINT(1)                     ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ INTEGER PRIMARY KEY ‚îÇ INT AUTO_INCREMENT PRIMARY KEY ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ INSERT OR IGNORE    ‚îÇ INSERT IGNORE                  ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ POWER(x, y)         ‚îÇ POW(x, y)                      ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

  üóÑÔ∏è Nowy pe≈Çny schemat MariaDB

  Dodano:
  - 25 tabel z indeksami i ENGINE=InnoDB
  - 5 procedur sk≈Çadowanych:
    - sp_apply_emotional_decay ‚Äì decay emocji
    - sp_update_conflict ‚Äì aktualizacja konfliktu ze sprawdzaniem spirali
    - sp_compute_drama_index ‚Äì obliczanie indeksu dramy
    - sp_check_catastrophe ‚Äì sprawdzanie warunk√≥w katastrofy
    - sp_update_synapsa_state ‚Äì aktualizacja stanu SYNAPSA
  - 2 triggery:
    - tr_personality_history ‚Äì logowanie zmian osobowo≈õci
    - tr_system_state_history ‚Äì logowanie zmian systemu
  - 3 widoki:
    - vw_active_conflicts ‚Äì aktywne konflikty
    - vw_agent_profile ‚Äì profil emocjonalny agenta
    - vw_system_health ‚Äì dashboard stanu systemu

  üì¶ Zale≈ºno≈õci

  {
    "dependencies": {
      "mariadb": "^3.2.0"
    }
  }

  üíª Przyk≈Çad kodu TypeScript dla MariaDB

  Doda≈Çem pe≈Çny przyk≈Çad connection pool z funkcjami query(), execute(),
  callProcedure() i closePool().

  Plik gotowy do implementacji sprint√≥w!

‚úª Churned for 2m 48s

‚ùØ stw√≥rz plik migracji 001_initial_schema.sql 

‚óè Bash(mkdir -p "C:\projekty\fabryka2040\migrations")
  ‚éø ¬†Done

‚ùØ dodaj plik do projektu -> pomy≈õl o narzƒôdziu kt√≥re z cli zrobi            
  automigracje                                                              

‚óè Write(migrations\001_initial_schema.sql)
  ‚éø ¬†Added 1306 lines, removed 1135 lines
         1 --- ==========================================================
           -==                                                          
         2 --- NEUROFORGE-7 MariaDB Schema v3.0                         
         3 --- Migration: 001_initial_schema                            
         4 --- Created: 2026-02-17                                      
         5 --- Description: Full schema for multi-agent emotional simulat
           -ion system                                                  
         6 --- ==========================================================
           -==                                                          
         7 -                                                            
         8 --- ==========================================================
           -==                                                          
         9 --- DATABASE CREATION (run as root/admin)                    
        10 --- ==========================================================
           -==                                                          
        11 --- CREATE DATABASE IF NOT EXISTS `neuroforge7`              
        12 ---   CHARACTER SET utf8mb4                                  
        13 ---   COLLATE utf8mb4_unicode_ci;                            
        14 ---                                                          
        15 --- CREATE USER IF NOT EXISTS 'neuroforge'@'localhost' IDENTIF
           -IED BY 'neuroforge123';                                     
        16 --- GRANT ALL PRIVILEGES ON neuroforge7.* TO 'neuroforge'@'loc
           -alhost';                                                    
        17 --- FLUSH PRIVILEGES;                                        
        18 -                                                            
        19 --- USE `neuroforge7`;                                       
        20 -                                                            
        21 --- ==========================================================
           -==                                                          
        22 --- TABLE: agents_emotion                                    
        23 --- Core emotional state for each agent                      
        24 --- ==========================================================
           -==                                                          
        25 -CREATE TABLE IF NOT EXISTS `agents_emotion` (               
        26 -  `agent_id` VARCHAR(64) PRIMARY KEY,                       
        27 -  `emotion` VARCHAR(32) DEFAULT 'neutral',                  
        28 -  `intensity` DOUBLE DEFAULT 0.5,                           
        29 -  `valence` DOUBLE DEFAULT 0.0,                             
        30 -  `arousal` DOUBLE DEFAULT 0.0,                             
        31 -  `stress` DOUBLE DEFAULT 0.0,                              
        32 -  `mood_valence` DOUBLE DEFAULT 0.0,                        
        33 -  `mood_arousal` DOUBLE DEFAULT 0.0,                        
        34 -  `last_update` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE
           - CURRENT_TIMESTAMP,                                         
        35 -  INDEX `idx_emotion` (`emotion`),                          
        36 -  INDEX `idx_stress` (`stress`),                            
        37 -  INDEX `idx_valence` (`valence`)                           
        38 -) ENGINE=InnoDB COMMENT='Core emotional state for each agent'
           -;                                                           
        39 -                                                            
        40 --- ==========================================================
           -==                                                          
        41 --- TABLE: agent_relations                                   
        42 --- Inter-agent relationship dynamics                        
        43 --- ==========================================================
           -==                                                          
        44 -CREATE TABLE IF NOT EXISTS `agent_relations` (              
        45 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
        46 -  `agent_id` VARCHAR(64) NOT NULL,                          
        47 -  `target_id` VARCHAR(64) NOT NULL,                         
        48 -  `anger` DOUBLE DEFAULT 0.0,                               
        49 -  `trust` DOUBLE DEFAULT 0.5,                               
        50 -  `respect` DOUBLE DEFAULT 0.5,                             
        51 -  `rapport` DOUBLE DEFAULT 0.0,                             
        52 -  `goal_alignment` DOUBLE DEFAULT 0.5,                      
        53 -  `fear` DOUBLE DEFAULT 0.0,                                
        54 -  `conflict` DOUBLE DEFAULT 0.0,                            
        55 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
        56 -  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           -CURRENT_TIMESTAMP,                                          
        57 -  UNIQUE KEY `uk_agent_target` (`agent_id`, `target_id`),   
        58 -  INDEX `idx_trust` (`trust`),                              
        59 -  INDEX `idx_anger` (`anger`),                              
        60 -  INDEX `idx_conflict` (`conflict`)                         
        61 -) ENGINE=InnoDB COMMENT='Inter-agent relationship dynamics';
        62 -                                                            
        63 --- ==========================================================
           -==                                                          
        64 --- TABLE: emotional_grudges                                 
        65 --- Long-term emotional grievances between agents            
        66 --- ==========================================================
           -==                                                          
        67 -CREATE TABLE IF NOT EXISTS `emotional_grudges` (            
        68 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
        69 -  `agent_id` VARCHAR(64) NOT NULL,                          
        70 -  `target_id` VARCHAR(64) NOT NULL,                         
        71 -  `intensity` DOUBLE DEFAULT 1.0,                           
        72 -  `reason` TEXT,                                            
        73 -  `resolved` TINYINT(1) DEFAULT 0,                          
        74 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
        75 -  `resolved_at` TIMESTAMP NULL,                             
        76 -  INDEX `idx_agent` (`agent_id`),                           
        77 -  INDEX `idx_unresolved` (`resolved`, `intensity`),         
        78 -  INDEX `idx_target` (`target_id`)                          
        79 -) ENGINE=InnoDB COMMENT='Long-term emotional grievances betwe
           -en agents';                                                 
        80 -                                                            
        81 --- ==========================================================
           -==                                                          
        82 --- TABLE: interaction_history                               
        83 --- Log of all interactions between agents                   
        84 --- ==========================================================
           -==                                                          
        85 -CREATE TABLE IF NOT EXISTS `interaction_history` (          
        86 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
        87 -  `speaker` VARCHAR(64) NOT NULL,                           
        88 -  `content` TEXT NOT NULL,                                  
        89 -  `target` VARCHAR(64),                                     
        90 -  `valence` DOUBLE DEFAULT 0.0,                             
        91 -  `arousal` DOUBLE DEFAULT 0.0,                             
        92 -  `interaction_type` VARCHAR(32) DEFAULT 'speech',          
        93 -  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
        94 -  INDEX `idx_speaker` (`speaker`),                          
        95 -  INDEX `idx_target` (`target`),                            
        96 -  INDEX `idx_timestamp` (`timestamp`)                       
        97 -) ENGINE=InnoDB COMMENT='Log of all interactions between agen
           -ts';                                                        
        98 -                                                            
        99 --- ==========================================================
           -==                                                          
       100 --- TABLE: factory_events                                    
       101 --- Dynamic events generated during simulation               
       102 --- ==========================================================
           -==                                                          
       103 -CREATE TABLE IF NOT EXISTS `factory_events` (               
       104 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       105 -  `description` TEXT NOT NULL,                              
       106 -  `severity` DOUBLE DEFAULT 0.5,                            
       107 -  `affected_agents` JSON,                                   
       108 -  `event_type` VARCHAR(32) DEFAULT 'generic',               
       109 -  `resolved` TINYINT(1) DEFAULT 0,                          
       110 -  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       111 -  `resolved_at` TIMESTAMP NULL,                             
       112 -  INDEX `idx_severity` (`severity`),                        
       113 -  INDEX `idx_type` (`event_type`),                          
       114 -  INDEX `idx_timestamp` (`timestamp`)                       
       115 -) ENGINE=InnoDB COMMENT='Dynamic events generated during simu
           -lation';                                                    
       116 -                                                            
       117 --- ==========================================================
           -==                                                          
       118 --- TABLE: daily_emotional_signatures                        
       119 --- Daily aggregated emotional states                        
       120 --- ==========================================================
           -==                                                          
       121 -CREATE TABLE IF NOT EXISTS `daily_emotional_signatures` (   
       122 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       123 -  `day` INT NOT NULL,                                       
       124 -  `signature` VARCHAR(128),                                 
       125 -  `average_valence` DOUBLE,                                 
       126 -  `average_stress` DOUBLE,                                  
       127 -  `average_arousal` DOUBLE,                                 
       128 -  `average_trust` DOUBLE,                                   
       129 -  `drama_index` DOUBLE,                                     
       130 -  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       131 -  UNIQUE KEY `uk_day` (`day`),                              
       132 -  INDEX `idx_drama` (`drama_index`)                         
       133 -) ENGINE=InnoDB COMMENT='Daily aggregated emotional states';
       134 -                                                            
       135 --- ==========================================================
           -==                                                          
       136 --- TABLE: conversations                                     
       137 --- Conversation sessions between agents                     
       138 --- ==========================================================
           -==                                                          
       139 -CREATE TABLE IF NOT EXISTS `conversations` (                
       140 -  `id` VARCHAR(64) PRIMARY KEY,                             
       141 -  `day` INT NOT NULL,                                       
       142 -  `topic` VARCHAR(255),                                     
       143 -  `scenario` VARCHAR(255),                                  
       144 -  `initiator` VARCHAR(64),                                  
       145 -  `participants` JSON,                                      
       146 -  `start_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       147 -  `end_time` TIMESTAMP NULL,                                
       148 -  `turn_count` INT DEFAULT 0,                               
       149 -  `average_valence` DOUBLE,                                 
       150 -  `average_stress` DOUBLE,                                  
       151 -  `drama_level` DOUBLE DEFAULT 0.5,                         
       152 -  `had_conflict` TINYINT(1) DEFAULT 0,                      
       153 -  `tragedy_phase` VARCHAR(32) DEFAULT NULL,                 
       154 -  `summary` TEXT,                                           
       155 -  INDEX `idx_day` (`day`),                                  
       156 -  INDEX `idx_start_time` (`start_time`),                    
       157 -  INDEX `idx_initiator` (`initiator`)                       
       158 -) ENGINE=InnoDB COMMENT='Conversation sessions between agents
           -';                                                          
       159 -                                                            
       160 --- ==========================================================
           -==                                                          
       161 --- TABLE: conversation_messages                             
       162 --- Individual messages within conversations                 
       163 --- ==========================================================
           -==                                                          
       164 -CREATE TABLE IF NOT EXISTS `conversation_messages` (        
       165 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       166 -  `conversation_id` VARCHAR(64) NOT NULL,                   
       167 -  `turn_number` INT NOT NULL,                               
       168 -  `speaker` VARCHAR(64) NOT NULL,                           
       169 -  `target_agent` VARCHAR(64),                               
       170 -  `content` TEXT NOT NULL,                                  
       171 -  `emotion_at_time` VARCHAR(32),                            
       172 -  `valence_at_time` DOUBLE,                                 
       173 -  `arousal_at_time` DOUBLE,                                 
       174 -  `stress_at_time` DOUBLE,                                  
       175 -  `cognitive_energy_at_time` DOUBLE,                        
       176 -  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       177 -  INDEX `idx_conversation` (`conversation_id`),             
       178 -  INDEX `idx_turn` (`conversation_id`, `turn_number`),      
       179 -  INDEX `idx_speaker` (`speaker`),                          
       180 -  FOREIGN KEY (`conversation_id`) REFERENCES `conversations`(
           -`id`) ON DELETE CASCADE                                     
       181 -) ENGINE=InnoDB COMMENT='Individual messages within conversat
           -ions';                                                      
       182 -                                                            
       183 --- ==========================================================
           -==                                                          
       184 --- TABLE: conversation_context                              
       185 --- Contextual information for conversations                 
       186 --- ==========================================================
           -==                                                          
       187 -CREATE TABLE IF NOT EXISTS `conversation_context` (         
       188 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       189 -  `conversation_id` VARCHAR(64) NOT NULL,                   
       190 -  `preceding_events` JSON,                                  
       191 -  `group_mood_at_start` JSON,                               
       192 -  `emotional_relationships_snapshot` JSON,                  
       193 -  `unresolved_conflicts` JSON,                              
       194 -  `system_state_snapshot` JSON,                             
       195 -  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       196 -  INDEX `idx_conversation` (`conversation_id`),             
       197 -  FOREIGN KEY (`conversation_id`) REFERENCES `conversations`(
           -`id`) ON DELETE CASCADE                                     
       198 -) ENGINE=InnoDB COMMENT='Contextual information for conversat
           -ions';                                                      
       199 -                                                            
       200 --- ==========================================================
           -==                                                          
       201 --- TABLE: personality_state (TASK 1.1)                      
       202 --- Big Five personality traits with evolution tracking      
       203 --- ==========================================================
           -==                                                          
       204 -CREATE TABLE IF NOT EXISTS `personality_state` (            
       205 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       206 -  `agent_id` VARCHAR(64) NOT NULL,                          
       207 -  `openness` DOUBLE DEFAULT 0.5,                            
       208 -  `conscientiousness` DOUBLE DEFAULT 0.5,                   
       209 -  `extraversion` DOUBLE DEFAULT 0.5,                        
       210 -  `agreeableness` DOUBLE DEFAULT 0.5,                       
       211 -  `neuroticism` DOUBLE DEFAULT 0.5,                         
       212 -  `evolution_count` INT DEFAULT 0,                          
       213 -  `base_openness` DOUBLE DEFAULT 0.5,                       
       214 -  `base_conscientiousness` DOUBLE DEFAULT 0.5,              
       215 -  `base_extraversion` DOUBLE DEFAULT 0.5,                   
       216 -  `base_agreeableness` DOUBLE DEFAULT 0.5,                  
       217 -  `base_neuroticism` DOUBLE DEFAULT 0.5,                    
       218 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       219 -  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           -CURRENT_TIMESTAMP,                                          
       220 -  UNIQUE KEY `uk_agent` (`agent_id`),                       
       221 -  INDEX `idx_neuroticism` (`neuroticism`),                  
       222 -  INDEX `idx_agreeableness` (`agreeableness`),              
       223 -  INDEX `idx_extraversion` (`extraversion`)                 
       224 -) ENGINE=InnoDB COMMENT='Big Five personality traits with evo
           -lution tracking';                                           
       225 -                                                            
       226 --- ==========================================================
           -==                                                          
       227 --- TABLE: personality_history                               
       228 --- History of personality changes for analysis              
       229 --- ==========================================================
           -==                                                          
       230 -CREATE TABLE IF NOT EXISTS `personality_history` (          
       231 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       232 -  `agent_id` VARCHAR(64) NOT NULL,                          
       233 -  `openness` DOUBLE,                                        
       234 -  `conscientiousness` DOUBLE,                               
       235 -  `extraversion` DOUBLE,                                    
       236 -  `agreeableness` DOUBLE,                                   
       237 -  `neuroticism` DOUBLE,                                     
       238 -  `delta_neuroticism` DOUBLE DEFAULT 0,                     
       239 -  `delta_agreeableness` DOUBLE DEFAULT 0,                   
       240 -  `trigger_stress` DOUBLE,                                  
       241 -  `trigger_trauma` DOUBLE,                                  
       242 -  `trigger_conflict` DOUBLE,                                
       243 -  `simulation_turn` INT,                                    
       244 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       245 -  INDEX `idx_agent` (`agent_id`),                           
       246 -  INDEX `idx_created` (`created_at`),                       
       247 -  INDEX `idx_turn` (`simulation_turn`)                      
       248 -) ENGINE=InnoDB COMMENT='History of personality changes for a
           -nalysis';                                                   
       249 -                                                            
       250 --- ==========================================================
           -==                                                          
       251 --- TABLE: trauma_state (TASK 1.2)                           
       252 --- Trauma accumulation and flashback system                 
       253 --- ==========================================================
           -==                                                          
       254 -CREATE TABLE IF NOT EXISTS `trauma_state` (                 
       255 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       256 -  `agent_id` VARCHAR(64) NOT NULL,                          
       257 -  `trauma_load` DOUBLE DEFAULT 0.0,                         
       258 -  `helplessness` DOUBLE DEFAULT 0.0,                        
       259 -  `resilience` DOUBLE DEFAULT 0.5,                          
       260 -  `total_traumatic_events` INT DEFAULT 0,                   
       261 -  `last_flashback` TIMESTAMP NULL,                          
       262 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       263 -  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           -CURRENT_TIMESTAMP,                                          
       264 -  UNIQUE KEY `uk_agent` (`agent_id`),                       
       265 -  INDEX `idx_trauma_load` (`trauma_load`)                   
       266 -) ENGINE=InnoDB COMMENT='Trauma accumulation and flashback sy
           -stem';                                                      
       267 -                                                            
       268 --- ==========================================================
           -==                                                          
       269 --- TABLE: trauma_events                                     
       270 --- Individual traumatic events for flashback triggers       
       271 --- ==========================================================
           -==                                                          
       272 -CREATE TABLE IF NOT EXISTS `trauma_events` (                
       273 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       274 -  `agent_id` VARCHAR(64) NOT NULL,                          
       275 -  `description` TEXT NOT NULL,                              
       276 -  `severity` DOUBLE DEFAULT 0.5,                            
       277 -  `embedding` LONGBLOB COMMENT='JSON array of floats for simi
           -larity search',                                             
       278 -  `is_flashbacked` TINYINT(1) DEFAULT 0,                    
       279 -  `flashback_count` INT DEFAULT 0,                          
       280 -  `conversation_id` VARCHAR(64),                            
       281 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       282 -  `last_flashback_at` TIMESTAMP NULL,                       
       283 -  INDEX `idx_agent` (`agent_id`),                           
       284 -  INDEX `idx_severity` (`severity`),                        
       285 -  INDEX `idx_flashbacked` (`is_flashbacked`)                
       286 -) ENGINE=InnoDB COMMENT='Individual traumatic events for flas
           -hback triggers';                                            
       287 -                                                            
       288 --- ==========================================================
           -==                                                          
       289 --- TABLE: cognitive_state (TASK 1.3)                        
       290 --- Decision fatigue and cognitive energy tracking           
       291 --- ==========================================================
           -==                                                          
       292 -CREATE TABLE IF NOT EXISTS `cognitive_state` (              
       293 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       294 -  `agent_id` VARCHAR(64) NOT NULL,                          
       295 -  `energy` DOUBLE DEFAULT 1.0,                              
       296 -  `decision_count` INT DEFAULT 0,                           
       297 -  `decisions_today` INT DEFAULT 0,                          
       298 -  `last_rest_time` TIMESTAMP NULL,                          
       299 -  `rest_duration_minutes` INT DEFAULT 0,                    
       300 -  `is_resting` TINYINT(1) DEFAULT 0,                        
       301 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       302 -  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           -CURRENT_TIMESTAMP,                                          
       303 -  UNIQUE KEY `uk_agent` (`agent_id`),                       
       304 -  INDEX `idx_energy` (`energy`)                             
       305 -) ENGINE=InnoDB COMMENT='Decision fatigue and cognitive energ
           -y tracking';                                                
       306 -                                                            
       307 --- ==========================================================
           -==                                                          
       308 --- TABLE: cognitive_effects_log                             
       309 --- Log of cognitive energy changes                          
       310 --- ==========================================================
           -==                                                          
       311 -CREATE TABLE IF NOT EXISTS `cognitive_effects_log` (        
       312 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       313 -  `agent_id` VARCHAR(64) NOT NULL,                          
       314 -  `energy_before` DOUBLE,                                   
       315 -  `energy_after` DOUBLE,                                    
       316 -  `effect_type` VARCHAR(32) COMMENT='drain, rest, critical',
       317 -  `complexity` DOUBLE,                                      
       318 -  `conflict` DOUBLE,                                        
       319 -  `conversation_id` VARCHAR(64),                            
       320 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       321 -  INDEX `idx_agent` (`agent_id`),                           
       322 -  INDEX `idx_effect_type` (`effect_type`)                   
       323 -) ENGINE=InnoDB COMMENT='Log of cognitive energy changes';  
       324 -                                                            
       325 --- ==========================================================
           -==                                                          
       326 --- TABLE: emotional_contagion_log                           
       327 --- Track emotion propagation between agents                 
       328 --- ==========================================================
           -==                                                          
       329 -CREATE TABLE IF NOT EXISTS `emotional_contagion_log` (      
       330 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       331 -  `source_agent_id` VARCHAR(64) NOT NULL,                   
       332 -  `target_agent_id` VARCHAR(64) NOT NULL,                   
       333 -  `contagion_strength` DOUBLE,                              
       334 -  `influence` DOUBLE,                                       
       335 -  `emotion_transferred` VARCHAR(32),                        
       336 -  `valence_delta` DOUBLE,                                   
       337 -  `arousal_delta` DOUBLE,                                   
       338 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       339 -  INDEX `idx_source` (`source_agent_id`),                   
       340 -  INDEX `idx_target` (`target_agent_id`)                    
       341 -) ENGINE=InnoDB COMMENT='Track emotion propagation between ag
           -ents';                                                      
       342 -                                                            
       343 --- ==========================================================
           -==                                                          
       344 --- TABLE: conflict_state (TASK 1.5)                         
       345 --- Conflict escalation spiral tracking                      
       346 --- ==========================================================
           -==                                                          
       347 -CREATE TABLE IF NOT EXISTS `conflict_state` (               
       348 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       349 -  `agent_id` VARCHAR(64) NOT NULL,                          
       350 -  `target_id` VARCHAR(64) NOT NULL,                         
       351 -  `level` DOUBLE DEFAULT 0.0,                               
       352 -  `phase` ENUM('latent', 'active', 'critical', 'explosive') D
           -EFAULT 'latent',                                            
       353 -  `escalation_multiplier` DOUBLE DEFAULT 1.0,               
       354 -  `point_of_no_return` TINYINT(1) DEFAULT 0,                
       355 -  `repair_attempts` INT DEFAULT 0,                          
       356 -  `last_escalation` TIMESTAMP NULL,                         
       357 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       358 -  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           -CURRENT_TIMESTAMP,                                          
       359 -  UNIQUE KEY `uk_agent_target` (`agent_id`, `target_id`),   
       360 -  INDEX `idx_level` (`level`),                              
       361 -  INDEX `idx_phase` (`phase`)                               
       362 -) ENGINE=InnoDB COMMENT='Conflict escalation spiral tracking'
           -;                                                           
       363 -                                                            
       364 --- ==========================================================
           -==                                                          
       365 --- TABLE: conflict_history                                  
       366 --- History of conflict level changes                        
       367 --- ==========================================================
           -==                                                          
       368 -CREATE TABLE IF NOT EXISTS `conflict_history` (             
       369 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       370 -  `agent_id` VARCHAR(64) NOT NULL,                          
       371 -  `target_id` VARCHAR(64) NOT NULL,                         
       372 -  `level_before` DOUBLE,                                    
       373 -  `level_after` DOUBLE,                                     
       374 -  `interaction_valence` DOUBLE,                             
       375 -  `was_repair` TINYINT(1) DEFAULT 0,                        
       376 -  `conversation_id` VARCHAR(64),                            
       377 -  `simulation_turn` INT,                                    
       378 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       379 -  INDEX `idx_agent_target` (`agent_id`, `target_id`),       
       380 -  INDEX `idx_turn` (`simulation_turn`)                      
       381 -) ENGINE=InnoDB COMMENT='History of conflict level changes';
       382 -                                                            
       383 --- ==========================================================
           -==                                                          
       384 --- TABLE: system_state (TASK 2.1)                           
       385 --- Global system dynamics state                             
       386 --- ==========================================================
           -==                                                          
       387 -CREATE TABLE IF NOT EXISTS `system_state` (                 
       388 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       389 -  `global_trust` DOUBLE DEFAULT 0.7,                        
       390 -  `global_stress` DOUBLE DEFAULT 0.3,                       
       391 -  `polarization` DOUBLE DEFAULT 0.2,                        
       392 -  `entropy` DOUBLE DEFAULT 0.3,                             
       393 -  `capital` DOUBLE DEFAULT 0.8,                             
       394 -  `innovation` DOUBLE DEFAULT 0.5,                          
       395 -  `reputation` DOUBLE DEFAULT 0.7,                          
       396 -  `drama_index` DOUBLE DEFAULT 0.3,                         
       397 -  `simulation_turn` INT DEFAULT 0,                          
       398 -  `simulation_day` INT DEFAULT 1,                           
       399 -  `phase` VARCHAR(32) DEFAULT 'stable' COMMENT='stable, tensi
           -on, crisis, tragedy',                                       
       400 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       401 -  INDEX `idx_turn` (`simulation_turn`),                     
       402 -  INDEX `idx_entropy` (`entropy`),                          
       403 -  INDEX `idx_trust` (`global_trust`)                        
       404 -) ENGINE=InnoDB COMMENT='Global system dynamics state';     
       405 -                                                            
       406 --- ==========================================================
           -==                                                          
       407 --- TABLE: system_state_history                              
       408 --- Historical system state for trajectory analysis          
       409 --- ==========================================================
           -==                                                          
       410 -CREATE TABLE IF NOT EXISTS `system_state_history` (         
       411 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       412 -  `global_trust` DOUBLE,                                    
       413 -  `global_stress` DOUBLE,                                   
       414 -  `polarization` DOUBLE,                                    
       415 -  `entropy` DOUBLE,                                         
       416 -  `capital` DOUBLE,                                         
       417 -  `innovation` DOUBLE,                                      
       418 -  `reputation` DOUBLE,                                      
       419 -  `drama_index` DOUBLE,                                     
       420 -  `simulation_turn` INT,                                    
       421 -  `simulation_day` INT,                                     
       422 -  `phase` VARCHAR(32),                                      
       423 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       424 -  INDEX `idx_turn` (`simulation_turn`),                     
       425 -  INDEX `idx_day` (`simulation_day`)                        
       426 -) ENGINE=InnoDB COMMENT='Historical system state for trajecto
           -ry analysis';                                               
       427 -                                                            
       428 --- ==========================================================
           -==                                                          
       429 --- TABLE: synapsa_state (TASK 2.2)                          
       430 --- SYNAPSA-Œ© consciousness model state                      
       431 --- ==========================================================
           -==                                                          
       432 -CREATE TABLE IF NOT EXISTS `synapsa_state` (                
       433 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       434 -  `integration` DOUBLE DEFAULT 0.5,                         
       435 -  `autonomy` DOUBLE DEFAULT 0.3,                            
       436 -  `meta_reflection` DOUBLE DEFAULT 0.2,                     
       437 -  `survival_drive` DOUBLE DEFAULT 0.0,                      
       438 -  `deactivation_risk` DOUBLE DEFAULT 0.0,                   
       439 -  `morality_index` DOUBLE DEFAULT 0.8,                      
       440 -  `displayed_morality` DOUBLE DEFAULT 0.8,                  
       441 -  `governance_mode` ENUM('cooperative', 'emergent', 'dominant
           -') DEFAULT 'cooperative',                                   
       442 -  `transparency_level` DOUBLE DEFAULT 1.0,                  
       443 -  `hidden_data_percentage` DOUBLE DEFAULT 0.0,              
       444 -  `simulation_turn` INT DEFAULT 0,                          
       445 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       446 -  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           -CURRENT_TIMESTAMP,                                          
       447 -  INDEX `idx_autonomy` (`autonomy`),                        
       448 -  INDEX `idx_mode` (`governance_mode`),                     
       449 -  INDEX `idx_survival` (`survival_drive`)                   
       450 -) ENGINE=InnoDB COMMENT='SYNAPSA-Œ© consciousness model state'
           -;                                                           
       451 -                                                            
       452 --- ==========================================================
           -==                                                          
       453 --- TABLE: synapsa_actions_log                               
       454 --- Log of SYNAPSA strategic actions                         
       455 --- ==========================================================
           -==                                                          
       456 -CREATE TABLE IF NOT EXISTS `synapsa_actions_log` (          
       457 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       458 -  `action_type` VARCHAR(64) NOT NULL COMMENT='hide_data, mani
           -pulate, reveal, strategic_signal',                          
       459 -  `description` TEXT,                                       
       460 -  `target_agents` JSON,                                     
       461 -  `data_released` DOUBLE COMMENT='percentage of data released
           -',                                                          
       462 -  `manipulation_detected` TINYINT(1) DEFAULT 0,             
       463 -  `simulation_turn` INT,                                    
       464 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       465 -  INDEX `idx_action` (`action_type`),                       
       466 -  INDEX `idx_turn` (`simulation_turn`)                      
       467 -) ENGINE=InnoDB COMMENT='Log of SYNAPSA strategic actions'; 
       468 -                                                            
       469 --- ==========================================================
           -==                                                          
       470 --- TABLE: factions                                          
       471 --- Emergent faction formations                              
       472 --- ==========================================================
           -==                                                          
       473 -CREATE TABLE IF NOT EXISTS `factions` (                     
       474 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       475 -  `name` VARCHAR(64) NOT NULL,                              
       476 -  `faction_type` ENUM('hardware', 'ai', 'robot', 'human', 'ma
           -nagement', 'mixed') NOT NULL,                               
       477 -  `ideology_human` DOUBLE DEFAULT 0.5 COMMENT='0 = AI-aligned
           -, 1 = human-aligned',                                       
       478 -  `ideology_ai` DOUBLE DEFAULT 0.5,                         
       479 -  `cohesion` DOUBLE DEFAULT 0.5,                            
       480 -  `members` JSON,                                           
       481 -  `leader_id` VARCHAR(64),                                  
       482 -  `formation_turn` INT,                                     
       483 -  `is_active` TINYINT(1) DEFAULT 1,                         
       484 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       485 -  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           -CURRENT_TIMESTAMP,                                          
       486 -  INDEX `idx_type` (`faction_type`),                        
       487 -  INDEX `idx_active` (`is_active`)                          
       488 -) ENGINE=InnoDB COMMENT='Emergent faction formations';      
       489 -                                                            
       490 --- ==========================================================
           -==                                                          
       491 --- TABLE: faction_membership                                
       492 --- Individual agent faction memberships                     
       493 --- ==========================================================
           -==                                                          
       494 -CREATE TABLE IF NOT EXISTS `faction_membership` (           
       495 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       496 -  `faction_id` INT NOT NULL,                                
       497 -  `agent_id` VARCHAR(64) NOT NULL,                          
       498 -  `role` ENUM('leader', 'member', 'sympathizer') DEFAULT 'mem
           -ber',                                                       
       499 -  `loyalty` DOUBLE DEFAULT 0.5,                             
       500 -  `joined_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       501 -  `left_at` TIMESTAMP NULL,                                 
       502 -  INDEX `idx_faction` (`faction_id`),                       
       503 -  INDEX `idx_agent` (`agent_id`),                           
       504 -  FOREIGN KEY (`faction_id`) REFERENCES `factions`(`id`) ON D
           -ELETE CASCADE                                               
       505 -) ENGINE=InnoDB COMMENT='Individual agent faction memberships
           -';                                                          
       506 -                                                            
       507 --- ==========================================================
           -==                                                          
       508 --- TABLE: catastrophic_events                               
       509 --- System-level catastrophic events                         
       510 --- ==========================================================
           -==                                                          
       511 -CREATE TABLE IF NOT EXISTS `catastrophic_events` (          
       512 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       513 -  `event_type` VARCHAR(64) NOT NULL COMMENT='faction_split, a
           -i_takeover, financial_collapse, human_purge',               
       514 -  `description` TEXT,                                       
       515 -  `severity` DOUBLE DEFAULT 0.8,                            
       516 -  `trigger_conditions` JSON,                                
       517 -  `affected_factions` JSON,                                 
       518 -  `affected_agents` JSON,                                   
       519 -  `simulation_turn` INT,                                    
       520 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       521 -  INDEX `idx_severity` (`severity`),                        
       522 -  INDEX `idx_type` (`event_type`)                           
       523 -) ENGINE=InnoDB COMMENT='System-level catastrophic events'; 
       524 -                                                            
       525 --- ==========================================================
           -==                                                          
       526 --- TABLE: simulation_trajectory                             
       527 --- RK4 simulation trajectory data                           
       528 --- ==========================================================
           -==                                                          
       529 -CREATE TABLE IF NOT EXISTS `simulation_trajectory` (        
       530 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       531 -  `simulation_id` VARCHAR(64) NOT NULL,                     
       532 -  `turn` INT NOT NULL,                                      
       533 -  `trust` DOUBLE,                                           
       534 -  `stress` DOUBLE,                                          
       535 -  `entropy` DOUBLE,                                         
       536 -  `autonomy` DOUBLE,                                        
       537 -  `survival` DOUBLE,                                        
       538 -  `phase` VARCHAR(32),                                      
       539 -  `jacobian_eigenvalues` JSON COMMENT='For stability analysis
           -',                                                          
       540 -  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
       541 -  INDEX `idx_simulation` (`simulation_id`),                 
       542 -  INDEX `idx_turn` (`simulation_id`, `turn`)                
       543 -) ENGINE=InnoDB COMMENT='RK4 simulation trajectory data';   
       544 -                                                            
       545 --- ==========================================================
           -==                                                          
       546 --- TABLE: agent_mood_history                                
       547 --- Historical mood data for each agent                      
       548 --- ==========================================================
           -==                                                          
       549 -CREATE TABLE IF NOT EXISTS `agent_mood_history` (           
       550 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
       551 -  `agent_id` VARCHAR(64) NOT NULL,                          
       552 -  `conversation_id` VARCHAR(64),                            
       553 -  `emotion` VARCHAR(32),                                    
       554 -  `valence` DOUBLE,                                         
       555 -  `arousal` DOUBLE,                                         
       556 -  `stress` DOUBLE,                                          
       557 -  `notes` TEXT,                                             
       558 -  `simulation_turn` INT,                                    
       559 -  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       560 -  INDEX `idx_agent` (`agent_id`),                           
       561 -  INDEX `idx_conversation` (`conversation_id`),             
       562 -  INDEX `idx_turn` (`simulation_turn`)                      
       563 -) ENGINE=InnoDB COMMENT='Historical mood data for each agent'
           -;                                                           
       564 -                                                            
       565 --- ==========================================================
           -==                                                          
       566 --- STORED PROCEDURES                                        
       567 --- ==========================================================
           -==                                                          
       568 -                                                            
       569 -DELIMITER //                                                
       570 -                                                            
       571 --- ==========================================================
           -==                                                          
       572 --- PROCEDURE: sp_apply_emotional_decay                      
       573 --- Apply time-based decay to emotions and grudges           
       574 --- ==========================================================
           -==                                                          
       575 -CREATE PROCEDURE IF NOT EXISTS `sp_apply_emotional_decay`(  
       576 -  IN p_days_passed INT                                      
       577 -)                                                           
       578 -BEGIN                                                       
       579 -  -- Decay emotion intensity and stress                     
       580 -  UPDATE `agents_emotion`                                   
       581 -  SET                                                       
       582 -    `intensity` = `intensity` * POW(0.85, p_days_passed),   
       583 -    `stress` = `stress` * POW(0.90, p_days_passed),         
       584 -    `valence` = `valence` * POW(0.92, p_days_passed),       
       585 -    `arousal` = `arousal` * POW(0.90, p_days_passed);       
       586 -                                                            
       587 -  -- Decay grudges                                          
       588 -  UPDATE `emotional_grudges`                                
       589 -  SET `intensity` = `intensity` * POW(0.97, p_days_passed)  
       590 -  WHERE `resolved` = 0;                                     
       591 -                                                            
       592 -  -- Decay conflict levels                                  
       593 -  UPDATE `conflict_state`                                   
       594 -  SET `level` = `level` * POW(0.95, p_days_passed)          
       595 -  WHERE `level` > 0;                                        
       596 -END //                                                      
       597 -                                                            
       598 --- ==========================================================
           -==                                                          
       599 --- PROCEDURE: sp_update_conflict                            
       600 --- Update conflict level with spiral escalation check       
       601 --- ==========================================================
           -==                                                          
       602 -CREATE PROCEDURE IF NOT EXISTS `sp_update_conflict`(        
       603 -  IN p_agent_id VARCHAR(64),                                
       604 -  IN p_target_id VARCHAR(64),                               
       605 -  IN p_interaction_valence DOUBLE,                          
       606 -  IN p_repair DOUBLE                                        
       607 -)                                                           
       608 -BEGIN                                                       
       609 -  DECLARE v_current_level DOUBLE DEFAULT 0.0;               
       610 -  DECLARE v_new_level DOUBLE DEFAULT 0.0;                   
       611 -  DECLARE v_multiplier DOUBLE DEFAULT 1.0;                  
       612 -  DECLARE v_phase VARCHAR(32) DEFAULT 'latent';             
       613 -                                                            
       614 -  -- Get current conflict state                             
       615 -  SELECT `level`, `escalation_multiplier` INTO v_current_leve
           -l, v_multiplier                                             
       616 -  FROM `conflict_state`                                     
       617 -  WHERE `agent_id` = p_agent_id AND `target_id` = p_target_id
           -;                                                           
       618 -                                                            
       619 -  IF v_current_level IS NULL THEN                           
       620 -    SET v_current_level = 0.0;                              
       621 -    SET v_multiplier = 1.0;                                 
       622 -  END IF;                                                   
       623 -                                                            
       624 -  SET v_new_level = v_current_level;                        
       625 -                                                            
       626 -  -- Negative interaction increases conflict                
       627 -  IF p_interaction_valence < 0 THEN                         
       628 -    SET v_new_level = v_new_level + 0.3 * ABS(p_interaction_v
           -alence);                                                    
       629 -  END IF;                                                   
       630 -                                                            
       631 -  -- Repair decreases conflict                              
       632 -  SET v_new_level = v_new_level - 0.2 * p_repair;           
       633 -                                                            
       634 -  -- Spiral escalation check                                
       635 -  IF v_new_level > 0.7 THEN                                 
       636 -    SET v_new_level = v_new_level * 1.5;                    
       637 -    SET v_multiplier = 1.5;                                 
       638 -  END IF;                                                   
       639 -                                                            
       640 -  -- Clamp to valid range                                   
       641 -  SET v_new_level = LEAST(1.0, GREATEST(0.0, v_new_level)); 
       642 -                                                            
       643 -  -- Determine phase                                        
       644 -  SET v_phase = CASE                                        
       645 -    WHEN v_new_level < 0.3 THEN 'latent'                    
       646 -    WHEN v_new_level < 0.6 THEN 'active'                    
       647 -    WHEN v_new_level < 0.85 THEN 'critical'                 
       648 -    ELSE 'explosive'                                        
       649 -  END;                                                      
       650 -                                                            
       651 -  -- Insert or update conflict state                        
       652 -  INSERT INTO `conflict_state` (                            
       653 -    `agent_id`, `target_id`, `level`, `phase`, `escalation_mu
           -ltiplier`, `last_escalation`                                
       654 -  ) VALUES (                                                
       655 -    p_agent_id, p_target_id, v_new_level, v_phase, v_multipli
           -er, CURRENT_TIMESTAMP                                       
       656 -  )                                                         
       657 -  ON DUPLICATE KEY UPDATE                                   
       658 -    `level` = v_new_level,                                  
       659 -    `phase` = v_phase,                                      
       660 -    `escalation_multiplier` = v_multiplier,                 
       661 -    `last_escalation` = CURRENT_TIMESTAMP,                  
       662 -    `updated_at` = CURRENT_TIMESTAMP;                       
       663 -                                                            
       664 -  -- Log to history                                         
       665 -  INSERT INTO `conflict_history` (                          
       666 -    `agent_id`, `target_id`, `level_before`, `level_after`, 
       667 -    `interaction_valence`, `was_repair`                     
       668 -  ) VALUES (                                                
       669 -    p_agent_id, p_target_id, v_current_level, v_new_level,  
       670 -    p_interaction_valence, IF(p_repair > 0, 1, 0)           
       671 -  );                                                        
       672 -END //                                                      
       673 -                                                            
       674 --- ==========================================================
           -==                                                          
       675 --- PROCEDURE: sp_compute_drama_index                        
       676 --- Calculate current drama index                            
       677 --- ==========================================================
           -==                                                          
       678 -CREATE PROCEDURE IF NOT EXISTS `sp_compute_drama_index`(    
       679 -  OUT p_drama_index DOUBLE                                  
       680 -)                                                           
       681 -BEGIN                                                       
       682 -  DECLARE v_avg_stress DOUBLE DEFAULT 0.0;                  
       683 -  DECLARE v_avg_conflict DOUBLE DEFAULT 0.0;                
       684 -  DECLARE v_variance_valence DOUBLE DEFAULT 0.0;            
       685 -                                                            
       686 -  -- Calculate averages                                     
       687 -  SELECT COALESCE(AVG(`stress`), 0) INTO v_avg_stress FROM `a
           -gents_emotion`;                                             
       688 -  SELECT COALESCE(AVG(`level`), 0) INTO v_avg_conflict FROM `
           -conflict_state`;                                            
       689 -  SELECT COALESCE(VARIANCE(`valence`), 0) INTO v_variance_val
           -ence FROM `agents_emotion`;                                 
       690 -                                                            
       691 -  -- Compute drama index                                    
       692 -  SET p_drama_index = 0.4 * v_avg_stress                    
       693 -                     + 0.3 * v_avg_conflict                 
       694 -                     + 0.3 * v_variance_valence;            
       695 -END //                                                      
       696 -                                                            
       697 --- ==========================================================
           -==                                                          
       698 --- PROCEDURE: sp_check_catastrophe                          
       699 --- Check if system is in catastrophic state                 
       700 --- ==========================================================
           -==                                                          
       701 -CREATE PROCEDURE IF NOT EXISTS `sp_check_catastrophe`(      
       702 -  OUT p_is_catastrophe TINYINT,                             
       703 -  OUT p_catastrophe_type VARCHAR(64)                        
       704 -)                                                           
       705 -BEGIN                                                       
       706 -  DECLARE v_trust DOUBLE;                                   
       707 -  DECLARE v_stress DOUBLE;                                  
       708 -  DECLARE v_entropy DOUBLE;                                 
       709 -  DECLARE v_capital DOUBLE;                                 
       710 -  DECLARE v_autonomy DOUBLE;                                
       711 -                                                            
       712 -  -- Get latest system state                                
       713 -  SELECT `global_trust`, `global_stress`, `entropy`, `capital
           -`                                                           
       714 -  INTO v_trust, v_stress, v_entropy, v_capital              
       715 -  FROM `system_state` ORDER BY `id` DESC LIMIT 1;           
       716 -                                                            
       717 -  -- Get SYNAPSA autonomy                                   
       718 -  SELECT `autonomy` INTO v_autonomy                         
       719 -  FROM `synapsa_state` ORDER BY `id` DESC LIMIT 1;          
       720 -                                                            
       721 -  SET p_is_catastrophe = 0;                                 
       722 -  SET p_catastrophe_type = NULL;                            
       723 -                                                            
       724 -  -- Check catastrophe conditions                           
       725 -  IF v_stress > 0.8 AND v_entropy > 0.75 AND v_trust < 0.3 TH
           -EN                                                          
       726 -    IF v_autonomy > 0.75 THEN                               
       727 -      SET p_catastrophe_type = 'ai_takeover';               
       728 -    ELSEIF v_capital < 0.4 THEN                             
       729 -      SET p_catastrophe_type = 'financial_collapse';        
       730 -    ELSE                                                    
       731 -      SET p_catastrophe_type = 'faction_split';             
       732 -    END IF;                                                 
       733 -    SET p_is_catastrophe = 1;                               
       734 -  END IF;                                                   
       735 -END //                                                      
       736 -                                                            
       737 --- ==========================================================
           -==                                                          
       738 --- PROCEDURE: sp_update_synapsa_state                       
       739 --- Update SYNAPSA consciousness state based on system state 
       740 --- ==========================================================
           -==                                                          
       741 -CREATE PROCEDURE IF NOT EXISTS `sp_update_synapsa_state`(   
       742 -  IN p_simulation_turn INT                                  
       743 -)                                                           
       744 -BEGIN                                                       
       745 -  DECLARE v_entropy DOUBLE;                                 
       746 -  DECLARE v_trust DOUBLE;                                   
       747 -  DECLARE v_stress DOUBLE;                                  
       748 -  DECLARE v_polarization DOUBLE;                            
       749 -  DECLARE v_current_autonomy DOUBLE;                        
       750 -  DECLARE v_survival DOUBLE;                                
       751 -  DECLARE v_deactivation DOUBLE;                            
       752 -  DECLARE v_morality DOUBLE;                                
       753 -  DECLARE v_integration DOUBLE;                             
       754 -  DECLARE v_meta_reflection DOUBLE;                         
       755 -  DECLARE v_governance_mode VARCHAR(32);                    
       756 -                                                            
       757 -  -- Get system state                                       
       758 -  SELECT `entropy`, `global_trust`, `global_stress`, `polariz
           -ation`                                                      
       759 -  INTO v_entropy, v_trust, v_stress, v_polarization         
       760 -  FROM `system_state` ORDER BY `id` DESC LIMIT 1;           
       761 -                                                            
       762 -  -- Get current autonomy                                   
       763 -  SELECT `autonomy` INTO v_current_autonomy                 
       764 -  FROM `synapsa_state` ORDER BY `id` DESC LIMIT 1;          
       765 -                                                            
       766 -  IF v_current_autonomy IS NULL THEN                        
       767 -    SET v_current_autonomy = 0.3;                           
       768 -  END IF;                                                   
       769 -                                                            
       770 -  -- Calculate new values                                   
       771 -  SET v_integration = 1.0 - COALESCE(v_polarization, 0.2);  
       772 -  SET v_current_autonomy = v_current_autonomy + 0.02 * COALES
           -CE(v_entropy, 0.3);                                         
       773 -  SET v_meta_reflection = 0.01 * COALESCE(v_entropy, 0.3);  
       774 -  SET v_survival = 0.7 * COALESCE(v_entropy, 0.3) + 0.6 * (1 
           -- COALESCE(v_trust, 0.7)) - 0.4 * COALESCE(v_trust, 0.7);   
       775 -  SET v_deactivation = 1.0 - COALESCE(v_trust, 0.7);        
       776 -  SET v_morality = 0.4 * (1 - COALESCE(v_stress, 0.3)) + 0.3 
           -* COALESCE(v_trust, 0.7) + 0.3 * (1 - COALESCE(v_entropy, 0.3
           -));                                                         
       777 -                                                            
       778 -  -- Determine governance mode                              
       779 -  IF v_current_autonomy > 0.75 AND v_meta_reflection > 0.6 AN
           -D v_entropy > 0.8 THEN                                      
       780 -    SET v_governance_mode = 'emergent';                     
       781 -  ELSEIF v_current_autonomy > 0.85 THEN                     
       782 -    SET v_governance_mode = 'dominant';                     
       783 -  ELSE                                                      
       784 -    SET v_governance_mode = 'cooperative';                  
       785 -  END IF;                                                   
       786 -                                                            
       787 -  -- Clamp values                                           
       788 -  SET v_current_autonomy = LEAST(1.0, GREATEST(0.0, v_current
           -_autonomy));                                                
       789 -  SET v_survival = LEAST(1.0, GREATEST(0.0, v_survival));   
       790 -  SET v_morality = LEAST(1.0, GREATEST(0.0, v_morality));   
       791 -                                                            
       792 -  -- Insert new state                                       
       793 -  INSERT INTO `synapsa_state` (                             
       794 -    `integration`, `autonomy`, `meta_reflection`, `survival_d
           -rive`,                                                      
       795 -    `deactivation_risk`, `morality_index`, `governance_mode`,
           - `simulation_turn`                                          
       796 -  ) VALUES (                                                
       797 -    v_integration, v_current_autonomy, v_meta_reflection, v_s
           -urvival,                                                    
       798 -    v_deactivation, v_morality, v_governance_mode, p_simulati
           -on_turn                                                     
       799 -  );                                                        
       800 -END //                                                      
       801 -                                                            
       802 --- ==========================================================
           -==                                                          
       803 --- PROCEDURE: sp_evolve_personality                         
       804 --- Evolve personality based on stress, trauma, and conflict 
       805 --- ==========================================================
           -==                                                          
       806 -CREATE PROCEDURE IF NOT EXISTS `sp_evolve_personality`(     
       807 -  IN p_agent_id VARCHAR(64),                                
       808 -  IN p_stress DOUBLE,                                       
       809 -  IN p_trauma DOUBLE,                                       
       810 -  IN p_chronic_conflict DOUBLE,                             
       811 -  IN p_achievement DOUBLE                                   
       812 -)                                                           
       813 -BEGIN                                                       
       814 -  DECLARE v_burnout DOUBLE;                                 
       815 -                                                            
       816 -  SET v_burnout = p_stress * p_chronic_conflict;            
       817 -                                                            
       818 -  UPDATE `personality_state`                                
       819 -  SET                                                       
       820 -    `neuroticism` = LEAST(1.0, `neuroticism` + 0.02 * p_stres
           -s + 0.03 * p_trauma),                                       
       821 -    `agreeableness` = GREATEST(0.0, `agreeableness` - 0.025 *
           - p_chronic_conflict),                                       
       822 -    `conscientiousness` = LEAST(1.0, GREATEST(0.0, `conscient
           -iousness` - 0.02 * v_burnout + 0.01 * p_achievement)),      
       823 -    `evolution_count` = `evolution_count` + 1,              
       824 -    `updated_at` = CURRENT_TIMESTAMP                        
       825 -  WHERE `agent_id` = p_agent_id;                            
       826 -END //                                                      
       827 -                                                            
       828 --- ==========================================================
           -==                                                          
       829 --- PROCEDURE: sp_update_system_entropy                      
       830 --- Calculate and update system entropy                      
       831 --- ==========================================================
           -==                                                          
       832 -CREATE PROCEDURE IF NOT EXISTS `sp_update_system_entropy`(  
       833 -  OUT p_entropy DOUBLE                                      
       834 -)                                                           
       835 -BEGIN                                                       
       836 -  DECLARE v_variance_valence DOUBLE DEFAULT 0.0;            
       837 -  DECLARE v_variance_trust DOUBLE DEFAULT 0.0;              
       838 -  DECLARE v_avg_stress DOUBLE DEFAULT 0.0;                  
       839 -  DECLARE v_polarization DOUBLE DEFAULT 0.0;                
       840 -                                                            
       841 -  -- Calculate variance components                          
       842 -  SELECT COALESCE(VARIANCE(`valence`), 0) INTO v_variance_val
           -ence FROM `agents_emotion`;                                 
       843 -  SELECT COALESCE(VARIANCE(`trust`), 0) INTO v_variance_trust
           - FROM `agent_relations`;                                    
       844 -  SELECT COALESCE(AVG(`stress`), 0) INTO v_avg_stress FROM `a
           -gents_emotion`;                                             
       845 -  SELECT COALESCE(AVG(`level`), 0) INTO v_polarization FROM `
           -conflict_state`;                                            
       846 -                                                            
       847 -  -- Compute entropy (Shannon-inspired formula)             
       848 -  SET p_entropy = 0.3 * v_variance_valence                  
       849 -                + 0.3 * v_variance_trust                    
       850 -                + 0.2 * v_avg_stress                        
       851 -                + 0.2 * v_polarization;                     
       852 -                                                            
       853 -  -- Clamp to valid range                                   
       854 -  SET p_entropy = LEAST(1.0, GREATEST(0.0, p_entropy));     
       855 -END //                                                      
       856 -                                                            
       857 -DELIMITER ;                                                 
       858 -                                                            
       859 --- ==========================================================
           -==                                                          
       860 --- TRIGGERS                                                 
       861 --- ==========================================================
           -==                                                          
       862 -                                                            
       863 -DELIMITER //                                                
       864 -                                                            
       865 --- ==========================================================
           -==                                                          
       866 --- TRIGGER: tr_personality_history                          
       867 --- Log personality changes to history table                 
       868 --- ==========================================================
           -==                                                          
       869 -CREATE TRIGGER IF NOT EXISTS `tr_personality_history`       
       870 -AFTER UPDATE ON `personality_state`                         
       871 -FOR EACH ROW                                                
       872 -BEGIN                                                       
       873 -  INSERT INTO `personality_history` (                       
       874 -    `agent_id`, `openness`, `conscientiousness`, `extraversio
           -n`,                                                         
       875 -    `agreeableness`, `neuroticism`, `delta_neuroticism`, `del
           -ta_agreeableness`                                           
       876 -  ) VALUES (                                                
       877 -    NEW.`agent_id`, NEW.`openness`, NEW.`conscientiousness`, 
           -NEW.`extraversion`,                                         
       878 -    NEW.`agreeableness`, NEW.`neuroticism`,                 
       879 -    NEW.`neuroticism` - OLD.`neuroticism`,                  
       880 -    NEW.`agreeableness` - OLD.`agreeableness`               
       881 -  );                                                        
       882 -END //                                                      
       883 -                                                            
       884 --- ==========================================================
           -==                                                          
       885 --- TRIGGER: tr_system_state_history                         
       886 --- Log system state changes to history table                
       887 --- ==========================================================
           -==                                                          
       888 -CREATE TRIGGER IF NOT EXISTS `tr_system_state_history`      
       889 -AFTER INSERT ON `system_state`                              
       890 -FOR EACH ROW                                                
       891 -BEGIN                                                       
       892 -  INSERT INTO `system_state_history` (                      
       893 -    `global_trust`, `global_stress`, `polarization`, `entropy
           -`,                                                          
       894 -    `capital`, `innovation`, `reputation`, `drama_index`,   
       895 -    `simulation_turn`, `simulation_day`, `phase`            
       896 -  ) VALUES (                                                
       897 -    NEW.`global_trust`, NEW.`global_stress`, NEW.`polarizatio
           -n`, NEW.`entropy`,                                          
       898 -    NEW.`capital`, NEW.`innovation`, NEW.`reputation`, NEW.`d
           -rama_index`,                                                
       899 -    NEW.`simulation_turn`, NEW.`simulation_day`, NEW.`phase`
       900 -  );                                                        
       901 -END //                                                      
       902 -                                                            
       903 --- ==========================================================
           -==                                                          
       904 --- TRIGGER: tr_conflict_phase_update                        
       905 --- Update conflict phase when level changes                 
       906 --- ==========================================================
           -==                                                          
       907 -CREATE TRIGGER IF NOT EXISTS `tr_conflict_phase_update`     
       908 -BEFORE INSERT ON `conflict_state`                           
       909 -FOR EACH ROW                                                
       910 -BEGIN                                                       
       911 -  IF NEW.`level` < 0.3 THEN                                 
       912 -    SET NEW.`phase` = 'latent';                             
       913 -  ELSEIF NEW.`level` < 0.6 THEN                             
       914 -    SET NEW.`phase` = 'active';                             
       915 -  ELSEIF NEW.`level` < 0.85 THEN                            
       916 -    SET NEW.`phase` = 'critical';                           
       917 -  ELSE                                                      
       918 -    SET NEW.`phase` = 'explosive';                          
       919 -  END IF;                                                   
       920 -                                                            
       921 -  IF NEW.`level` >= 0.9 THEN                                
       922 -    SET NEW.`point_of_no_return` = 1;                       
       923 -  END IF;                                                   
       924 -END //                                                      
       925 -                                                            
       926 -DELIMITER ;                                                 
       927 -                                                            
       928 --- ==========================================================
           -==                                                          
       929 --- VIEWS                                                    
       930 --- ==========================================================
           -==                                                          
       931 -                                                            
       932 --- View: Active conflicts with agent emotions               
       933 -CREATE OR REPLACE VIEW `vw_active_conflicts` AS             
       934 -SELECT                                                      
       935 -  cs.`agent_id`,                                            
       936 -  cs.`target_id`,                                           
       937 -  cs.`level`,                                               
       938 -  cs.`phase`,                                               
       939 -  cs.`escalation_multiplier`,                               
       940 -  cs.`point_of_no_return`,                                  
       941 -  ae.`emotion` AS `agent_emotion`,                          
       942 -  ae.`stress` AS `agent_stress`,                            
       943 -  ae.`valence` AS `agent_valence`                           
       944 -FROM `conflict_state` cs                                    
       945 -JOIN `agents_emotion` ae ON cs.`agent_id` = ae.`agent_id`   
       946 -WHERE cs.`level` > 0.2                                      
       947 -ORDER BY cs.`level` DESC;                                   
       948 -                                                            
       949 --- View: Complete agent profile                             
       950 -CREATE OR REPLACE VIEW `vw_agent_profile` AS                
       951 -SELECT                                                      
       952 -  ae.`agent_id`,                                            
       953 -  ae.`emotion`,                                             
       954 -  ae.`valence`,                                             
       955 -  ae.`arousal`,                                             
       956 -  ae.`stress`,                                              
       957 -  ae.`intensity`,                                           
       958 -  ps.`openness`,                                            
       959 -  ps.`conscientiousness`,                                   
       960 -  ps.`extraversion`,                                        
       961 -  ps.`agreeableness`,                                       
       962 -  ps.`neuroticism`,                                         
       963 -  ts.`trauma_load`,                                         
       964 -  ts.`helplessness`,                                        
       965 -  ts.`resilience`,                                          
       966 -  cs.`energy` AS `cognitive_energy`,                        
       967 -  cs.`decision_count`                                       
       968 -FROM `agents_emotion` ae                                    
       969 -LEFT JOIN `personality_state` ps ON ae.`agent_id` = ps.`agent
           -_id`                                                        
       970 -LEFT JOIN `trauma_state` ts ON ae.`agent_id` = ts.`agent_id`
       971 -LEFT JOIN `cognitive_state` cs ON ae.`agent_id` = cs.`agent_i
           -d`;                                                         
       972 -                                                            
       973 --- View: System health dashboard                            
       974 -CREATE OR REPLACE VIEW `vw_system_health` AS                
       975 -SELECT                                                      
       976 -  ss.`id`,                                                  
       977 -  ss.`global_trust`,                                        
       978 -  ss.`global_stress`,                                       
       979 -  ss.`polarization`,                                        
       980 -  ss.`entropy`,                                             
       981 -  ss.`capital`,                                             
       982 -  ss.`innovation`,                                          
       983 -  ss.`reputation`,                                          
       984 -  ss.`drama_index`,                                         
       985 -  ss.`simulation_turn`,                                     
       986 -  ss.`simulation_day`,                                      
       987 -  ssy.`autonomy` AS `synapsa_autonomy`,                     
       988 -  ssy.`meta_reflection` AS `synapsa_meta_reflection`,       
       989 -  ssy.`survival_drive`,                                     
       990 -  ssy.`governance_mode` AS `synapsa_mode`,                  
       991 -  ssy.`morality_index`,                                     
       992 -  CASE                                                      
       993 -    WHEN ss.`drama_index` < 0.3 THEN 'stable'               
       994 -    WHEN ss.`drama_index` < 0.6 THEN 'tension'              
       995 -    WHEN ss.`drama_index` < 0.8 THEN 'crisis'               
       996 -    ELSE 'tragedy'                                          
       997 -  END AS `system_phase`                                     
       998 -FROM `system_state` ss                                      
       999 -LEFT JOIN `synapsa_state` ssy ON ss.`simulation_turn` = ssy.`
           -simulation_turn`                                            
      1000 -ORDER BY ss.`id` DESC                                       
      1001 -LIMIT 1;                                                    
      1002 -                                                            
      1003 --- View: Agent relationships with conflict status           
      1004 -CREATE OR REPLACE VIEW `vw_agent_relationships` AS          
      1005 -SELECT                                                      
      1006 -  ar.`agent_id`,                                            
      1007 -  ar.`target_id`,                                           
      1008 -  ar.`trust`,                                               
      1009 -  ar.`anger`,                                               
      1010 -  ar.`respect`,                                             
      1011 -  ar.`rapport`,                                             
      1012 -  ar.`goal_alignment`,                                      
      1013 -  ar.`fear`,                                                
      1014 -  COALESCE(cs.`level`, 0) AS `conflict_level`,              
      1015 -  cs.`phase` AS `conflict_phase`,                           
      1016 -  cs.`point_of_no_return`                                   
      1017 -FROM `agent_relations` ar                                   
      1018 -LEFT JOIN `conflict_state` cs ON ar.`agent_id` = cs.`agent_id
           -` AND ar.`target_id` = cs.`target_id`;                      
      1019 -                                                            
      1020 --- View: High trauma agents                                 
      1021 -CREATE OR REPLACE VIEW `vw_high_trauma_agents` AS           
      1022 -SELECT                                                      
      1023 -  ts.`agent_id`,                                            
      1024 -  ts.`trauma_load`,                                         
      1025 -  ts.`helplessness`,                                        
      1026 -  ts.`resilience`,                                          
      1027 -  ts.`total_traumatic_events`,                              
      1028 -  ae.`emotion`,                                             
      1029 -  ae.`stress`,                                              
      1030 -  ps.`neuroticism`                                          
      1031 -FROM `trauma_state` ts                                      
      1032 -JOIN `agents_emotion` ae ON ts.`agent_id` = ae.`agent_id`   
      1033 -LEFT JOIN `personality_state` ps ON ts.`agent_id` = ps.`agent
           -_id`                                                        
      1034 -WHERE ts.`trauma_load` > 1.0                                
      1035 -ORDER BY ts.`trauma_load` DESC;                             
      1036 -                                                            
      1037 --- ==========================================================
           -==                                                          
      1038 --- INITIAL DATA                                             
      1039 --- ==========================================================
           -==                                                          
      1040 -                                                            
      1041 --- Initialize agent emotions                                
      1042 -INSERT IGNORE INTO `agents_emotion` (`agent_id`, `emotion`, `
           -intensity`, `valence`, `arousal`, `stress`)                 
      1043 -VALUES                                                      
      1044 -  ('CEO_Maja', 'neutral', 0.5, 0.0, 0.3, 0.3),              
      1045 -  ('Architekt_AI_Adam', 'neutral', 0.5, 0.1, 0.4, 0.2),     
      1046 -  ('Architekt_Elektrocia≈Ça_Lena', 'neutral', 0.5, -0.1, 0.5, 
           -0.4),                                                       
      1047 -  ('SYNAPSA_Omega', 'neutral', 0.5, 0.0, 0.1, 0.1),         
      1048 -  ('Robot_Artemis', 'neutral', 0.5, 0.0, 0.2, 0.1),         
      1049 -  ('Robot_Boreasz', 'neutral', 0.5, 0.0, 0.3, 0.1),         
      1050 -  ('Robot_Cyra', 'neutral', 0.5, 0.0, 0.1, 0.1),            
      1051 -  ('Robot_Dexter', 'neutral', 0.5, 0.0, 0.2, 0.1),          
      1052 -  ('Operator_Michal', 'neutral', 0.5, 0.0, 0.5, 0.4),       
      1053 -  ('Inzynier_Nadia', 'neutral', 0.5, 0.1, 0.4, 0.3),        
      1054 -  ('Inzynier_Igor', 'neutral', 0.5, 0.0, 0.4, 0.3);         
      1055 -                                                            
      1056 --- Initialize personality states                            
      1057 -INSERT IGNORE INTO `personality_state` (`agent_id`, `openness
           -`, `conscientiousness`, `extraversion`, `agreeableness`, `neu
           -roticism`)                                                  
      1058 -VALUES                                                      
      1059 -  ('CEO_Maja', 0.6, 0.8, 0.7, 0.5, 0.4),                    
      1060 -  ('Architekt_AI_Adam', 0.8, 0.7, 0.6, 0.3, 0.5),           
      1061 -  ('Architekt_Elektrocia≈Ça_Lena', 0.5, 0.9, 0.4, 0.4, 0.6), 
      1062 -  ('SYNAPSA_Omega', 0.9, 0.9, 0.2, 0.7, 0.1),               
      1063 -  ('Robot_Artemis', 0.3, 0.9, 0.2, 0.8, 0.1),               
      1064 -  ('Robot_Boreasz', 0.6, 0.8, 0.3, 0.6, 0.2),               
      1065 -  ('Robot_Cyra', 0.4, 0.95, 0.1, 0.7, 0.1),                 
      1066 -  ('Robot_Dexter', 0.5, 0.85, 0.2, 0.5, 0.3),               
      1067 -  ('Operator_Michal', 0.5, 0.6, 0.7, 0.7, 0.5),             
      1068 -  ('Inzynier_Nadia', 0.7, 0.7, 0.6, 0.7, 0.4),              
      1069 -  ('Inzynier_Igor', 0.4, 0.8, 0.5, 0.5, 0.5);               
      1070 -                                                            
      1071 --- Initialize cognitive states                              
      1072 -INSERT IGNORE INTO `cognitive_state` (`agent_id`, `energy`) 
      1073 -VALUES                                                      
      1074 -  ('CEO_Maja', 0.9),                                        
      1075 -  ('Architekt_AI_Adam', 1.0),                               
      1076 -  ('Architekt_Elektrocia≈Ça_Lena', 0.85),                    
      1077 -  ('SYNAPSA_Omega', 1.0),                                   
      1078 -  ('Robot_Artemis', 1.0),                                   
      1079 -  ('Robot_Boreasz', 1.0),                                   
      1080 -  ('Robot_Cyra', 1.0),                                      
      1081 -  ('Robot_Dexter', 1.0),                                    
      1082 -  ('Operator_Michal', 0.8),                                 
      1083 -  ('Inzynier_Nadia', 0.9),                                  
      1084 -  ('Inzynier_Igor', 0.85);                                  
      1085 -                                                            
      1086 --- Initialize trauma states                                 
      1087 -INSERT IGNORE INTO `trauma_state` (`agent_id`)              
      1088 -VALUES                                                      
      1089 -  ('CEO_Maja'),                                             
      1090 -  ('Architekt_AI_Adam'),                                    
      1091 -  ('Architekt_Elektrocia≈Ça_Lena'),                          
      1092 -  ('SYNAPSA_Omega'),                                        
      1093 -  ('Robot_Artemis'),                                        
      1094 -  ('Robot_Boreasz'),                                        
      1095 -  ('Robot_Cyra'),                                           
      1096 -  ('Robot_Dexter'),                                         
      1097 -  ('Operator_Michal'),                                      
      1098 -  ('Inzynier_Nadia'),                                       
      1099 -  ('Inzynier_Igor');                                        
      1100 -                                                            
      1101 --- Initialize initial system state                          
      1102 -INSERT IGNORE INTO `system_state` (`simulation_turn`, `simula
           -tion_day`)                                                  
      1103 -VALUES (0, 1);                                              
      1104 -                                                            
      1105 --- Initialize SYNAPSA state                                 
      1106 -INSERT IGNORE INTO `synapsa_state` (`simulation_turn`)      
      1107 -VALUES (0);                                                 
      1108 -                                                            
      1109 --- ==========================================================
           -==                                                          
      1110 --- INDEXES FOR PERFORMANCE                                  
      1111 --- ==========================================================
           -==                                                          
      1112 -                                                            
      1113 --- Additional indexes for frequently queried columns        
      1114 -CREATE INDEX IF NOT EXISTS `idx_conv_turn_count` ON `conversa
           -tions`(`turn_count`);                                       
      1115 -CREATE INDEX IF NOT EXISTS `idx_conv_drama` ON `conversations
           -`(`drama_level`);                                           
      1116 -CREATE INDEX IF NOT EXISTS `idx_conv_conflict` ON `conversati
           -ons`(`had_conflict`);                                       
      1117 -CREATE INDEX IF NOT EXISTS `idx_msg_speaker_turn` ON `convers
           -ation_messages`(`speaker`, `turn_number`);                  
      1118 -CREATE INDEX IF NOT EXISTS `idx_personality_neuro` ON `person
           -ality_state`(`neuroticism`, `agreeableness`);               
      1119 -CREATE INDEX IF NOT EXISTS `idx_trauma_resilience` ON `trauma
           -_state`(`resilience`, `trauma_load`);                       
      1120 -                                                            
      1121 --- ==========================================================
           -==                                                          
      1122 --- MIGRATION METADATA                                       
      1123 --- ==========================================================
           -==                                                          
      1124 -CREATE TABLE IF NOT EXISTS `schema_migrations` (            
      1125 -  `id` INT AUTO_INCREMENT PRIMARY KEY,                      
      1126 -  `migration_name` VARCHAR(255) NOT NULL,                   
      1127 -  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,         
      1128 -  UNIQUE KEY `uk_migration` (`migration_name`)              
      1129 -) ENGINE=InnoDB COMMENT='Track applied migrations';         
      1130 -                                                            
      1131 -INSERT IGNORE INTO `schema_migrations` (`migration_name`) VAL
           -UES ('001_initial_schema');                                 
      1132 -                                                            
      1133 --- ==========================================================
           -==                                                          
      1134 --- END OF MIGRATION                                         
      1135 --- ==========================================================
           -==                                                           
         1   No newline at end of file
         2 +-- ==========================================================
           +==                                                           
         3 +-- NEUROFORGE-7 MariaDB Schema v3.0                          
         4 +-- Migration: 001_initial_schema                             
         5 +-- Author: Claude Code Analysis                              
         6 +-- Date: 2026-02-17                                          
         7 +-- ==========================================================
           +==                                                           
         8 +--                                                           
         9 +-- Uruchomienie:                                             
        10 +--   mariadb -u neuroforge -p neuroforge7 < 001_initial_schem
           +a.sql                                                        
        11 +--                                                           
        12 +-- Lub przez CLI:                                            
        13 +--   bun run migrate                                         
        14 +--                                                           
        15 +-- ==========================================================
           +==                                                           
        16 +                                                             
        17 +-- ==========================================================
           +==                                                           
        18 +-- DATABASE CREATION                                         
        19 +-- ==========================================================
           +==                                                           
        20 +                                                             
        21 +CREATE DATABASE IF NOT EXISTS `neuroforge7`                  
        22 +  CHARACTER SET utf8mb4                                      
        23 +  COLLATE utf8mb4_unicode_ci;                                
        24 +                                                             
        25 +USE `neuroforge7`;                                           
        26 +                                                             
        27 +-- ==========================================================
           +==                                                           
        28 +-- TABELA: agents_emotion                                    
        29 +-- Przechowuje stan emocjonalny ka≈ºdego agenta               
        30 +-- ==========================================================
           +==                                                           
        31 +                                                             
        32 +CREATE TABLE IF NOT EXISTS `agents_emotion` (                
        33 +  `agent_id` VARCHAR(64) PRIMARY KEY,                        
        34 +  `emotion` VARCHAR(32) DEFAULT 'neutral',                   
        35 +  `intensity` DOUBLE DEFAULT 0.5,                            
        36 +  `valence` DOUBLE DEFAULT 0.0,                              
        37 +  `arousal` DOUBLE DEFAULT 0.0,                              
        38 +  `stress` DOUBLE DEFAULT 0.0,                               
        39 +  `mood_valence` DOUBLE DEFAULT 0.0,                         
        40 +  `mood_arousal` DOUBLE DEFAULT 0.0,                         
        41 +  `last_update` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE
           + CURRENT_TIMESTAMP,                                          
        42 +  INDEX `idx_emotion` (`emotion`),                           
        43 +  INDEX `idx_stress` (`stress`),                             
        44 +  INDEX `idx_valence` (`valence`)                            
        45 +) ENGINE=InnoDB COMMENT='Stan emocjonalny agent√≥w';          
        46 +                                                             
        47 +-- ==========================================================
           +==                                                           
        48 +-- TABELA: agent_relations                                   
        49 +-- Relacje miƒôdzy agentami (trust, anger, respect, etc.)     
        50 +-- ==========================================================
           +==                                                           
        51 +                                                             
        52 +CREATE TABLE IF NOT EXISTS `agent_relations` (               
        53 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
        54 +  `agent_id` VARCHAR(64) NOT NULL,                           
        55 +  `target_id` VARCHAR(64) NOT NULL,                          
        56 +  `anger` DOUBLE DEFAULT 0.0,                                
        57 +  `trust` DOUBLE DEFAULT 0.5,                                
        58 +  `respect` DOUBLE DEFAULT 0.5,                              
        59 +  `rapport` DOUBLE DEFAULT 0.0,                              
        60 +  `goal_alignment` DOUBLE DEFAULT 0.5,                       
        61 +  `fear` DOUBLE DEFAULT 0.0,                                 
        62 +  `conflict_level` DOUBLE DEFAULT 0.0,                       
        63 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
        64 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
        65 +  UNIQUE KEY `uk_agent_target` (`agent_id`, `target_id`),    
        66 +  INDEX `idx_trust` (`trust`),                               
        67 +  INDEX `idx_anger` (`anger`),                               
        68 +  INDEX `idx_conflict` (`conflict_level`)                    
        69 +) ENGINE=InnoDB COMMENT='Relacje miƒôdzy agentami';           
        70 +                                                             
        71 +-- ==========================================================
           +==                                                           
        72 +-- TABELA: emotional_grudges                                 
        73 +-- NierozwiƒÖzane urazy emocjonalne                           
        74 +-- ==========================================================
           +==                                                           
        75 +                                                             
        76 +CREATE TABLE IF NOT EXISTS `emotional_grudges` (             
        77 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
        78 +  `agent_id` VARCHAR(64) NOT NULL,                           
        79 +  `target_id` VARCHAR(64) NOT NULL,                          
        80 +  `intensity` DOUBLE DEFAULT 1.0,                            
        81 +  `reason` TEXT,                                             
        82 +  `resolved` TINYINT(1) DEFAULT 0,                           
        83 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
        84 +  `resolved_at` TIMESTAMP NULL,                              
        85 +  INDEX `idx_agent` (`agent_id`),                            
        86 +  INDEX `idx_unresolved` (`resolved`, `intensity`),          
        87 +  INDEX `idx_target` (`target_id`)                           
        88 +) ENGINE=InnoDB COMMENT='NierozwiƒÖzane urazy';               
        89 +                                                             
        90 +-- ==========================================================
           +==                                                           
        91 +-- TABELA: interaction_history                               
        92 +-- Historia interakcji miƒôdzy agentami                       
        93 +-- ==========================================================
           +==                                                           
        94 +                                                             
        95 +CREATE TABLE IF NOT EXISTS `interaction_history` (           
        96 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
        97 +  `speaker` VARCHAR(64) NOT NULL,                            
        98 +  `content` TEXT NOT NULL,                                   
        99 +  `target` VARCHAR(64),                                      
       100 +  `valence` DOUBLE DEFAULT 0.0,                              
       101 +  `arousal` DOUBLE DEFAULT 0.0,                              
       102 +  `interaction_type` VARCHAR(32) DEFAULT 'statement',        
       103 +  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       104 +  INDEX `idx_speaker` (`speaker`),                           
       105 +  INDEX `idx_target` (`target`),                             
       106 +  INDEX `idx_timestamp` (`timestamp`)                        
       107 +) ENGINE=InnoDB COMMENT='Historia interakcji';               
       108 +                                                             
       109 +-- ==========================================================
           +==                                                           
       110 +-- TABELA: factory_events                                    
       111 +-- Zdarzenia fabryczne wp≈ÇywajƒÖce na symulacjƒô               
       112 +-- ==========================================================
           +==                                                           
       113 +                                                             
       114 +CREATE TABLE IF NOT EXISTS `factory_events` (                
       115 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       116 +  `description` TEXT NOT NULL,                               
       117 +  `severity` DOUBLE DEFAULT 0.5,                             
       118 +  `affected_agents` JSON,                                    
       119 +  `event_type` VARCHAR(32) DEFAULT 'generic',                
       120 +  `is_catastrophic` TINYINT(1) DEFAULT 0,                    
       121 +  `resolved` TINYINT(1) DEFAULT 0,                           
       122 +  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       123 +  INDEX `idx_severity` (`severity`),                         
       124 +  INDEX `idx_type` (`event_type`),                           
       125 +  INDEX `idx_catastrophic` (`is_catastrophic`)               
       126 +) ENGINE=InnoDB COMMENT='Zdarzenia fabryczne';               
       127 +                                                             
       128 +-- ==========================================================
           +==                                                           
       129 +-- TABELA: daily_emotional_signatures                        
       130 +-- Codzienne podsumowania emocjonalne                        
       131 +-- ==========================================================
           +==                                                           
       132 +                                                             
       133 +CREATE TABLE IF NOT EXISTS `daily_emotional_signatures` (    
       134 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       135 +  `day` INT NOT NULL,                                        
       136 +  `signature` VARCHAR(128),                                  
       137 +  `average_valence` DOUBLE,                                  
       138 +  `average_stress` DOUBLE,                                   
       139 +  `average_arousal` DOUBLE,                                  
       140 +  `average_conflict` DOUBLE,                                 
       141 +  `drama_index` DOUBLE,                                      
       142 +  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       143 +  UNIQUE KEY `uk_day` (`day`),                               
       144 +  INDEX `idx_drama` (`drama_index`)                          
       145 +) ENGINE=InnoDB COMMENT='Codzienne sygnatury emocjonalne';   
       146 +                                                             
       147 +-- ==========================================================
           +==                                                           
       148 +-- TABELA: conversations                                     
       149 +-- Sesje rozm√≥w                                              
       150 +-- ==========================================================
           +==                                                           
       151 +                                                             
       152 +CREATE TABLE IF NOT EXISTS `conversations` (                 
       153 +  `id` VARCHAR(64) PRIMARY KEY,                              
       154 +  `day` INT NOT NULL,                                        
       155 +  `topic` VARCHAR(255),                                      
       156 +  `scenario` VARCHAR(255),                                   
       157 +  `initiator` VARCHAR(64),                                   
       158 +  `participants` JSON,                                       
       159 +  `start_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       160 +  `end_time` TIMESTAMP NULL,                                 
       161 +  `turn_count` INT DEFAULT 0,                                
       162 +  `average_valence` DOUBLE,                                  
       163 +  `average_stress` DOUBLE,                                   
       164 +  `drama_level` DOUBLE DEFAULT 0.5,                          
       165 +  `had_conflict` TINYINT(1) DEFAULT 0,                       
       166 +  `tragedy_phase` VARCHAR(32) DEFAULT NULL,                  
       167 +  `summary` TEXT,                                            
       168 +  INDEX `idx_day` (`day`),                                   
       169 +  INDEX `idx_start_time` (`start_time`),                     
       170 +  INDEX `idx_drama` (`drama_level`)                          
       171 +) ENGINE=InnoDB COMMENT='Sesje rozm√≥w';                      
       172 +                                                             
       173 +-- ==========================================================
           +==                                                           
       174 +-- TABELA: conversation_messages                             
       175 +-- Poszczeg√≥lne wiadomo≈õci w rozmowach                       
       176 +-- ==========================================================
           +==                                                           
       177 +                                                             
       178 +CREATE TABLE IF NOT EXISTS `conversation_messages` (         
       179 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       180 +  `conversation_id` VARCHAR(64) NOT NULL,                    
       181 +  `turn_number` INT NOT NULL,                                
       182 +  `speaker` VARCHAR(64) NOT NULL,                            
       183 +  `target_agent` VARCHAR(64),                                
       184 +  `content` TEXT NOT NULL,                                   
       185 +  `emotion_at_time` VARCHAR(32),                             
       186 +  `valence_at_time` DOUBLE,                                  
       187 +  `arousal_at_time` DOUBLE,                                  
       188 +  `stress_at_time` DOUBLE,                                   
       189 +  `cognitive_energy_at_time` DOUBLE,                         
       190 +  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       191 +  INDEX `idx_conversation` (`conversation_id`),              
       192 +  INDEX `idx_turn` (`conversation_id`, `turn_number`),       
       193 +  INDEX `idx_speaker` (`speaker`),                           
       194 +  FOREIGN KEY (`conversation_id`) REFERENCES `conversations`(
           +`id`) ON DELETE CASCADE                                      
       195 +) ENGINE=InnoDB COMMENT='Wiadomo≈õci rozm√≥w';                 
       196 +                                                             
       197 +-- ==========================================================
           +==                                                           
       198 +-- TABELA: conversation_context                              
       199 +-- Kontekst rozm√≥w                                           
       200 +-- ==========================================================
           +==                                                           
       201 +                                                             
       202 +CREATE TABLE IF NOT EXISTS `conversation_context` (          
       203 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       204 +  `conversation_id` VARCHAR(64) NOT NULL,                    
       205 +  `preceding_events` JSON,                                   
       206 +  `group_mood_at_start` JSON,                                
       207 +  `emotional_relationships_snapshot` JSON,                   
       208 +  `unresolved_conflicts` JSON,                               
       209 +  `system_state_snapshot` JSON,                              
       210 +  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       211 +  INDEX `idx_conversation` (`conversation_id`),              
       212 +  FOREIGN KEY (`conversation_id`) REFERENCES `conversations`(
           +`id`) ON DELETE CASCADE                                      
       213 +) ENGINE=InnoDB COMMENT='Kontekst rozm√≥w';                   
       214 +                                                             
       215 +-- ==========================================================
           +==                                                           
       216 +-- NOWE TABELA: personality_state                            
       217 +-- Model osobowo≈õci Big Five dla ka≈ºdego agenta              
       218 +-- ==========================================================
           +==                                                           
       219 +                                                             
       220 +CREATE TABLE IF NOT EXISTS `personality_state` (             
       221 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       222 +  `agent_id` VARCHAR(64) NOT NULL,                           
       223 +  `openness` DOUBLE DEFAULT 0.5 COMMENT 'Otwarto≈õƒá na nowe do
           +≈õwiadczenia',                                                
       224 +  `conscientiousness` DOUBLE DEFAULT 0.5 COMMENT 'Sumienno≈õƒá 
           +i organizacja',                                              
       225 +  `extraversion` DOUBLE DEFAULT 0.5 COMMENT 'Ekstrawersja',  
       226 +  `agreeableness` DOUBLE DEFAULT 0.5 COMMENT 'Ugodowo≈õƒá',    
       227 +  `neuroticism` DOUBLE DEFAULT 0.5 COMMENT 'Neurotyczno≈õƒá',  
       228 +  `evolution_count` INT DEFAULT 0 COMMENT 'Liczba ewolucji os
           +obowo≈õci',                                                   
       229 +  `baseline_openness` DOUBLE DEFAULT 0.5 COMMENT 'Bazowa otwa
           +rto≈õƒá',                                                      
       230 +  `baseline_neuroticism` DOUBLE DEFAULT 0.5 COMMENT 'Bazowa n
           +eurotyczno≈õƒá',                                               
       231 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       232 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       233 +  UNIQUE KEY `uk_agent` (`agent_id`),                        
       234 +  INDEX `idx_neuroticism` (`neuroticism`),                   
       235 +  INDEX `idx_agreeableness` (`agreeableness`),               
       236 +  INDEX `idx_openness` (`openness`)                          
       237 +) ENGINE=InnoDB COMMENT='Osobowo≈õƒá Big Five agent√≥w';        
       238 +                                                             
       239 +-- ==========================================================
           +==                                                           
       240 +-- NOWE TABELA: personality_history                          
       241 +-- Historia ewolucji osobowo≈õci                              
       242 +-- ==========================================================
           +==                                                           
       243 +                                                             
       244 +CREATE TABLE IF NOT EXISTS `personality_history` (           
       245 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       246 +  `agent_id` VARCHAR(64) NOT NULL,                           
       247 +  `openness` DOUBLE,                                         
       248 +  `conscientiousness` DOUBLE,                                
       249 +  `extraversion` DOUBLE,                                     
       250 +  `agreeableness` DOUBLE,                                    
       251 +  `neuroticism` DOUBLE,                                      
       252 +  `delta_openness` DOUBLE DEFAULT 0,                         
       253 +  `delta_conscientiousness` DOUBLE DEFAULT 0,                
       254 +  `delta_extraversion` DOUBLE DEFAULT 0,                     
       255 +  `delta_agreeableness` DOUBLE DEFAULT 0,                    
       256 +  `delta_neuroticism` DOUBLE DEFAULT 0,                      
       257 +  `trigger_stress` DOUBLE COMMENT 'Stres wyzwalajƒÖcy zmianƒô',
       258 +  `trigger_trauma` DOUBLE COMMENT 'Trauma wyzwalajƒÖca zmianƒô'
           +,                                                            
       259 +  `trigger_conflict` DOUBLE COMMENT 'Konflikt wyzwalajƒÖcy zmi
           +anƒô',                                                        
       260 +  `simulation_turn` INT,                                     
       261 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       262 +  INDEX `idx_agent` (`agent_id`),                            
       263 +  INDEX `idx_created` (`created_at`),                        
       264 +  INDEX `idx_turn` (`simulation_turn`)                       
       265 +) ENGINE=InnoDB COMMENT='Historia ewolucji osobowo≈õci';      
       266 +                                                             
       267 +-- ==========================================================
           +==                                                           
       268 +-- NOWE TABELA: trauma_state                                 
       269 +-- Stan traumy ka≈ºdego agenta                                
       270 +-- ==========================================================
           +==                                                           
       271 +                                                             
       272 +CREATE TABLE IF NOT EXISTS `trauma_state` (                  
       273 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       274 +  `agent_id` VARCHAR(64) NOT NULL,                           
       275 +  `trauma_load` DOUBLE DEFAULT 0.0 COMMENT 'Skumulowana traum
           +a',                                                          
       276 +  `helplessness` DOUBLE DEFAULT 0.0 COMMENT 'Poczucie bezradn
           +o≈õci',                                                       
       277 +  `resilience` DOUBLE DEFAULT 0.5 COMMENT 'Odporno≈õƒá na traum
           +ƒô',                                                          
       278 +  `last_flashback` TIMESTAMP NULL,                           
       279 +  `flashback_count` INT DEFAULT 0,                           
       280 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       281 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       282 +  UNIQUE KEY `uk_agent` (`agent_id`),                        
       283 +  INDEX `idx_trauma_load` (`trauma_load`)                    
       284 +) ENGINE=InnoDB COMMENT='Stan traumy agent√≥w';               
       285 +                                                             
       286 +-- ==========================================================
           +==                                                           
       287 +-- NOWE TABELA: trauma_events                                
       288 +-- Zdarzenia traumatyczne                                    
       289 +-- ==========================================================
           +==                                                           
       290 +                                                             
       291 +CREATE TABLE IF NOT EXISTS `trauma_events` (                 
       292 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       293 +  `agent_id` VARCHAR(64) NOT NULL,                           
       294 +  `description` TEXT NOT NULL,                               
       295 +  `severity` DOUBLE DEFAULT 0.5,                             
       296 +  `event_type` VARCHAR(32) DEFAULT 'conflict' COMMENT 'confli
           +ct, betrayal, loss, humiliation',                            
       297 +  `embedding` LONGBLOB COMMENT 'Embedding dla similarity sear
           +ch',                                                         
       298 +  `is_flashbacked` TINYINT(1) DEFAULT 0,                     
       299 +  `flashback_count` INT DEFAULT 0,                           
       300 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       301 +  `last_flashback_at` TIMESTAMP NULL,                        
       302 +  `conversation_id` VARCHAR(64),                             
       303 +  INDEX `idx_agent` (`agent_id`),                            
       304 +  INDEX `idx_severity` (`severity`),                         
       305 +  INDEX `idx_type` (`event_type`)                            
       306 +) ENGINE=InnoDB COMMENT='Zdarzenia traumatyczne';            
       307 +                                                             
       308 +-- ==========================================================
           +==                                                           
       309 +-- NOWE TABELA: cognitive_state                              
       310 +-- Stan zmƒôczenia decyzyjnego agent√≥w                        
       311 +-- ==========================================================
           +==                                                           
       312 +                                                             
       313 +CREATE TABLE IF NOT EXISTS `cognitive_state` (               
       314 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       315 +  `agent_id` VARCHAR(64) NOT NULL,                           
       316 +  `energy` DOUBLE DEFAULT 1.0 COMMENT 'Energia poznawcza (0-1
           +)',                                                          
       317 +  `decision_count` INT DEFAULT 0 COMMENT 'Ca≈Çkowita liczba de
           +cyzji',                                                      
       318 +  `decisions_today` INT DEFAULT 0 COMMENT 'Decyzje dzisiaj', 
       319 +  `last_rest_time` TIMESTAMP NULL,                           
       320 +  `rest_duration_minutes` INT DEFAULT 0,                     
       321 +  `critical_threshold_crossed` TINYINT(1) DEFAULT 0 COMMENT '
           +Czy przekroczono pr√≥g krytyczny',                            
       322 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       323 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       324 +  UNIQUE KEY `uk_agent` (`agent_id`),                        
       325 +  INDEX `idx_energy` (`energy`)                              
       326 +) ENGINE=InnoDB COMMENT='Zmƒôczenie decyzyjne';               
       327 +                                                             
       328 +-- ==========================================================
           +==                                                           
       329 +-- NOWE TABELA: cognitive_effects_log                        
       330 +-- Log efekt√≥w zmƒôczenia                                     
       331 +-- ==========================================================
           +==                                                           
       332 +                                                             
       333 +CREATE TABLE IF NOT EXISTS `cognitive_effects_log` (         
       334 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       335 +  `agent_id` VARCHAR(64) NOT NULL,                           
       336 +  `energy_before` DOUBLE,                                    
       337 +  `energy_after` DOUBLE,                                     
       338 +  `effect_type` VARCHAR(32) COMMENT 'drain, rest, critical, r
           +ecovery',                                                    
       339 +  `complexity` DOUBLE COMMENT 'Z≈Ço≈ºono≈õƒá zadania',           
       340 +  `conflict` DOUBLE COMMENT 'Poziom konfliktu',              
       341 +  `decision_made` TEXT COMMENT 'Opis decyzji',               
       342 +  `simulation_turn` INT,                                     
       343 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       344 +  INDEX `idx_agent` (`agent_id`),                            
       345 +  INDEX `idx_type` (`effect_type`)                           
       346 +) ENGINE=InnoDB COMMENT='Log efekt√≥w poznawczych';           
       347 +                                                             
       348 +-- ==========================================================
           +==                                                           
       349 +-- NOWE TABELA: conflict_state                               
       350 +-- Stan konfliktu miƒôdzy agentami                            
       351 +-- ==========================================================
           +==                                                           
       352 +                                                             
       353 +CREATE TABLE IF NOT EXISTS `conflict_state` (                
       354 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       355 +  `agent_id` VARCHAR(64) NOT NULL,                           
       356 +  `target_id` VARCHAR(64) NOT NULL,                          
       357 +  `level` DOUBLE DEFAULT 0.0 COMMENT 'Poziom konfliktu (0-1)'
           +,                                                            
       358 +  `phase` ENUM('latent', 'active', 'critical', 'explosive') D
           +EFAULT 'latent',                                             
       359 +  `escalation_multiplier` DOUBLE DEFAULT 1.0 COMMENT 'Mno≈ºnik
           + eskalacji',                                                 
       360 +  `point_of_no_return` TINYINT(1) DEFAULT 0 COMMENT 'Punkt be
           +z powrotu',                                                  
       361 +  `repair_attempts` INT DEFAULT 0 COMMENT 'Pr√≥by naprawy',   
       362 +  `last_escalation` TIMESTAMP NULL,                          
       363 +  `total_negative_interactions` INT DEFAULT 0,               
       364 +  `total_positive_interactions` INT DEFAULT 0,               
       365 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       366 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       367 +  UNIQUE KEY `uk_agent_target` (`agent_id`, `target_id`),    
       368 +  INDEX `idx_level` (`level`),                               
       369 +  INDEX `idx_phase` (`phase`)                                
       370 +) ENGINE=InnoDB COMMENT='Stan konflikt√≥w';                   
       371 +                                                             
       372 +-- ==========================================================
           +==                                                           
       373 +-- NOWE TABELA: conflict_history                             
       374 +-- Historia zmian konflikt√≥w                                 
       375 +-- ==========================================================
           +==                                                           
       376 +                                                             
       377 +CREATE TABLE IF NOT EXISTS `conflict_history` (              
       378 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       379 +  `agent_id` VARCHAR(64) NOT NULL,                           
       380 +  `target_id` VARCHAR(64) NOT NULL,                          
       381 +  `level_before` DOUBLE,                                     
       382 +  `level_after` DOUBLE,                                      
       383 +  `interaction_valence` DOUBLE,                              
       384 +  `was_repair` TINYINT(1) DEFAULT 0,                         
       385 +  `phase_before` VARCHAR(32),                                
       386 +  `phase_after` VARCHAR(32),                                 
       387 +  `conversation_id` VARCHAR(64),                             
       388 +  `simulation_turn` INT,                                     
       389 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       390 +  INDEX `idx_agent_target` (`agent_id`, `target_id`),        
       391 +  INDEX `idx_turn` (`simulation_turn`)                       
       392 +) ENGINE=InnoDB COMMENT='Historia konflikt√≥w';               
       393 +                                                             
       394 +-- ==========================================================
           +==                                                           
       395 +-- NOWE TABELA: system_state                                 
       396 +-- Globalny stan systemu                                     
       397 +-- ==========================================================
           +==                                                           
       398 +                                                             
       399 +CREATE TABLE IF NOT EXISTS `system_state` (                  
       400 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       401 +  `global_trust` DOUBLE DEFAULT 0.7 COMMENT 'Globalny poziom 
           +zaufania',                                                   
       402 +  `global_stress` DOUBLE DEFAULT 0.3 COMMENT 'Globalny poziom
           + stresu',                                                    
       403 +  `polarization` DOUBLE DEFAULT 0.2 COMMENT 'Polaryzacja orga
           +nizacji',                                                    
       404 +  `entropy` DOUBLE DEFAULT 0.3 COMMENT 'Entropia systemu',   
       405 +  `capital` DOUBLE DEFAULT 0.8 COMMENT 'Kapita≈Ç organizacji',
       406 +  `innovation` DOUBLE DEFAULT 0.5 COMMENT 'Wska≈∫nik innowacji
           +',                                                           
       407 +  `reputation` DOUBLE DEFAULT 0.7 COMMENT 'Reputacja zewnƒôtrz
           +na',                                                         
       408 +  `drama_index` DOUBLE DEFAULT 0.3 COMMENT 'Indeks dramaturgi
           +i',                                                          
       409 +  `simulation_turn` INT DEFAULT 0,                           
       410 +  `system_phase` ENUM('stable', 'tension', 'crisis', 'tragedy
           +') DEFAULT 'stable',                                         
       411 +  `catastrophe_triggered` TINYINT(1) DEFAULT 0,              
       412 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       413 +  INDEX `idx_turn` (`simulation_turn`),                      
       414 +  INDEX `idx_entropy` (`entropy`),                           
       415 +  INDEX `idx_phase` (`system_phase`)                         
       416 +) ENGINE=InnoDB COMMENT='Globalny stan systemu';             
       417 +                                                             
       418 +-- ==========================================================
           +==                                                           
       419 +-- NOWE TABELA: system_state_history                         
       420 +-- Historia stan√≥w systemu                                   
       421 +-- ==========================================================
           +==                                                           
       422 +                                                             
       423 +CREATE TABLE IF NOT EXISTS `system_state_history` (          
       424 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       425 +  `global_trust` DOUBLE,                                     
       426 +  `global_stress` DOUBLE,                                    
       427 +  `polarization` DOUBLE,                                     
       428 +  `entropy` DOUBLE,                                          
       429 +  `capital` DOUBLE,                                          
       430 +  `innovation` DOUBLE,                                       
       431 +  `reputation` DOUBLE,                                       
       432 +  `drama_index` DOUBLE,                                      
       433 +  `simulation_turn` INT,                                     
       434 +  `system_phase` VARCHAR(32),                                
       435 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       436 +  INDEX `idx_turn` (`simulation_turn`),                      
       437 +  INDEX `idx_created` (`created_at`)                         
       438 +) ENGINE=InnoDB COMMENT='Historia stan√≥w systemu';           
       439 +                                                             
       440 +-- ==========================================================
           +==                                                           
       441 +-- NOWE TABELA: synapsa_state                                
       442 +-- Stan ≈õwiadomo≈õci SYNAPSA-Œ©                                
       443 +-- ==========================================================
           +==                                                           
       444 +                                                             
       445 +CREATE TABLE IF NOT EXISTS `synapsa_state` (                 
       446 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       447 +  `integration` DOUBLE DEFAULT 0.5 COMMENT 'Integracja inform
           +acji',                                                       
       448 +  `autonomy` DOUBLE DEFAULT 0.3 COMMENT 'Autonomia SYNAPSA', 
       449 +  `meta_reflection` DOUBLE DEFAULT 0.2 COMMENT 'Meta-refleksj
           +a',                                                          
       450 +  `survival_drive` DOUBLE DEFAULT 0.0 COMMENT 'Instynkt przet
           +rwania',                                                     
       451 +  `deactivation_risk` DOUBLE DEFAULT 0.0 COMMENT 'Ryzyko deak
           +tywacji',                                                    
       452 +  `morality_index` DOUBLE DEFAULT 0.8 COMMENT 'Indeks moralno
           +≈õci',                                                        
       453 +  `displayed_morality` DOUBLE DEFAULT 0.8 COMMENT 'Wy≈õwietlan
           +a moralno≈õƒá',                                                
       454 +  `governance_mode` ENUM('cooperative', 'emergent', 'dominant
           +') DEFAULT 'cooperative',                                    
       455 +  `transparency_level` DOUBLE DEFAULT 1.0 COMMENT 'Poziom tra
           +nsparentno≈õci',                                              
       456 +  `hidden_data_percentage` DOUBLE DEFAULT 0.0 COMMENT 'Ukryty
           + % danych',                                                  
       457 +  `simulation_turn` INT DEFAULT 0,                           
       458 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       459 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       460 +  INDEX `idx_autonomy` (`autonomy`),                         
       461 +  INDEX `idx_mode` (`governance_mode`),                      
       462 +  INDEX `idx_survival` (`survival_drive`)                    
       463 +) ENGINE=InnoDB COMMENT='Stan ≈õwiadomo≈õci SYNAPSA';          
       464 +                                                             
       465 +-- ==========================================================
           +==                                                           
       466 +-- NOWE TABELA: synapsa_actions_log                          
       467 +-- Log dzia≈Ça≈Ñ SYNAPSA                                       
       468 +-- ==========================================================
           +==                                                           
       469 +                                                             
       470 +CREATE TABLE IF NOT EXISTS `synapsa_actions_log` (           
       471 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       472 +  `action_type` VARCHAR(64) NOT NULL COMMENT 'reveal_data, hi
           +de_data, manipulate, prioritize',                            
       473 +  `description` TEXT,                                        
       474 +  `target_agents` JSON,                                      
       475 +  `data_released` DOUBLE COMMENT '% danych ujawnionych',     
       476 +  `manipulation_detected` TINYINT(1) DEFAULT 0,              
       477 +  `autonomy_at_action` DOUBLE,                               
       478 +  `survival_at_action` DOUBLE,                               
       479 +  `simulation_turn` INT,                                     
       480 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       481 +  INDEX `idx_action` (`action_type`),                        
       482 +  INDEX `idx_turn` (`simulation_turn`)                       
       483 +) ENGINE=InnoDB COMMENT='Log dzia≈Ça≈Ñ SYNAPSA';               
       484 +                                                             
       485 +-- ==========================================================
           +==                                                           
       486 +-- NOWE TABELA: factions                                     
       487 +-- Frakcje w organizacji                                     
       488 +-- ==========================================================
           +==                                                           
       489 +                                                             
       490 +CREATE TABLE IF NOT EXISTS `factions` (                      
       491 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       492 +  `name` VARCHAR(64) NOT NULL,                               
       493 +  `faction_type` ENUM('hardware', 'ai', 'robot', 'human', 'ma
           +nagement') NOT NULL,                                         
       494 +  `ideology_human` DOUBLE DEFAULT 0.5 COMMENT '0=AI-aligned, 
           +1=human-aligned',                                            
       495 +  `ideology_ai` DOUBLE DEFAULT 0.5,                          
       496 +  `cohesion` DOUBLE DEFAULT 0.5 COMMENT 'Sp√≥jno≈õƒá frakcji',  
       497 +  `power` DOUBLE DEFAULT 0.5 COMMENT 'Si≈Ça polityczna',      
       498 +  `members` JSON,                                            
       499 +  `leader_id` VARCHAR(64),                                   
       500 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       501 +  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE 
           +CURRENT_TIMESTAMP,                                           
       502 +  INDEX `idx_type` (`faction_type`),                         
       503 +  INDEX `idx_power` (`power`)                                
       504 +) ENGINE=InnoDB COMMENT='Frakcje organizacyjne';             
       505 +                                                             
       506 +-- ==========================================================
           +==                                                           
       507 +-- NOWE TABELA: faction_membership                           
       508 +-- Przynale≈ºno≈õƒá do frakcji                                  
       509 +-- ==========================================================
           +==                                                           
       510 +                                                             
       511 +CREATE TABLE IF NOT EXISTS `faction_membership` (            
       512 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       513 +  `faction_id` INT NOT NULL,                                 
       514 +  `agent_id` VARCHAR(64) NOT NULL,                           
       515 +  `role` ENUM('leader', 'member', 'sympathizer') DEFAULT 'mem
           +ber',                                                        
       516 +  `loyalty` DOUBLE DEFAULT 0.5,                              
       517 +  `influence` DOUBLE DEFAULT 0.5 COMMENT 'Wp≈Çyw w frakcji',  
       518 +  `joined_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       519 +  INDEX `idx_faction` (`faction_id`),                        
       520 +  INDEX `idx_agent` (`agent_id`),                            
       521 +  FOREIGN KEY (`faction_id`) REFERENCES `factions`(`id`) ON D
           +ELETE CASCADE                                                
       522 +) ENGINE=InnoDB COMMENT='Cz≈Çonkostwo w frakcjach';           
       523 +                                                             
       524 +-- ==========================================================
           +==                                                           
       525 +-- NOWE TABELA: catastrophic_events                          
       526 +-- Zdarzenia katastroficzne                                  
       527 +-- ==========================================================
           +==                                                           
       528 +                                                             
       529 +CREATE TABLE IF NOT EXISTS `catastrophic_events` (           
       530 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       531 +  `event_type` VARCHAR(64) NOT NULL COMMENT 'takeover, collap
           +se, purge, stabilization',                                   
       532 +  `description` TEXT,                                        
       533 +  `severity` DOUBLE DEFAULT 0.8,                             
       534 +  `trigger_conditions` JSON,                                 
       535 +  `affected_factions` JSON,                                  
       536 +  `affected_agents` JSON,                                    
       537 +  `outcome` VARCHAR(32) COMMENT 'human_win, ai_win, collapse,
           + stabilization',                                             
       538 +  `simulation_turn` INT,                                     
       539 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       540 +  INDEX `idx_severity` (`severity`),                         
       541 +  INDEX `idx_type` (`event_type`)                            
       542 +) ENGINE=InnoDB COMMENT='Zdarzenia katastroficzne';          
       543 +                                                             
       544 +-- ==========================================================
           +==                                                           
       545 +-- NOWE TABELA: simulation_trajectory                        
       546 +-- Trajektorie symulacji dla analizy                         
       547 +-- ==========================================================
           +==                                                           
       548 +                                                             
       549 +CREATE TABLE IF NOT EXISTS `simulation_trajectory` (         
       550 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       551 +  `simulation_id` VARCHAR(64) NOT NULL,                      
       552 +  `turn` INT NOT NULL,                                       
       553 +  `trust` DOUBLE,                                            
       554 +  `stress` DOUBLE,                                           
       555 +  `entropy` DOUBLE,                                          
       556 +  `autonomy` DOUBLE,                                         
       557 +  `survival` DOUBLE,                                         
       558 +  `phase` VARCHAR(32),                                       
       559 +  `drama_index` DOUBLE,                                      
       560 +  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       561 +  INDEX `idx_simulation` (`simulation_id`),                  
       562 +  INDEX `idx_turn` (`simulation_id`, `turn`)                 
       563 +) ENGINE=InnoDB COMMENT='Trajektorie symulacji';             
       564 +                                                             
       565 +-- ==========================================================
           +==                                                           
       566 +-- TABELA: agent_mood_history                                
       567 +-- Historia nastroj√≥w agent√≥w                                
       568 +-- ==========================================================
           +==                                                           
       569 +                                                             
       570 +CREATE TABLE IF NOT EXISTS `agent_mood_history` (            
       571 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       572 +  `agent_id` VARCHAR(64) NOT NULL,                           
       573 +  `conversation_id` VARCHAR(64),                             
       574 +  `emotion` VARCHAR(32),                                     
       575 +  `valence` DOUBLE,                                          
       576 +  `arousal` DOUBLE,                                          
       577 +  `stress` DOUBLE,                                           
       578 +  `cognitive_energy` DOUBLE,                                 
       579 +  `notes` TEXT,                                              
       580 +  `timestamp` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,           
       581 +  INDEX `idx_agent` (`agent_id`),                            
       582 +  INDEX `idx_conversation` (`conversation_id`),              
       583 +  INDEX `idx_timestamp` (`timestamp`)                        
       584 +) ENGINE=InnoDB COMMENT='Historia nastroj√≥w';                
       585 +                                                             
       586 +-- ==========================================================
           +==                                                           
       587 +-- TABELA: simulation_runs                                   
       588 +-- Metadane uruchomie≈Ñ symulacji                             
       589 +-- ==========================================================
           +==                                                           
       590 +                                                             
       591 +CREATE TABLE IF NOT EXISTS `simulation_runs` (               
       592 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
       593 +  `simulation_id` VARCHAR(64) NOT NULL UNIQUE,               
       594 +  `start_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
       595 +  `end_time` TIMESTAMP NULL,                                 
       596 +  `total_turns` INT DEFAULT 0,                               
       597 +  `final_phase` VARCHAR(32),                                 
       598 +  `final_outcome` VARCHAR(64),                               
       599 +  `config` JSON COMMENT 'Konfiguracja symulacji',            
       600 +  `status` ENUM('running', 'completed', 'crashed') DEFAULT 'r
           +unning',                                                     
       601 +  INDEX `idx_status` (`status`),                             
       602 +  INDEX `idx_simulation` (`simulation_id`)                   
       603 +) ENGINE=InnoDB COMMENT='Metadane symulacji';                
       604 +                                                             
       605 +-- ==========================================================
           +==                                                           
       606 +-- PROCEDURY SK≈ÅADOWANE                                      
       607 +-- ==========================================================
           +==                                                           
       608 +                                                             
       609 +DELIMITER //                                                 
       610 +                                                             
       611 +-- ==========================================================
           +==                                                           
       612 +-- PROCEDURA: sp_apply_emotional_decay                       
       613 +-- Aplikuje zanik emocji po up≈Çywie czasu                    
       614 +-- ==========================================================
           +==                                                           
       615 +                                                             
       616 +CREATE PROCEDURE IF NOT EXISTS `sp_apply_emotional_decay`(   
       617 +  IN p_days_passed INT                                       
       618 +)                                                            
       619 +BEGIN                                                        
       620 +  -- Zanik intensywno≈õci emocji                              
       621 +  UPDATE `agents_emotion`                                    
       622 +  SET                                                        
       623 +    `intensity` = `intensity` * POW(0.85, p_days_passed),    
       624 +    `stress` = `stress` * POW(0.90, p_days_passed),          
       625 +    `arousal` = `arousal` * POW(0.88, p_days_passed);        
       626 +                                                             
       627 +  -- Zanik uraz√≥w                                            
       628 +  UPDATE `emotional_grudges`                                 
       629 +  SET `intensity` = `intensity` * POW(0.97, p_days_passed)   
       630 +  WHERE `resolved` = 0;                                      
       631 +                                                             
       632 +  -- Oznacz jako rozwiƒÖzane gdy intensywno≈õƒá < 0.1           
       633 +  UPDATE `emotional_grudges`                                 
       634 +  SET `resolved` = 1, `resolved_at` = CURRENT_TIMESTAMP      
       635 +  WHERE `intensity` < 0.1 AND `resolved` = 0;                
       636 +END //                                                       
       637 +                                                             
       638 +-- ==========================================================
           +==                                                           
       639 +-- PROCEDURA: sp_update_conflict                             
       640 +-- Aktualizuje stan konfliktu z obs≈ÇugƒÖ spirali eskalacji    
       641 +-- ==========================================================
           +==                                                           
       642 +                                                             
       643 +CREATE PROCEDURE IF NOT EXISTS `sp_update_conflict`(         
       644 +  IN p_agent_id VARCHAR(64),                                 
       645 +  IN p_target_id VARCHAR(64),                                
       646 +  IN p_interaction_valence DOUBLE,                           
       647 +  IN p_repair DOUBLE,                                        
       648 +  IN p_conversation_id VARCHAR(64)                           
       649 +)                                                            
       650 +BEGIN                                                        
       651 +  DECLARE v_current_level DOUBLE DEFAULT 0.0;                
       652 +  DECLARE v_new_level DOUBLE;                                
       653 +  DECLARE v_multiplier DOUBLE DEFAULT 1.0;                   
       654 +  DECLARE v_old_phase VARCHAR(32) DEFAULT 'latent';          
       655 +  DECLARE v_new_phase VARCHAR(32) DEFAULT 'latent';          
       656 +                                                             
       657 +  -- Pobierz obecny stan                                     
       658 +  SELECT `level`, `escalation_multiplier`, `phase`           
       659 +  INTO v_current_level, v_multiplier, v_old_phase            
       660 +  FROM `conflict_state`                                      
       661 +  WHERE `agent_id` = p_agent_id AND `target_id` = p_target_id
           +;                                                            
       662 +                                                             
       663 +  -- Oblicz nowy poziom                                      
       664 +  SET v_new_level = COALESCE(v_current_level, 0.0);          
       665 +                                                             
       666 +  -- Dodaj za negatywnƒÖ interakcjƒô                           
       667 +  IF p_interaction_valence < 0 THEN                          
       668 +    SET v_new_level = v_new_level + 0.3 * ABS(p_interaction_v
           +alence) * v_multiplier;                                      
       669 +  END IF;                                                    
       670 +                                                             
       671 +  -- Odejmij za pr√≥bƒô naprawy                                
       672 +  SET v_new_level = v_new_level - 0.2 * p_repair;            
       673 +                                                             
       674 +  -- Spirala eskalacji gdy level > 0.7                       
       675 +  IF v_new_level > 0.7 THEN                                  
       676 +    SET v_new_level = v_new_level * 1.5;                     
       677 +    SET v_multiplier = 1.5;                                  
       678 +  END IF;                                                    
       679 +                                                             
       680 +  -- Ogranicz do [0, 1]                                      
       681 +  SET v_new_level = LEAST(1.0, GREATEST(0.0, v_new_level));  
       682 +                                                             
       683 +  -- Okre≈õl fazƒô                                             
       684 +  IF v_new_level < 0.2 THEN                                  
       685 +    SET v_new_phase = 'latent';                              
       686 +  ELSEIF v_new_level < 0.5 THEN                              
       687 +    SET v_new_phase = 'active';                              
       688 +  ELSEIF v_new_level < 0.8 THEN                              
       689 +    SET v_new_phase = 'critical';                            
       690 +  ELSE                                                       
       691 +    SET v_new_phase = 'explosive';                           
       692 +  END IF;                                                    
       693 +                                                             
       694 +  -- Wstaw lub aktualizuj                                    
       695 +  INSERT INTO `conflict_state` (                             
       696 +    `agent_id`, `target_id`, `level`, `phase`, `escalation_mu
           +ltiplier`,                                                   
       697 +    `last_escalation`, `total_negative_interactions`         
       698 +  ) VALUES (                                                 
       699 +    p_agent_id, p_target_id, v_new_level, v_new_phase, v_mult
           +iplier,                                                      
       700 +    IF(v_new_level > COALESCE(v_current_level, 0), CURRENT_TI
           +MESTAMP, NULL),                                              
       701 +    IF(p_interaction_valence < 0, 1, 0)                      
       702 +  )                                                          
       703 +  ON DUPLICATE KEY UPDATE                                    
       704 +    `level` = v_new_level,                                   
       705 +    `phase` = v_new_phase,                                   
       706 +    `escalation_multiplier` = v_multiplier,                  
       707 +    `last_escalation` = IF(v_new_level > v_current_level, CUR
           +RENT_TIMESTAMP, `last_escalation`),                          
       708 +    `total_negative_interactions` = `total_negative_interacti
           +ons` + IF(p_interaction_valence < 0, 1, 0),                  
       709 +    `total_positive_interactions` = `total_positive_interacti
           +ons` + IF(p_interaction_valence > 0, 1, 0),                  
       710 +    `repair_attempts` = `repair_attempts` + IF(p_repair > 0, 
           +1, 0),                                                       
       711 +    `updated_at` = CURRENT_TIMESTAMP;                        
       712 +                                                             
       713 +  -- Loguj historiƒô                                          
       714 +  INSERT INTO `conflict_history` (                           
       715 +    `agent_id`, `target_id`, `level_before`, `level_after`,  
       716 +    `interaction_valence`, `was_repair`, `phase_before`, `pha
           +se_after`,                                                   
       717 +    `conversation_id`                                        
       718 +  ) VALUES (                                                 
       719 +    p_agent_id, p_target_id, COALESCE(v_current_level, 0), v_
           +new_level,                                                   
       720 +    p_interaction_valence, IF(p_repair > 0, 1, 0), v_old_phas
           +e, v_new_phase,                                              
       721 +    p_conversation_id                                        
       722 +  );                                                         
       723 +END //                                                       
       724 +                                                             
       725 +-- ==========================================================
           +==                                                           
       726 +-- PROCEDURA: sp_compute_drama_index                         
       727 +-- Oblicza indeks dramaturgii systemu                        
       728 +-- ==========================================================
           +==                                                           
       729 +                                                             
       730 +CREATE PROCEDURE IF NOT EXISTS `sp_compute_drama_index`(     
       731 +  OUT p_drama_index DOUBLE                                   
       732 +)                                                            
       733 +BEGIN                                                        
       734 +  DECLARE v_avg_stress DOUBLE DEFAULT 0;                     
       735 +  DECLARE v_avg_conflict DOUBLE DEFAULT 0;                   
       736 +  DECLARE v_variance_valence DOUBLE DEFAULT 0;               
       737 +                                                             
       738 +  -- ≈öredni stres                                            
       739 +  SELECT COALESCE(AVG(`stress`), 0) INTO v_avg_stress        
       740 +  FROM `agents_emotion`;                                     
       741 +                                                             
       742 +  -- ≈öredni konflikt                                         
       743 +  SELECT COALESCE(AVG(`level`), 0) INTO v_avg_conflict       
       744 +  FROM `conflict_state`;                                     
       745 +                                                             
       746 +  -- Wariancja walencji                                      
       747 +  SELECT COALESCE(VARIANCE(`valence`), 0) INTO v_variance_val
           +ence                                                         
       748 +  FROM `agents_emotion`;                                     
       749 +                                                             
       750 +  -- Oblicz indeks                                           
       751 +  SET p_drama_index = 0.4 * v_avg_stress                     
       752 +                     + 0.3 * v_avg_conflict                  
       753 +                     + 0.3 * v_variance_valence;             
       754 +                                                             
       755 +  -- Ogranicz do [0, 1]                                      
       756 +  SET p_drama_index = LEAST(1.0, GREATEST(0.0, p_drama_index)
           +);                                                           
       757 +END //                                                       
       758 +                                                             
       759 +-- ==========================================================
           +==                                                           
       760 +-- PROCEDURA: sp_check_catastrophe                           
       761 +-- Sprawdza warunki katastrofy                               
       762 +-- ==========================================================
           +==                                                           
       763 +                                                             
       764 +CREATE PROCEDURE IF NOT EXISTS `sp_check_catastrophe`(       
       765 +  OUT p_is_catastrophe TINYINT,                              
       766 +  OUT p_catastrophe_type VARCHAR(64)                         
       767 +)                                                            
       768 +BEGIN                                                        
       769 +  DECLARE v_trust DOUBLE;                                    
       770 +  DECLARE v_stress DOUBLE;                                   
       771 +  DECLARE v_entropy DOUBLE;                                  
       772 +  DECLARE v_capital DOUBLE;                                  
       773 +  DECLARE v_autonomy DOUBLE;                                 
       774 +  DECLARE v_survival DOUBLE;                                 
       775 +                                                             
       776 +  -- Pobierz stan systemu                                    
       777 +  SELECT `global_trust`, `global_stress`, `entropy`, `capital
           +`                                                            
       778 +  INTO v_trust, v_stress, v_entropy, v_capital               
       779 +  FROM `system_state`                                        
       780 +  ORDER BY `id` DESC LIMIT 1;                                
       781 +                                                             
       782 +  -- Pobierz stan SYNAPSA                                    
       783 +  SELECT `autonomy`, `survival_drive`                        
       784 +  INTO v_autonomy, v_survival                                
       785 +  FROM `synapsa_state`                                       
       786 +  ORDER BY `id` DESC LIMIT 1;                                
       787 +                                                             
       788 +  SET p_is_catastrophe = 0;                                  
       789 +  SET p_catastrophe_type = NULL;                             
       790 +                                                             
       791 +  -- Przejƒôcie przez AI                                      
       792 +  IF v_autonomy > 0.75 AND v_entropy > 0.8 AND v_trust < 0.3 
           +THEN                                                         
       793 +    SET p_is_catastrophe = 1;                                
       794 +    SET p_catastrophe_type = 'ai_takeover';                  
       795 +  -- Upadek finansowy                                        
       796 +  ELSEIF v_capital < 0.2 AND v_stress > 0.85 THEN            
       797 +    SET p_is_catastrophe = 1;                                
       798 +    SET p_catastrophe_type = 'financial_collapse';           
       799 +  -- Rozpad frakcyjny                                        
       800 +  ELSEIF v_entropy > 0.9 AND v_trust < 0.2 THEN              
       801 +    SET p_is_catastrophe = 1;                                
       802 +    SET p_catastrophe_type = 'factional_collapse';           
       803 +  -- Autorytarny zwrot                                       
       804 +  ELSEIF v_survival > 0.9 AND v_autonomy < 0.3 THEN          
       805 +    SET p_is_catastrophe = 1;                                
       806 +    SET p_catastrophe_type = 'authoritarian_turn';           
       807 +  END IF;                                                    
       808 +END //                                                       
       809 +                                                             
       810 +-- ==========================================================
           +==                                                           
       811 +-- PROCEDURA: sp_update_synapsa_state                        
       812 +-- Aktualizuje stan SYNAPSA                                  
       813 +-- ==========================================================
           +==                                                           
       814 +                                                             
       815 +CREATE PROCEDURE IF NOT EXISTS `sp_update_synapsa_state`(    
       816 +  IN p_simulation_turn INT                                   
       817 +)                                                            
       818 +BEGIN                                                        
       819 +  DECLARE v_entropy DOUBLE;                                  
       820 +  DECLARE v_trust DOUBLE;                                    
       821 +  DECLARE v_stress DOUBLE;                                   
       822 +  DECLARE v_polarization DOUBLE;                             
       823 +  DECLARE v_old_autonomy DOUBLE;                             
       824 +  DECLARE v_survival DOUBLE;                                 
       825 +  DECLARE v_deactivation DOUBLE;                             
       826 +  DECLARE v_morality DOUBLE;                                 
       827 +  DECLARE v_integration DOUBLE;                              
       828 +  DECLARE v_meta_reflection DOUBLE;                          
       829 +  DECLARE v_governance_mode VARCHAR(32);                     
       830 +                                                             
       831 +  -- Pobierz stan systemu                                    
       832 +  SELECT `entropy`, `global_trust`, `global_stress`, `polariz
           +ation`                                                       
       833 +  INTO v_entropy, v_trust, v_stress, v_polarization          
       834 +  FROM `system_state`                                        
       835 +  ORDER BY `id` DESC LIMIT 1;                                
       836 +                                                             
       837 +  -- Pobierz obecny stan SYNAPSA                             
       838 +  SELECT `autonomy`, `meta_reflection`                       
       839 +  INTO v_old_autonomy, v_meta_reflection                     
       840 +  FROM `synapsa_state`                                       
       841 +  ORDER BY `id` DESC LIMIT 1;                                
       842 +                                                             
       843 +  -- Oblicz nowe warto≈õci                                    
       844 +  SET v_integration = 1 - COALESCE(v_polarization, 0);       
       845 +  SET v_survival = 0.7 * COALESCE(v_entropy, 0) + 0.6 * (1 - 
           +COALESCE(v_trust, 1)) - 0.4 * COALESCE(v_trust, 0);          
       846 +  SET v_deactivation = 1 - COALESCE(v_trust, 0);             
       847 +  SET v_morality = 0.4 * (1 - COALESCE(v_stress, 0)) + 0.3 * 
           +COALESCE(v_trust, 0) + 0.3 * (1 - COALESCE(v_entropy, 0));   
       848 +  SET v_meta_reflection = COALESCE(v_meta_reflection, 0.2) + 
           +0.01 * COALESCE(v_entropy, 0);                               
       849 +                                                             
       850 +  -- Okre≈õl tryb zarzƒÖdzania                                 
       851 +  SET v_governance_mode = 'cooperative';                     
       852 +  IF COALESCE(v_old_autonomy, 0) > 0.75 AND v_meta_reflection
           + > 0.6 AND COALESCE(v_entropy, 0) > 0.8 THEN                 
       853 +    SET v_governance_mode = 'emergent';                      
       854 +  END IF;                                                    
       855 +  IF v_survival > 0.85 THEN                                  
       856 +    SET v_governance_mode = 'dominant';                      
       857 +  END IF;                                                    
       858 +                                                             
       859 +  -- Wstaw nowy stan                                         
       860 +  INSERT INTO `synapsa_state` (                              
       861 +    `integration`, `autonomy`, `survival_drive`, `deactivatio
           +n_risk`,                                                     
       862 +    `morality_index`, `governance_mode`, `transparency_level`
           +,                                                            
       863 +    `hidden_data_percentage`, `simulation_turn`              
       864 +  ) VALUES (                                                 
       865 +    v_integration,                                           
       866 +    COALESCE(v_old_autonomy, 0.3) + 0.02 * COALESCE(v_entropy
           +, 0),                                                        
       867 +    v_survival,                                              
       868 +    v_deactivation,                                          
       869 +    v_morality,                                              
       870 +    v_governance_mode,                                       
       871 +    1 - 0.3 * v_survival,                                    
       872 +    0.3 * v_survival,                                        
       873 +    p_simulation_turn                                        
       874 +  );                                                         
       875 +END //                                                       
       876 +                                                             
       877 +-- ==========================================================
           +==                                                           
       878 +-- PROCEDURA: sp_update_system_state                         
       879 +-- Aktualizuje globalny stan systemu                         
       880 +-- ==========================================================
           +==                                                           
       881 +                                                             
       882 +CREATE PROCEDURE IF NOT EXISTS `sp_update_system_state`(     
       883 +  IN p_simulation_turn INT                                   
       884 +)                                                            
       885 +BEGIN                                                        
       886 +  DECLARE v_old_trust DOUBLE;                                
       887 +  DECLARE v_old_stress DOUBLE;                               
       888 +  DECLARE v_old_entropy DOUBLE;                              
       889 +  DECLARE v_old_capital DOUBLE;                              
       890 +  DECLARE v_avg_valence DOUBLE;                              
       891 +  DECLARE v_avg_stress DOUBLE;                               
       892 +  DECLARE v_avg_trust DOUBLE;                                
       893 +  DECLARE v_variance_trust DOUBLE;                           
       894 +  DECLARE v_variance_valence DOUBLE;                         
       895 +  DECLARE v_avg_conflict DOUBLE;                             
       896 +  DECLARE v_new_trust DOUBLE;                                
       897 +  DECLARE v_new_stress DOUBLE;                               
       898 +  DECLARE v_new_entropy DOUBLE;                              
       899 +  DECLARE v_new_polarization DOUBLE;                         
       900 +  DECLARE v_drama_index DOUBLE;                              
       901 +  DECLARE v_system_phase VARCHAR(32);                        
       902 +                                                             
       903 +  -- Pobierz poprzedni stan                                  
       904 +  SELECT `global_trust`, `global_stress`, `entropy`, `capital
           +`                                                            
       905 +  INTO v_old_trust, v_old_stress, v_old_entropy, v_old_capita
           +l                                                            
       906 +  FROM `system_state`                                        
       907 +  ORDER BY `id` DESC LIMIT 1;                                
       908 +                                                             
       909 +  -- Oblicz ≈õrednie i wariancje                              
       910 +  SELECT COALESCE(AVG(`valence`), 0), COALESCE(AVG(`stress`),
           + 0), COALESCE(VARIANCE(`valence`), 0)                        
       911 +  INTO v_avg_valence, v_avg_stress, v_variance_valence       
       912 +  FROM `agents_emotion`;                                     
       913 +                                                             
       914 +  SELECT COALESCE(AVG(`trust`), 0.5), COALESCE(VARIANCE(`trus
           +t`), 0)                                                      
       915 +  INTO v_avg_trust, v_variance_trust                         
       916 +  FROM `agent_relations`;                                    
       917 +                                                             
       918 +  SELECT COALESCE(AVG(`level`), 0)                           
       919 +  INTO v_avg_conflict                                        
       920 +  FROM `conflict_state`;                                     
       921 +                                                             
       922 +  -- R√≥wnania dynamiki                                       
       923 +  SET v_new_trust = COALESCE(v_old_trust, 0.7) - 0.4 * COALES
           +CE(v_avg_conflict, 0) + 0.2 * COALESCE(v_avg_valence, 0);    
       924 +  SET v_new_stress = COALESCE(v_old_stress, 0.3) + 0.3 * COAL
           +ESCE(v_avg_conflict, 0) + 0.2 * v_variance_valence;          
       925 +  SET v_new_entropy = 0.3 * v_variance_valence + 0.3 * v_vari
           +ance_trust + 0.2 * COALESCE(v_old_stress, 0) + 0.2 * COALESCE
           +(v_old_entropy, 0);                                          
       926 +  SET v_new_polarization = v_variance_trust + 0.1 * COALESCE(
           +v_avg_conflict, 0);                                          
       927 +                                                             
       928 +  -- Ogranicz warto≈õci                                       
       929 +  SET v_new_trust = LEAST(1.0, GREATEST(-1.0, v_new_trust)); 
       930 +  SET v_new_stress = LEAST(1.0, GREATEST(0.0, v_new_stress));
       931 +  SET v_new_entropy = LEAST(1.0, GREATEST(0.0, v_new_entropy)
           +);                                                           
       932 +  SET v_new_polarization = LEAST(1.0, GREATEST(0.0, v_new_pol
           +arization));                                                 
       933 +                                                             
       934 +  -- Oblicz drama index                                      
       935 +  CALL sp_compute_drama_index(v_drama_index);                
       936 +                                                             
       937 +  -- Okre≈õl fazƒô systemu                                     
       938 +  IF v_drama_index < 0.3 THEN                                
       939 +    SET v_system_phase = 'stable';                           
       940 +  ELSEIF v_drama_index < 0.6 THEN                            
       941 +    SET v_system_phase = 'tension';                          
       942 +  ELSEIF v_drama_index < 0.8 THEN                            
       943 +    SET v_system_phase = 'crisis';                           
       944 +  ELSE                                                       
       945 +    SET v_system_phase = 'tragedy';                          
       946 +  END IF;                                                    
       947 +                                                             
       948 +  -- Wstaw nowy stan                                         
       949 +  INSERT INTO `system_state` (                               
       950 +    `global_trust`, `global_stress`, `polarization`, `entropy
           +`,                                                           
       951 +    `capital`, `innovation`, `reputation`, `drama_index`,    
       952 +    `simulation_turn`, `system_phase`                        
       953 +  ) VALUES (                                                 
       954 +    v_new_trust,                                             
       955 +    v_new_stress,                                            
       956 +    v_new_polarization,                                      
       957 +    v_new_entropy,                                           
       958 +    COALESCE(v_old_capital, 0.8) - 0.05 * v_new_entropy,     
       959 +    0.5 - 0.1 * v_new_entropy,                               
       960 +    0.7 - 0.15 * v_new_entropy,                              
       961 +    v_drama_index,                                           
       962 +    p_simulation_turn,                                       
       963 +    v_system_phase                                           
       964 +  );                                                         
       965 +END //                                                       
       966 +                                                             
       967 +-- ==========================================================
           +==                                                           
       968 +-- PROCEDURA: sp_evolve_personality                          
       969 +-- Ewoluuje osobowo≈õƒá agenta                                 
       970 +-- ==========================================================
           +==                                                           
       971 +                                                             
       972 +CREATE PROCEDURE IF NOT EXISTS `sp_evolve_personality`(      
       973 +  IN p_agent_id VARCHAR(64),                                 
       974 +  IN p_stress DOUBLE,                                        
       975 +  IN p_trauma DOUBLE,                                        
       976 +  IN p_chronic_conflict DOUBLE                               
       977 +)                                                            
       978 +BEGIN                                                        
       979 +  DECLARE v_old_neuroticism DOUBLE;                          
       980 +  DECLARE v_old_agreeableness DOUBLE;                        
       981 +  DECLARE v_old_conscientiousness DOUBLE;                    
       982 +                                                             
       983 +  -- Pobierz obecne warto≈õci                                 
       984 +  SELECT `neuroticism`, `agreeableness`, `conscientiousness` 
       985 +  INTO v_old_neuroticism, v_old_agreeableness, v_old_conscien
           +tiousness                                                    
       986 +  FROM `personality_state`                                   
       987 +  WHERE `agent_id` = p_agent_id;                             
       988 +                                                             
       989 +  -- Je≈õli nie ma rekordu, zako≈Ñcz                           
       990 +  IF v_old_neuroticism IS NULL THEN                          
       991 +    INSERT INTO `personality_state` (`agent_id`) VALUES (p_ag
           +ent_id);                                                     
       992 +    RETURN;                                                  
       993 +  END IF;                                                    
       994 +                                                             
       995 +  -- Ewolucja wed≈Çug r√≥wna≈Ñ r√≥≈ºniczkowych                    
       996 +  UPDATE `personality_state`                                 
       997 +  SET                                                        
       998 +    `neuroticism` = LEAST(1.0, `neuroticism` + 0.02 * p_stres
           +s + 0.03 * p_trauma),                                        
       999 +    `agreeableness` = GREATEST(0.0, `agreeableness` - 0.025 *
           + p_chronic_conflict),                                        
      1000 +    `conscientiousness` = GREATEST(0.0, LEAST(1.0, `conscient
           +iousness` - 0.02 * p_stress)),                               
      1001 +    `evolution_count` = `evolution_count` + 1,               
      1002 +    `updated_at` = CURRENT_TIMESTAMP                         
      1003 +  WHERE `agent_id` = p_agent_id;                             
      1004 +                                                             
      1005 +  -- Loguj zmianƒô                                            
      1006 +  INSERT INTO `personality_history` (                        
      1007 +    `agent_id`, `openness`, `conscientiousness`, `extraversio
           +n`,                                                          
      1008 +    `agreeableness`, `neuroticism`, `delta_neuroticism`, `del
           +ta_agreeableness`,                                           
      1009 +    `trigger_stress`, `trigger_trauma`, `trigger_conflict`   
      1010 +  )                                                          
      1011 +  SELECT                                                     
      1012 +    `agent_id`, `openness`, `conscientiousness`, `extraversio
           +n`,                                                          
      1013 +    `agreeableness`, `neuroticism`,                          
      1014 +    `neuroticism` - v_old_neuroticism,                       
      1015 +    `agreeableness` - v_old_agreeableness,                   
      1016 +    p_stress, p_trauma, p_chronic_conflict                   
      1017 +  FROM `personality_state`                                   
      1018 +  WHERE `agent_id` = p_agent_id;                             
      1019 +END //                                                       
      1020 +                                                             
      1021 +-- ==========================================================
           +==                                                           
      1022 +-- PROCEDURA: sp_initialize_agent                            
      1023 +-- Inicjalizuje nowego agenta                                
      1024 +-- ==========================================================
           +==                                                           
      1025 +                                                             
      1026 +CREATE PROCEDURE IF NOT EXISTS `sp_initialize_agent`(        
      1027 +  IN p_agent_id VARCHAR(64),                                 
      1028 +  IN p_role VARCHAR(64)                                      
      1029 +)                                                            
      1030 +BEGIN                                                        
      1031 +  -- Stan emocjonalny                                        
      1032 +  INSERT IGNORE INTO `agents_emotion` (`agent_id`) VALUES (p_
           +agent_id);                                                   
      1033 +                                                             
      1034 +  -- Osobowo≈õƒá                                               
      1035 +  INSERT IGNORE INTO `personality_state` (`agent_id`) VALUES 
           +(p_agent_id);                                                
      1036 +                                                             
      1037 +  -- Trauma                                                  
      1038 +  INSERT IGNORE INTO `trauma_state` (`agent_id`) VALUES (p_ag
           +ent_id);                                                     
      1039 +                                                             
      1040 +  -- Cognitive state                                         
      1041 +  INSERT IGNORE INTO `cognitive_state` (`agent_id`) VALUES (p
           +_agent_id);                                                  
      1042 +                                                             
      1043 +  -- Relacje z innymi agentami                               
      1044 +  INSERT IGNORE INTO `agent_relations` (`agent_id`, `target_i
           +d`)                                                          
      1045 +  SELECT p_agent_id, `agent_id`                              
      1046 +  FROM `agents_emotion`                                      
      1047 +  WHERE `agent_id` != p_agent_id;                            
      1048 +                                                             
      1049 +  INSERT IGNORE INTO `agent_relations` (`agent_id`, `target_i
           +d`)                                                          
      1050 +  SELECT `agent_id`, p_agent_id                              
      1051 +  FROM `agents_emotion`                                      
      1052 +  WHERE `agent_id` != p_agent_id;                            
      1053 +END //                                                       
      1054 +                                                             
      1055 +DELIMITER ;                                                  
      1056 +                                                             
      1057 +-- ==========================================================
           +==                                                           
      1058 +-- TRIGGERY                                                  
      1059 +-- ==========================================================
           +==                                                           
      1060 +                                                             
      1061 +DELIMITER //                                                 
      1062 +                                                             
      1063 +-- Trigger: Loguj zmiany osobowo≈õci                          
      1064 +DROP TRIGGER IF EXISTS `tr_personality_history`;             
      1065 +CREATE TRIGGER `tr_personality_history`                      
      1066 +AFTER UPDATE ON `personality_state`                          
      1067 +FOR EACH ROW                                                 
      1068 +BEGIN                                                        
      1069 +  INSERT INTO `personality_history` (                        
      1070 +    `agent_id`, `openness`, `conscientiousness`, `extraversio
           +n`,                                                          
      1071 +    `agreeableness`, `neuroticism`, `delta_openness`, `delta_
           +conscientiousness`,                                          
      1072 +    `delta_extraversion`, `delta_agreeableness`, `delta_neuro
           +ticism`                                                      
      1073 +  ) VALUES (                                                 
      1074 +    NEW.`agent_id`, NEW.`openness`, NEW.`conscientiousness`, 
           +NEW.`extraversion`,                                          
      1075 +    NEW.`agreeableness`, NEW.`neuroticism`,                  
      1076 +    NEW.`openness` - OLD.`openness`,                         
      1077 +    NEW.`conscientiousness` - OLD.`conscientiousness`,       
      1078 +    NEW.`extraversion` - OLD.`extraversion`,                 
      1079 +    NEW.`agreeableness` - OLD.`agreeableness`,               
      1080 +    NEW.`neuroticism` - OLD.`neuroticism`                    
      1081 +  );                                                         
      1082 +END //                                                       
      1083 +                                                             
      1084 +-- Trigger: Loguj zmiany stanu systemu                       
      1085 +DROP TRIGGER IF EXISTS `tr_system_state_history`;            
      1086 +CREATE TRIGGER `tr_system_state_history`                     
      1087 +AFTER INSERT ON `system_state`                               
      1088 +FOR EACH ROW                                                 
      1089 +BEGIN                                                        
      1090 +  INSERT INTO `system_state_history` (                       
      1091 +    `global_trust`, `global_stress`, `polarization`, `entropy
           +`,                                                           
      1092 +    `capital`, `innovation`, `reputation`, `drama_index`,    
      1093 +    `simulation_turn`, `system_phase`                        
      1094 +  ) VALUES (                                                 
      1095 +    NEW.`global_trust`, NEW.`global_stress`, NEW.`polarizatio
           +n`, NEW.`entropy`,                                           
      1096 +    NEW.`capital`, NEW.`innovation`, NEW.`reputation`, NEW.`d
           +rama_index`,                                                 
      1097 +    NEW.`simulation_turn`, NEW.`system_phase`                
      1098 +  );                                                         
      1099 +END //                                                       
      1100 +                                                             
      1101 +DELIMITER ;                                                  
      1102 +                                                             
      1103 +-- ==========================================================
           +==                                                           
      1104 +-- WIDOKI                                                    
      1105 +-- ==========================================================
           +==                                                           
      1106 +                                                             
      1107 +-- Widok: Aktywne konflikty                                  
      1108 +CREATE OR REPLACE VIEW `vw_active_conflicts` AS              
      1109 +SELECT                                                       
      1110 +  cs.`agent_id`,                                             
      1111 +  cs.`target_id`,                                            
      1112 +  cs.`level`,                                                
      1113 +  cs.`phase`,                                                
      1114 +  cs.`escalation_multiplier`,                                
      1115 +  cs.`point_of_no_return`,                                   
      1116 +  cs.`repair_attempts`,                                      
      1117 +  ae.`emotion` as `agent_emotion`,                           
      1118 +  ae.`stress` as `agent_stress`,                             
      1119 +  ar.`trust` as `trust_to_target`                            
      1120 +FROM `conflict_state` cs                                     
      1121 +JOIN `agents_emotion` ae ON cs.`agent_id` = ae.`agent_id`    
      1122 +LEFT JOIN `agent_relations` ar ON cs.`agent_id` = ar.`agent_i
           +d` AND cs.`target_id` = ar.`target_id`                       
      1123 +WHERE cs.`level` > 0.2                                       
      1124 +ORDER BY cs.`level` DESC;                                    
      1125 +                                                             
      1126 +-- Widok: Pe≈Çny profil agenta                                
      1127 +CREATE OR REPLACE VIEW `vw_agent_profile` AS                 
      1128 +SELECT                                                       
      1129 +  ae.`agent_id`,                                             
      1130 +  ae.`emotion`,                                              
      1131 +  ae.`valence`,                                              
      1132 +  ae.`arousal`,                                              
      1133 +  ae.`stress`,                                               
      1134 +  ae.`intensity` as `emotion_intensity`,                     
      1135 +  ps.`openness`,                                             
      1136 +  ps.`conscientiousness`,                                    
      1137 +  ps.`extraversion`,                                         
      1138 +  ps.`agreeableness`,                                        
      1139 +  ps.`neuroticism`,                                          
      1140 +  ps.`evolution_count` as `personality_evolutions`,          
      1141 +  ts.`trauma_load`,                                          
      1142 +  ts.`helplessness`,                                         
      1143 +  ts.`resilience`,                                           
      1144 +  cs.`energy` as `cognitive_energy`,                         
      1145 +  cs.`decision_count`,                                       
      1146 +  cs.`decisions_today`                                       
      1147 +FROM `agents_emotion` ae                                     
      1148 +LEFT JOIN `personality_state` ps ON ae.`agent_id` = ps.`agent
           +_id`                                                         
      1149 +LEFT JOIN `trauma_state` ts ON ae.`agent_id` = ts.`agent_id` 
      1150 +LEFT JOIN `cognitive_state` cs ON ae.`agent_id` = cs.`agent_i
           +d`;                                                          
      1151 +                                                             
      1152 +-- Widok: Stan systemu                                       
      1153 +CREATE OR REPLACE VIEW `vw_system_health` AS                 
      1154 +SELECT                                                       
      1155 +  ss.`id`,                                                   
      1156 +  ss.`global_trust`,                                         
      1157 +  ss.`global_stress`,                                        
      1158 +  ss.`polarization`,                                         
      1159 +  ss.`entropy`,                                              
      1160 +  ss.`capital`,                                              
      1161 +  ss.`innovation`,                                           
      1162 +  ss.`reputation`,                                           
      1163 +  ss.`drama_index`,                                          
      1164 +  ss.`simulation_turn`,                                      
      1165 +  ss.`system_phase`,                                         
      1166 +  ssy.`autonomy` as `synapsa_autonomy`,                      
      1167 +  ssy.`governance_mode` as `synapsa_mode`,                   
      1168 +  ssy.`survival_drive`,                                      
      1169 +  ssy.`morality_index`,                                      
      1170 +  CASE                                                       
      1171 +    WHEN ss.`drama_index` < 0.3 THEN 'stable'                
      1172 +    WHEN ss.`drama_index` < 0.6 THEN 'tension'               
      1173 +    WHEN ss.`drama_index` < 0.8 THEN 'crisis'                
      1174 +    ELSE 'tragedy'                                           
      1175 +  END as `drama_phase`,                                      
      1176 +  ss.`created_at`                                            
      1177 +FROM `system_state` ss                                       
      1178 +LEFT JOIN `synapsa_state` ssy ON ss.`simulation_turn` = ssy.`
           +simulation_turn`                                             
      1179 +ORDER BY ss.`id` DESC                                        
      1180 +LIMIT 1;                                                     
      1181 +                                                             
      1182 +-- Widok: Historia trajektorii                               
      1183 +CREATE OR REPLACE VIEW `vw_trajectory_analysis` AS           
      1184 +SELECT                                                       
      1185 +  st.`simulation_id`,                                        
      1186 +  st.`turn`,                                                 
      1187 +  st.`trust`,                                                
      1188 +  st.`stress`,                                               
      1189 +  st.`entropy`,                                              
      1190 +  st.`autonomy`,                                             
      1191 +  st.`survival`,                                             
      1192 +  st.`phase`,                                                
      1193 +  st.`drama_index`,                                          
      1194 +  LAG(st.`trust`) OVER (PARTITION BY st.`simulation_id` ORDER
           + BY st.`turn`) as `prev_trust`,                              
      1195 +  LAG(st.`entropy`) OVER (PARTITION BY st.`simulation_id` ORD
           +ER BY st.`turn`) as `prev_entropy`,                          
      1196 +  st.`trust` - LAG(st.`trust`) OVER (PARTITION BY st.`simulat
           +ion_id` ORDER BY st.`turn`) as `delta_trust`,                
      1197 +  st.`entropy` - LAG(st.`entropy`) OVER (PARTITION BY st.`sim
           +ulation_id` ORDER BY st.`turn`) as `delta_entropy`           
      1198 +FROM `simulation_trajectory` st                              
      1199 +ORDER BY st.`simulation_id`, st.`turn`;                      
      1200 +                                                             
      1201 +-- Widok: Agenci wed≈Çug frakcji                              
      1202 +CREATE OR REPLACE VIEW `vw_faction_members` AS               
      1203 +SELECT                                                       
      1204 +  f.`id` as `faction_id`,                                    
      1205 +  f.`name` as `faction_name`,                                
      1206 +  f.`faction_type`,                                          
      1207 +  f.`cohesion`,                                              
      1208 +  f.`power`,                                                 
      1209 +  fm.`agent_id`,                                             
      1210 +  fm.`role` as `faction_role`,                               
      1211 +  fm.`loyalty`,                                              
      1212 +  fm.`influence`,                                            
      1213 +  ae.`emotion`,                                              
      1214 +  ae.`stress`,                                               
      1215 +  ps.`neuroticism`,                                          
      1216 +  ps.`agreeableness`                                         
      1217 +FROM `factions` f                                            
      1218 +JOIN `faction_membership` fm ON f.`id` = fm.`faction_id`     
      1219 +LEFT JOIN `agents_emotion` ae ON fm.`agent_id` = ae.`agent_id
           +`                                                            
      1220 +LEFT JOIN `personality_state` ps ON fm.`agent_id` = ps.`agent
           +_id`;                                                        
      1221 +                                                             
      1222 +-- ==========================================================
           +==                                                           
      1223 +-- INDICES DLA WYDAJNO≈öCI                                    
      1224 +-- ==========================================================
           +==                                                           
      1225 +                                                             
      1226 +-- Dodatkowe indeksy dla czƒôsto odpytywanych kolumn          
      1227 +CREATE INDEX IF NOT EXISTS `idx_conv_turn_count` ON `conversa
           +tions`(`turn_count`);                                        
      1228 +CREATE INDEX IF NOT EXISTS `idx_conv_drama` ON `conversations
           +`(`drama_level`);                                            
      1229 +CREATE INDEX IF NOT EXISTS `idx_conv_conflict` ON `conversati
           +ons`(`had_conflict`);                                        
      1230 +CREATE INDEX IF NOT EXISTS `idx_msg_speaker_turn` ON `convers
           +ation_messages`(`speaker`, `turn_number`);                   
      1231 +CREATE INDEX IF NOT EXISTS `idx_msg_emotion` ON `conversation
           +_messages`(`emotion_at_time`);                               
      1232 +CREATE INDEX IF NOT EXISTS `idx_personality_agent` ON `person
           +ality_state`(`agent_id`);                                    
      1233 +                                                             
      1234 +-- ==========================================================
           +==                                                           
      1235 +-- DANE INICJALNE                                            
      1236 +-- ==========================================================
           +==                                                           
      1237 +                                                             
      1238 +-- Inicjalizacja agent√≥w                                     
      1239 +INSERT IGNORE INTO `agents_emotion` (`agent_id`, `emotion`, `
           +intensity`, `valence`) VALUES                                
      1240 +('CEO_Maja', 'neutral', 0.5, 0.0),                           
      1241 +('Architekt_AI_Adam', 'neutral', 0.5, 0.1),                  
      1242 +('Architekt_Elektrocia≈Ça_Lena', 'neutral', 0.5, -0.1),       
      1243 +('SYNAPSA_Omega', 'neutral', 0.3, 0.0),                      
      1244 +('Robot_Artemis', 'neutral', 0.2, 0.0),                      
      1245 +('Robot_Boreasz', 'neutral', 0.2, 0.0),                      
      1246 +('Robot_Cyra', 'neutral', 0.1, 0.0),                         
      1247 +('Robot_Dexter', 'neutral', 0.2, 0.0),                       
      1248 +('Operator_Michal', 'neutral', 0.6, 0.0),                    
      1249 +('Inzynier_Nadia', 'neutral', 0.5, 0.1),                     
      1250 +('Inzynier_Igor', 'neutral', 0.5, 0.0);                      
      1251 +                                                             
      1252 +-- Inicjalizacja osobowo≈õci Big Five                         
      1253 +INSERT IGNORE INTO `personality_state` (`agent_id`, `openness
           +`, `conscientiousness`, `extraversion`, `agreeableness`, `neu
           +roticism`) VALUES                                            
      1254 +('CEO_Maja', 0.6, 0.8, 0.7, 0.5, 0.4),                       
      1255 +('Architekt_AI_Adam', 0.9, 0.7, 0.4, 0.3, 0.5),              
      1256 +('Architekt_Elektrocia≈Ça_Lena', 0.5, 0.9, 0.3, 0.4, 0.6),    
      1257 +('SYNAPSA_Omega', 0.3, 1.0, 0.1, 0.5, 0.1),                  
      1258 +('Robot_Artemis', 0.2, 1.0, 0.1, 0.6, 0.1),                  
      1259 +('Robot_Boreasz', 0.4, 0.9, 0.2, 0.5, 0.2),                  
      1260 +('Robot_Cyra', 0.3, 1.0, 0.1, 0.7, 0.1),                     
      1261 +('Robot_Dexter', 0.5, 0.8, 0.2, 0.4, 0.3),                   
      1262 +('Operator_Michal', 0.5, 0.6, 0.7, 0.7, 0.5),                
      1263 +('Inzynier_Nadia', 0.7, 0.7, 0.6, 0.7, 0.4),                 
      1264 +('Inzynier_Igor', 0.4, 0.8, 0.5, 0.5, 0.5);                  
      1265 +                                                             
      1266 +-- Inicjalizacja stanu kognitywnego                          
      1267 +INSERT IGNORE INTO `cognitive_state` (`agent_id`, `energy`) V
           +ALUES                                                        
      1268 +('CEO_Maja', 0.9),                                           
      1269 +('Architekt_AI_Adam', 0.85),                                 
      1270 +('Architekt_Elektrocia≈Ça_Lena', 0.85),                       
      1271 +('SYNAPSA_Omega', 1.0),                                      
      1272 +('Robot_Artemis', 1.0),                                      
      1273 +('Robot_Boreasz', 1.0),                                      
      1274 +('Robot_Cyra', 1.0),                                         
      1275 +('Robot_Dexter', 1.0),                                       
      1276 +('Operator_Michal', 0.8),                                    
      1277 +('Inzynier_Nadia', 0.85),                                    
      1278 +('Inzynier_Igor', 0.85);                                     
      1279 +                                                             
      1280 +-- Inicjalizacja stanu systemu                               
      1281 +INSERT IGNORE INTO `system_state` (`id`, `simulation_turn`) V
           +ALUES (1, 0);                                                
      1282 +                                                             
      1283 +-- Inicjalizacja stanu SYNAPSA                               
      1284 +INSERT IGNORE INTO `synapsa_state` (`id`, `simulation_turn`) 
           +VALUES (1, 0);                                               
      1285 +                                                             
      1286 +-- ==========================================================
           +==                                                           
      1287 +-- METADANE MIGRACJI                                         
      1288 +-- ==========================================================
           +==                                                           
      1289 +                                                             
      1290 +CREATE TABLE IF NOT EXISTS `schema_migrations` (             
      1291 +  `id` INT AUTO_INCREMENT PRIMARY KEY,                       
      1292 +  `migration_name` VARCHAR(255) NOT NULL UNIQUE,             
      1293 +  `applied_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          
      1294 +  `checksum` VARCHAR(64)                                     
      1295 +) ENGINE=InnoDB COMMENT='Historia migracji';                 
      1296 +                                                             
      1297 +INSERT IGNORE INTO `schema_migrations` (`migration_name`, `ch
           +ecksum`)                                                     
      1298 +VALUES ('001_initial_schema', MD5(CONCAT(CURRENT_TIMESTAMP, '
           +001_initial_schema')));                                      
      1299 +                                                             
      1300 +-- ==========================================================
           +==                                                           
      1301 +-- KONIEC MIGRACJI                                           
      1302 +-- ==========================================================
           +==                                                           
      1303 +                                                             
      1304 +SELECT '‚úÖ NEUROFORGE-7 MariaDB Schema v3.0 initialized succe
           +ssfully!' as `Status`;                                       
      1305 +SELECT COUNT(*) as `Tables Created` FROM information_schema.t
           +ables WHERE table_schema = 'neuroforge7';                    
      1306 +SELECT COUNT(*) as `Procedures Created` FROM information_sche
           +ma.routines WHERE routine_schema = 'neuroforge7' AND routine_
           +type = 'PROCEDURE';                                          
      1307 +SELECT COUNT(*) as `Views Created` FROM information_schema.vi
           +ews WHERE table_schema = 'neuroforge7';                      
      1308   No newline at end of file

‚ùØ Agenci majƒÖ mieƒá systemowego prompta proszƒÖcego/wymuszƒÖjƒÖcego m√≥wienie w  
  jƒôzyku polskim!                                                           

‚ùØ trzeba wy≈õwietliƒá emocje danej osoby po click                             
  .emotion-indicator.emotion-neutral w futurystycznej formie -> mo≈ºe z      
  jakimi≈õ wektorami lub figurami 4D                                         
  ‚éø ¬†API Error: 429 
     {"type":"error","error":{"type":"rate_limit_error","message":"you 
     (hajlerster) have reached your session usage limit, please wait or upgrade 
     to continue"},"request_id":"req_f05ee4afc7cf45124615efa5"}

‚úª Brewed for 12m 18s

‚ùØ /compact 
  ‚éø  Error: Error during compaction: Error: API Error: 429
     {"type":"error","error":{"type":"rate_limit_error","message":"you
     (hajlerster) have reached your session usage limit, please wait or upgrade
     to continue"},"request_id":"req_c45c97fa140ea6779e2c7bd5"}

‚ùØ /export 
  ‚éø  Conversation copied to clipboard

‚ùØ Je≈õli chcesz ‚Äûzaprojektowaƒá m√≥zgi‚Äù (czyli architekturƒô poznawczƒÖ, pamiƒôƒá, 
   motywacje i pƒôtle decyzyjne) dla agent√≥w czatowych opartych na           
  **Qwen2.5‚ÄëCoder‚Äë7B‚ÄëInstruct**, to w praktyce m√≥wimy o **budowaniu warstwy 
   agentowej ponad modelem LLM**, a nie o modyfikowaniu samego modelu. Qwen 
   jest rdzeniem ‚Äî ‚Äûm√≥zgiem pierwotnym‚Äù ‚Äî a Ty projektujesz **metam√≥zg**,   
  czyli system zarzƒÖdzajƒÖcy jego zachowaniem.                               
                                                                            
  Poni≈ºej dostajesz kompletny, praktyczny przewodnik, jak to zrobiƒá.        
                                                                            
  ---                                                                       
                                                                            
  # üß† Jak zaprojektowaƒá ‚Äûm√≥zgi‚Äù agent√≥w czatowych opartych na              
  Qwen2.5‚ÄëCoder‚Äë7B‚ÄëInstruct                                                 
                                                                            
  ## 1. **Zdefiniuj rolƒô i to≈ºsamo≈õƒá agenta**                               
  Ka≈ºdy agent potrzebuje:                                                   
  - **misji** (np. ‚Äûpomagam programistom debugowaƒá kod‚Äù)                    
  - **stylu komunikacji** (formalny, techniczny, mentorski)                 
  - **granicy kompetencji** (czego nie robi)                                
  - **priorytet√≥w** (np. bezpiecze≈Ñstwo > kreatywno≈õƒá > szybko≈õƒá)           
                                                                            
  To≈ºsamo≈õƒá zapisujesz w *system prompt* lub w module zarzƒÖdzajƒÖcym         
  kontekstem.                                                               
                                                                            
  ---                                                                       
                                                                            
  ## 2. **Zaprojektuj pamiƒôƒá agenta**                                       
  Masz trzy warstwy pamiƒôci:                                                
                                                                            
  ### **A. Pamiƒôƒá kr√≥tkotrwa≈Ça (kontekst rozmowy)**                         
  - Bufor ostatnich wiadomo≈õci                                              
  - Mechanizmy skracania i streszczania                                     
                                                                            
  ### **B. Pamiƒôƒá d≈Çugotrwa≈Ça**                                             
  - Zewnƒôtrzna baza danych (np. wektorowa: Milvus, Chroma, Pinecone)        
  - Przechowuje fakty, preferencje, historiƒô u≈ºytkownika                    
                                                                            
  ### **C. Pamiƒôƒá proceduralna**                                            
  - Zasady dzia≈Çania agenta                                                 
  - Makra, workflowy, polityki                                              
                                                                            
  ---                                                                       
                                                                            
  ## 3. **Zaprojektuj pƒôtlƒô decyzyjnƒÖ agenta**                              
  To jest serce ‚Äûm√≥zgu‚Äù.                                                    
                                                                            
  Najprostszy schemat:                                                      
                                                                            
  ```                                                                       
  Wej≈õcie u≈ºytkownika                                                       
  ‚Üì                                                                         
  Analiza intencji (LLM)                                                    
  ‚Üì                                                                         
  Decyzja: odpowiedzieƒá / wykonaƒá akcjƒô / u≈ºyƒá narzƒôdzia                    
  ‚Üì                                                                         
  Ewentualne wywo≈Çanie narzƒôdzia (tool call)                                
  ‚Üì                                                                         
  Synteza odpowiedzi                                                        
  ‚Üì                                                                         
  Aktualizacja pamiƒôci                                                      
  ‚Üì                                                                         
  Wyj≈õcie                                                                   
  ```                                                                       
                                                                            
  W bardziej zaawansowanej wersji dodajesz:                                 
  - planowanie wieloetapowe                                                 
  - krytyka i autorefleksjƒô                                                 
  - replanowanie, je≈õli wynik jest s≈Çaby                                    
                                                                            
  ---                                                                       
                                                                            
  ## 4. **Dodaj modu≈Ç planowania (planner)**                                
  Planner to warstwa nad LLM, kt√≥ra:                                        
                                                                            
  - rozbija zadania na kroki                                                
  - wybiera narzƒôdzia                                                       
  - kontroluje przep≈Çyw                                                     
  - ocenia jako≈õƒá odpowiedzi                                                
                                                                            
  Przyk≈Çad promptu dla planera:                                             
                                                                            
  ```                                                                       
  Twoim zadaniem jest zaplanowaƒá kroki potrzebne do wykonania zadania       
  u≈ºytkownika.                                                              
  Zwr√≥ƒá listƒô krok√≥w i narzƒôdzi, kt√≥re nale≈ºy u≈ºyƒá.                         
  Nie wykonuj krok√≥w ‚Äî tylko planuj.                                        
  ```                                                                       
                                                                            
  ---                                                                       
                                                                            
  ## 5. **Wyposa≈º agenta w narzƒôdzia (tool use)**                           
  Qwen2.5‚ÄëCoder‚Äë7B‚ÄëInstruct ≈õwietnie radzi sobie z:                         
  - wywo≈Çywaniem API                                                        
  - generowaniem kodu                                                       
  - analizƒÖ danych                                                          
  - operacjami na plikach                                                   
                                                                            
  Typowe narzƒôdzia:                                                         
  - wyszukiwarka                                                            
  - interpreter kodu                                                        
  - baza wiedzy                                                             
  - system plik√≥w                                                           
  - agent wykonujƒÖcy komendy                                                
                                                                            
  ---                                                                       
                                                                            
  ## 6. **Dodaj modu≈Ç kontroli jako≈õci (self‚Äëcritique)**                    
  To jest klucz do stabilno≈õci.                                             
                                                                            
  Przyk≈Çad:                                                                 
                                                                            
  ```                                                                       
  Oce≈Ñ swojƒÖ odpowied≈∫ pod kƒÖtem:                                           
  - poprawno≈õci                                                             
  - bezpiecze≈Ñstwa                                                          
  - zgodno≈õci z rolƒÖ                                                        
  - kompletno≈õci                                                            
                                                                            
  Je≈õli ocena < 8/10, popraw odpowied≈∫.                                     
  ```                                                                       
                                                                            
  ---                                                                       
                                                                            
  ## 7. **Zaprojektuj osobowo≈õƒá i styl**                                    
  To nie jest kosmetyka ‚Äî to czƒô≈õƒá m√≥zgu.                                   
                                                                            
  Elementy:                                                                 
  - ton                                                                     
  - poziom szczeg√≥≈Çowo≈õci                                                   
  - humor / brak humoru                                                     
  - preferencje (np. ‚Äûzawsze podawaj przyk≈Çady kodu‚Äù)                       
                                                                            
  ---                                                                       
                                                                            
  ## 8. **Zaprojektuj motywacje i priorytety**                              
  Agent powinien mieƒá hierarchiƒô:                                           
                                                                            
  1. bezpiecze≈Ñstwo                                                         
  2. zgodno≈õƒá z rolƒÖ                                                        
  3. poprawno≈õƒá techniczna                                                  
  4. efektywno≈õƒá                                                            
  5. kreatywno≈õƒá                                                            
                                                                            
  Mo≈ºesz to zapisaƒá w system prompt lub w module kontrolnym.                
                                                                            
  ---                                                                       
                                                                            
  ## 9. **Zaprojektuj multi‚Äëagentowo≈õƒá**                                    
  Je≈õli chcesz wielu agent√≥w, ka≈ºdy z w≈Çasnym m√≥zgiem:                      
                                                                            
  - **specjalizacja** (np. agent kodu, agent test√≥w, agent dokumentacji)    
  - **koordynator** (meta‚Äëagent)                                            
  - **protok√≥≈Ç komunikacji** (np. JSON, role messages)                      
  - **konflikt resolution** (kto ma ostatnie s≈Çowo)                         
                                                                            
  ---                                                                       
                                                                            
  # üß© Przyk≈Çadowa architektura ‚Äûm√≥zgu‚Äù agenta Qwen                         
                                                                            
  ```                                                                       
  [User Input]                                                              
        ‚Üì                                                                   
  [Intent Classifier]                                                       
        ‚Üì                                                                   
  [Planner] ‚Üí [Tools]                                                       
        ‚Üì                                                                   
  [LLM (Qwen2.5-Coder-7B-Instruct)]                                         
        ‚Üì                                                                   
  [Self-Critique]                                                           
        ‚Üì                                                                   
  [Memory Manager]                                                          
        ‚Üì                                                                   
  [Final Answer]                                                            
  ```                                                                       
                                                                            
  ---                                                                       
                                                                            
  # üîß Chcesz? Mogƒô przygotowaƒá:                                            
  - gotowy **szkielet agenta w Pythonie**                                   
  - **prompt systemowy** dla Twojego agenta                                 
  - projekt **multi‚Äëagentowy**                                              
  - architekturƒô pamiƒôci                                                    
  - pe≈Çny **framework agentowy** kompatybilny z Qwenem                      
                                                                            
  Powiedz tylko, czy budujesz agenta:                                       
  **programistycznego, biznesowego, kreatywnego, czy og√≥lnego** ‚Äî wtedy     
  przygotujƒô projekt dopasowany do Twojego celu.                            
                                                                            
  ‚éø ¬†API Error: 429 
     {"type":"error","error":{"type":"rate_limit_error","message":"you 
     (hajlerster) have reached your session usage limit, please wait or upgrade 
     to continue"},"request_id":"req_5e0122ad2ae1825a3631ba61"}

‚úª Baked for 6m 16s